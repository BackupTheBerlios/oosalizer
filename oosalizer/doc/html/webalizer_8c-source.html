<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OOS [Webalizer]: oosalizer/webalizer.c Quellcode</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Erzeugt von Doxygen 1.4.6 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Hauptseite</span></a></li>
    <li><a href="annotated.html"><span>Datenstrukturen</span></a></li>
    <li id="current"><a href="files.html"><span>Dateien</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>uchen&nbsp;nach&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>Auflistung&nbsp;der&nbsp;Dateien</span></a></li>
    <li><a href="globals.html"><span>Datei-Elemente</span></a></li>
  </ul></div>
<h1>oosalizer/webalizer.c</h1><a href="webalizer_8c.html">gehe zur Dokumentation dieser Datei</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment">    webalizer - a web server log analysis program</span>
<a name="l00003"></a>00003 <span class="comment"></span>
<a name="l00004"></a>00004 <span class="comment">    Copyright (C) 1997-2001  Bradford L. Barrett (brad@mrunix.net)</span>
<a name="l00005"></a>00005 <span class="comment"></span>
<a name="l00006"></a>00006 <span class="comment">    This program is free software; you can redistribute it and/or modify</span>
<a name="l00007"></a>00007 <span class="comment">    it under the terms of the GNU General Public License as published by</span>
<a name="l00008"></a>00008 <span class="comment">    the Free Software Foundation; either version 2 of the License, or</span>
<a name="l00009"></a>00009 <span class="comment">    (at your option) any later version, and provided that the above</span>
<a name="l00010"></a>00010 <span class="comment">    copyright and permission notice is included with all distributed</span>
<a name="l00011"></a>00011 <span class="comment">    copies of this or derived software.</span>
<a name="l00012"></a>00012 <span class="comment"></span>
<a name="l00013"></a>00013 <span class="comment">    This program is distributed in the hope that it will be useful,</span>
<a name="l00014"></a>00014 <span class="comment">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00015"></a>00015 <span class="comment">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00016"></a>00016 <span class="comment">    GNU General Public License for more details.</span>
<a name="l00017"></a>00017 <span class="comment"></span>
<a name="l00018"></a>00018 <span class="comment">    You should have received a copy of the GNU General Public License</span>
<a name="l00019"></a>00019 <span class="comment">    along with this program; if not, write to the Free Software</span>
<a name="l00020"></a>00020 <span class="comment">    Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA</span>
<a name="l00021"></a>00021 <span class="comment"></span>
<a name="l00022"></a>00022 <span class="comment">    This software uses the gd graphics library, which is copyright by</span>
<a name="l00023"></a>00023 <span class="comment">    Quest Protein Database Center, Cold Spring Harbor Labs.  Please</span>
<a name="l00024"></a>00024 <span class="comment">    see the documentation supplied with the library for additional</span>
<a name="l00025"></a>00025 <span class="comment">    information and license terms, or visit www.boutell.com/gd/ for the</span>
<a name="l00026"></a>00026 <span class="comment">    most recent version of the library and supporting documentation.</span>
<a name="l00027"></a>00027 <span class="comment">*/</span>
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 <span class="comment">/*********************************************/</span>
<a name="l00030"></a>00030 <span class="comment">/* STANDARD INCLUDES                         */</span>
<a name="l00031"></a>00031 <span class="comment">/*********************************************/</span>
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;time.h&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &lt;unistd.h&gt;</span>                           <span class="comment">/* normal stuff             */</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &lt;ctype.h&gt;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &lt;sys/utsname.h&gt;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &lt;sys/times.h&gt;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &lt;zlib.h&gt;</span>
<a name="l00042"></a>00042 
<a name="l00043"></a>00043 <span class="comment">/* ensure getopt */</span>
<a name="l00044"></a>00044 <span class="preprocessor">#ifdef HAVE_GETOPT_H</span>
<a name="l00045"></a>00045 <span class="preprocessor"></span><span class="preprocessor">#include &lt;getopt.h&gt;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#endif</span>
<a name="l00047"></a>00047 <span class="preprocessor"></span>
<a name="l00048"></a>00048 <span class="comment">/* ensure sys/types */</span>
<a name="l00049"></a>00049 <span class="preprocessor">#ifndef _SYS_TYPES_H</span>
<a name="l00050"></a>00050 <span class="preprocessor"></span><span class="preprocessor">#include &lt;sys/types.h&gt;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#endif</span>
<a name="l00052"></a>00052 <span class="preprocessor"></span>
<a name="l00053"></a>00053 <span class="comment">/* some systems need this */</span>
<a name="l00054"></a>00054 <span class="preprocessor">#ifdef HAVE_MATH_H</span>
<a name="l00055"></a>00055 <span class="preprocessor"></span><span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#endif</span>
<a name="l00057"></a>00057 <span class="preprocessor"></span>
<a name="l00058"></a>00058 <span class="comment">/* SunOS 4.x Fix */</span>
<a name="l00059"></a>00059 <span class="preprocessor">#ifndef CLK_TCK</span>
<a name="l00060"></a><a class="code" href="webalizer_8c.html#03df76d1f70664d745ca8de2864e39b3">00060</a> <span class="preprocessor"></span><span class="preprocessor">#define CLK_TCK _SC_CLK_TCK</span>
<a name="l00061"></a>00061 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00062"></a>00062 <span class="preprocessor"></span>
<a name="l00063"></a>00063 <span class="preprocessor">#ifdef USE_DNS</span>
<a name="l00064"></a>00064 <span class="preprocessor"></span><span class="preprocessor">#include &lt;netinet/in.h&gt;</span>
<a name="l00065"></a>00065 <span class="preprocessor">#include &lt;arpa/inet.h&gt;</span>
<a name="l00066"></a>00066 
<a name="l00067"></a>00067 <span class="preprocessor">#ifdef HAVE_DB_185_H</span>
<a name="l00068"></a>00068 <span class="preprocessor"></span><span class="preprocessor">#include &lt;db_185.h&gt;</span>
<a name="l00069"></a>00069 <span class="preprocessor">#else</span>
<a name="l00070"></a>00070 <span class="preprocessor"></span><span class="preprocessor">#include &lt;db.h&gt;</span>
<a name="l00071"></a>00071 <span class="preprocessor">#endif  </span><span class="comment">/* HAVE_DB_185_H */</span>
<a name="l00072"></a>00072 <span class="preprocessor">#endif  </span><span class="comment">/* USE_DNS */</span>
<a name="l00073"></a>00073 
<a name="l00074"></a>00074 <span class="preprocessor">#include "<a class="code" href="webalizer_8h.html">webalizer.h</a>"</span>                         <span class="comment">/* main header              */</span>
<a name="l00075"></a>00075 <span class="preprocessor">#include "<a class="code" href="output_8h.html">output.h</a>"</span>
<a name="l00076"></a>00076 <span class="preprocessor">#include "<a class="code" href="parser_8h.html">parser.h</a>"</span>
<a name="l00077"></a>00077 <span class="preprocessor">#include "<a class="code" href="preserve_8h.html">preserve.h</a>"</span>
<a name="l00078"></a>00078 <span class="preprocessor">#include "<a class="code" href="hashtab_8h.html">hashtab.h</a>"</span>
<a name="l00079"></a>00079 <span class="preprocessor">#include "<a class="code" href="linklist_8h.html">linklist.h</a>"</span>
<a name="l00080"></a>00080 <span class="preprocessor">#include "webalizer_lang.h"</span>                    <span class="comment">/* lang. support            */</span>
<a name="l00081"></a>00081 <span class="preprocessor">#ifdef USE_DNS</span>
<a name="l00082"></a>00082 <span class="preprocessor"></span><span class="preprocessor">#include "<a class="code" href="dns__resolv_8h.html">dns_resolv.h</a>"</span>
<a name="l00083"></a>00083 <span class="preprocessor">#endif</span>
<a name="l00084"></a>00084 <span class="preprocessor"></span>
<a name="l00085"></a>00085 <span class="comment">/* internal function prototypes */</span>
<a name="l00086"></a>00086 
<a name="l00087"></a>00087 <span class="keywordtype">void</span>    <a class="code" href="webalizer_8c.html#3d6b75394204fbb3dbe30423911cda44">clear_month</a>();                              <span class="comment">/* clear monthly stuff */</span>
<a name="l00088"></a>00088 <span class="keywordtype">char</span>    *<a class="code" href="webalizer_8c.html#5d5d55b66d7df3272cf98f061b6fd2f6">unescape</a>(<span class="keywordtype">char</span> *);                          <span class="comment">/* unescape URL's      */</span>
<a name="l00089"></a>00089 <span class="keywordtype">char</span>    <a class="code" href="webalizer_8c.html#9f2fa07c0c39a7caed8e40eaf1c2fa96">from_hex</a>(<span class="keywordtype">char</span>);                             <span class="comment">/* convert hex to dec  */</span>
<a name="l00090"></a>00090 <span class="keywordtype">void</span>    <a class="code" href="webalizer_8c.html#beb1db8f30c512b9050440ec49248364">print_opts</a>(<span class="keywordtype">char</span> *);                         <span class="comment">/* print options       */</span>
<a name="l00091"></a>00091 <span class="keywordtype">void</span>    <a class="code" href="webalizer_8c.html#6302aaae12249e8ea16bfdc7de892f21">print_version</a>();                            <span class="comment">/* duhh...             */</span>
<a name="l00092"></a>00092 <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#6889c498251013344e6bcd437b077db0">isurlchar</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>);                   <span class="comment">/* valid URL char fnc. */</span>
<a name="l00093"></a>00093 <span class="keywordtype">void</span>    <a class="code" href="webalizer_8c.html#7e50c67e6aba9c0c3025c04b0a7aedc4">get_config</a>(<span class="keywordtype">char</span> *);                         <span class="comment">/* Read a config file  */</span>
<a name="l00094"></a>00094 <span class="keyword">static</span>  <span class="keywordtype">char</span> *<a class="code" href="webalizer_8c.html#90af490e0665082d8b56fea2667356f4">save_opt</a>(<span class="keywordtype">char</span> *);                     <span class="comment">/* save conf option    */</span>
<a name="l00095"></a>00095 <span class="keywordtype">void</span>    <a class="code" href="webalizer_8c.html#2b1002ec17d1cd1e6901514b8b6de058">srch_string</a>(<span class="keywordtype">char</span> *);                        <span class="comment">/* srch str analysis   */</span>
<a name="l00096"></a>00096 <span class="keywordtype">char</span>    *<a class="code" href="webalizer_8c.html#4c24c3d81b9c48e9f490919de3e32afb">get_domain</a>(<span class="keywordtype">char</span> *);                        <span class="comment">/* return domain name  */</span>
<a name="l00097"></a>00097 <span class="keywordtype">char</span>    *<a class="code" href="webalizer_8c.html#8abb48bca3dbb868295ee2ce344e3d95">our_gzgets</a>(gzFile, <span class="keywordtype">char</span> *, <span class="keywordtype">int</span>);           <span class="comment">/* our gzgets          */</span>
<a name="l00098"></a>00098 
<a name="l00099"></a>00099 <span class="comment">/*********************************************/</span>
<a name="l00100"></a>00100 <span class="comment">/* GLOBAL VARIABLES                          */</span>
<a name="l00101"></a>00101 <span class="comment">/*********************************************/</span>
<a name="l00102"></a>00102 
<a name="l00103"></a><a class="code" href="webalizer_8h.html#56abfaab87c46691c1ef3ad0df23e864">00103</a> <span class="keywordtype">char</span>    *<a class="code" href="webalizer_8c.html#56abfaab87c46691c1ef3ad0df23e864">version</a>     = <span class="stringliteral">"2.01"</span>;                <span class="comment">/* program version          */</span>
<a name="l00104"></a><a class="code" href="webalizer_8h.html#59179d90a91f573f3c081592845ee19c">00104</a> <span class="keywordtype">char</span>    *<a class="code" href="webalizer_8c.html#59179d90a91f573f3c081592845ee19c">editlvl</a>     = <span class="stringliteral">"10"</span>;                  <span class="comment">/* edit level               */</span>
<a name="l00105"></a><a class="code" href="webalizer_8h.html#c000a634d0e3be8405dde288f429e91a">00105</a> <span class="keywordtype">char</span>    *<a class="code" href="webalizer_8c.html#c000a634d0e3be8405dde288f429e91a">moddate</a>     = <span class="stringliteral">"16-Apr-2002"</span>;         <span class="comment">/* modification date        */</span>
<a name="l00106"></a><a class="code" href="webalizer_8h.html#38852561a5fe1b90c4dae9d90b83a80a">00106</a> <span class="keywordtype">char</span>    *<a class="code" href="webalizer_8c.html#38852561a5fe1b90c4dae9d90b83a80a">copyright</a>   = <span class="stringliteral">"Copyright 1997-2001 by Bradford L. Barrett"</span>;
<a name="l00107"></a>00107 
<a name="l00108"></a><a class="code" href="webalizer_8h.html#0b2caeb4b6f130be43e5a2f0267dd453">00108</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>      = 2;                     <span class="comment">/* 2=verbose,1=err, 0=none  */</span> 
<a name="l00109"></a><a class="code" href="webalizer_8h.html#4f7caf3ead45aac3963d1e354e820017">00109</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#4f7caf3ead45aac3963d1e354e820017">debug_mode</a>   = 0;                     <span class="comment">/* debug mode flag          */</span>
<a name="l00110"></a><a class="code" href="webalizer_8h.html#445501b8b84e1293820c0142acd34113">00110</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#445501b8b84e1293820c0142acd34113">time_me</a>      = 0;                     <span class="comment">/* timing display flag      */</span>
<a name="l00111"></a><a class="code" href="webalizer_8h.html#34c0559db82e0af71c64d53206f763c8">00111</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#34c0559db82e0af71c64d53206f763c8">local_time</a>   = 1;                     <span class="comment">/* 1=localtime 0=GMT (UTC)  */</span>
<a name="l00112"></a><a class="code" href="webalizer_8h.html#9c25fea667217c12ecade9cfac496daa">00112</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#9c25fea667217c12ecade9cfac496daa">ignore_hist</a>  = 0;                     <span class="comment">/* history flag (1=skip)    */</span>
<a name="l00113"></a><a class="code" href="webalizer_8h.html#ef88d69bc7f6d6214835f0f15ef4522a">00113</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#ef88d69bc7f6d6214835f0f15ef4522a">hourly_graph</a> = 1;                     <span class="comment">/* hourly graph display     */</span>
<a name="l00114"></a><a class="code" href="webalizer_8h.html#6359837576bb8bf34e8b6984cee1e53a">00114</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#6359837576bb8bf34e8b6984cee1e53a">hourly_stats</a> = 1;                     <span class="comment">/* hourly stats table       */</span>
<a name="l00115"></a><a class="code" href="webalizer_8h.html#81ebc74fab71c6cde9eff752ad0b5974">00115</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#81ebc74fab71c6cde9eff752ad0b5974">daily_graph</a>  = 1;                     <span class="comment">/* daily graph display      */</span>
<a name="l00116"></a><a class="code" href="webalizer_8h.html#4c83c5bd481ef466be0d92fd9ad6c8b1">00116</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#4c83c5bd481ef466be0d92fd9ad6c8b1">daily_stats</a>  = 1;                     <span class="comment">/* daily stats table        */</span>
<a name="l00117"></a><a class="code" href="webalizer_8h.html#f1ef30cbdcfd1e369800371e296aaec2">00117</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#f1ef30cbdcfd1e369800371e296aaec2">ctry_graph</a>   = 1;                     <span class="comment">/* country graph display    */</span>
<a name="l00118"></a><a class="code" href="webalizer_8h.html#9b469898b01940a383f1ed816e4459b2">00118</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#9b469898b01940a383f1ed816e4459b2">shade_groups</a> = 1;                     <span class="comment">/* Group shading 0=no 1=yes */</span>
<a name="l00119"></a><a class="code" href="webalizer_8h.html#607dff280556363fab771e9e492ea057">00119</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#607dff280556363fab771e9e492ea057">hlite_groups</a> = 1;                     <span class="comment">/* Group hlite 0=no 1=yes   */</span>
<a name="l00120"></a><a class="code" href="webalizer_8h.html#23d6ba920f8b5ddaea1f3e92958bdaba">00120</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#23d6ba920f8b5ddaea1f3e92958bdaba">mangle_agent</a> = 0;                     <span class="comment">/* mangle user agents       */</span>
<a name="l00121"></a><a class="code" href="webalizer_8h.html#534a10f9409e025831882efe4a58f959">00121</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#534a10f9409e025831882efe4a58f959">incremental</a>  = 0;                     <span class="comment">/* incremental mode 1=yes   */</span>
<a name="l00122"></a><a class="code" href="webalizer_8h.html#d821baa693a77d314549e3556fd6534a">00122</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#d821baa693a77d314549e3556fd6534a">use_https</a>    = 0;                     <span class="comment">/* use 'https://' on URL's  */</span>
<a name="l00123"></a><a class="code" href="webalizer_8h.html#95c29ea4f1f207b5be0cdd3cefa935d1">00123</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#95c29ea4f1f207b5be0cdd3cefa935d1">visit_timeout</a>= 1800;                  <span class="comment">/* visit timeout (seconds)  */</span>
<a name="l00124"></a><a class="code" href="webalizer_8h.html#8209c1ed16bfdf4913b7837d8d0b8520">00124</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#8209c1ed16bfdf4913b7837d8d0b8520">graph_legend</a> = 1;                     <span class="comment">/* graph legend (1=yes)     */</span>
<a name="l00125"></a><a class="code" href="webalizer_8h.html#b0e6606dc823003635fbd6408bd03439">00125</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#b0e6606dc823003635fbd6408bd03439">graph_lines</a>  = 2;                     <span class="comment">/* graph lines (0=none)     */</span>
<a name="l00126"></a><a class="code" href="webalizer_8h.html#23652bde57737d1f6f700f29c4762728">00126</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#23652bde57737d1f6f700f29c4762728">fold_seq_err</a> = 0;                     <span class="comment">/* fold seq err (0=no)      */</span>
<a name="l00127"></a><a class="code" href="webalizer_8h.html#d1e2a6d9014a2af70dfa80ce7b69d4b0">00127</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#d1e2a6d9014a2af70dfa80ce7b69d4b0">log_type</a>     = <a class="code" href="webalizer_8h.html#5ce0d49d0e92ba00b7385ef68d26b51a">LOG_CLF</a>;               <span class="comment">/* (0=clf, 1=ftp, 2=squid)  */</span>
<a name="l00128"></a><a class="code" href="webalizer_8h.html#3b91bd084088b32764aaa00f48083faf">00128</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#3b91bd084088b32764aaa00f48083faf">group_domains</a>= 0;                     <span class="comment">/* Group domains 0=none     */</span>
<a name="l00129"></a><a class="code" href="webalizer_8h.html#a77fbf13eba0ffbb98b893c0089cb49b">00129</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#a77fbf13eba0ffbb98b893c0089cb49b">hide_sites</a>   = 0;                     <span class="comment">/* Hide ind. sites (0=no)   */</span>
<a name="l00130"></a><a class="code" href="webalizer_8h.html#674a1f0ec86ffb26578c11999c89a3c0">00130</a> <span class="keywordtype">char</span>    *<a class="code" href="webalizer_8c.html#674a1f0ec86ffb26578c11999c89a3c0">hname</a>       = NULL;                  <span class="comment">/* hostname for reports     */</span>
<a name="l00131"></a><a class="code" href="webalizer_8h.html#bc6083147b471a6df297cc5851057771">00131</a> <span class="keywordtype">char</span>    *<a class="code" href="webalizer_8c.html#bc6083147b471a6df297cc5851057771">state_fname</a> = <span class="stringliteral">"webalizer.current"</span>;   <span class="comment">/* run state file name      */</span>
<a name="l00132"></a><a class="code" href="webalizer_8h.html#196026e726faa9db510409f5d895d7a3">00132</a> <span class="keywordtype">char</span>    *<a class="code" href="webalizer_8c.html#196026e726faa9db510409f5d895d7a3">hist_fname</a>  = <span class="stringliteral">"webalizer.hist"</span>;      <span class="comment">/* name of history file     */</span>
<a name="l00133"></a><a class="code" href="webalizer_8h.html#ef5a49b05e1bff557f85797e61dcd23a">00133</a> <span class="keywordtype">char</span>    *<a class="code" href="webalizer_8c.html#ef5a49b05e1bff557f85797e61dcd23a">html_ext</a>    = <span class="stringliteral">"html"</span>;                <span class="comment">/* HTML file prefix         */</span>
<a name="l00134"></a><a class="code" href="webalizer_8h.html#b11b451e9eab811058070fddc7f42efb">00134</a> <span class="keywordtype">char</span>    *<a class="code" href="webalizer_8c.html#b11b451e9eab811058070fddc7f42efb">dump_ext</a>    = <span class="stringliteral">"tab"</span>;                 <span class="comment">/* Dump file prefix         */</span>
<a name="l00135"></a><a class="code" href="webalizer_8h.html#cdbdc13e07422e1c556c3eda55c593c2">00135</a> <span class="keywordtype">char</span>    *<a class="code" href="webalizer_8c.html#cdbdc13e07422e1c556c3eda55c593c2">conf_fname</a>  = NULL;                  <span class="comment">/* name of config file      */</span>
<a name="l00136"></a><a class="code" href="webalizer_8h.html#9db6dddd9890ca88ccca763b0533919b">00136</a> <span class="keywordtype">char</span>    *<a class="code" href="webalizer_8c.html#9db6dddd9890ca88ccca763b0533919b">log_fname</a>   = NULL;                  <span class="comment">/* log file pointer         */</span>
<a name="l00137"></a><a class="code" href="webalizer_8h.html#6910a5df32ce9909ffbacfafaa6e3645">00137</a> <span class="keywordtype">char</span>    *<a class="code" href="webalizer_8c.html#6910a5df32ce9909ffbacfafaa6e3645">out_dir</a>     = NULL;                  <span class="comment">/* output directory         */</span>
<a name="l00138"></a><a class="code" href="webalizer_8h.html#8c3c3d8858d6430eea049c5989d2bf6d">00138</a> <span class="keywordtype">char</span>    *<a class="code" href="webalizer_8c.html#8c3c3d8858d6430eea049c5989d2bf6d">blank_str</a>   = <span class="stringliteral">""</span>;                    <span class="comment">/* blank string             */</span>
<a name="l00139"></a><a class="code" href="webalizer_8h.html#3cb74b5ee16f5910ee70cc4944d1300a">00139</a> <span class="keywordtype">char</span>    *<a class="code" href="webalizer_8c.html#3cb74b5ee16f5910ee70cc4944d1300a">dns_cache</a>   = NULL;                  <span class="comment">/* DNS cache file name      */</span>
<a name="l00140"></a><a class="code" href="webalizer_8h.html#90492045766d92f08b5e160135ade65c">00140</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#90492045766d92f08b5e160135ade65c">dns_children</a> = 0;                     <span class="comment">/* DNS children (0=don't do)*/</span>
<a name="l00141"></a>00141 
<a name="l00142"></a><a class="code" href="webalizer_8h.html#57531d5f29d4cbdaac1f25e52f4a069d">00142</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#57531d5f29d4cbdaac1f25e52f4a069d">ntop_sites</a>   = 30;                    <span class="comment">/* top n sites to display   */</span>
<a name="l00143"></a><a class="code" href="webalizer_8h.html#a3069c260eedec99be29617d90fa687a">00143</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#a3069c260eedec99be29617d90fa687a">ntop_sitesK</a>  = 10;                    <span class="comment">/* top n sites (by kbytes)  */</span>
<a name="l00144"></a><a class="code" href="webalizer_8h.html#a450ef7a6e4e6148f9cb184144a7c8cc">00144</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#a450ef7a6e4e6148f9cb184144a7c8cc">ntop_urls</a>    = 30;                    <span class="comment">/* top n url's to display   */</span>
<a name="l00145"></a><a class="code" href="webalizer_8h.html#21acc4795c6bb4027a1bd2ad038fe3fa">00145</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#21acc4795c6bb4027a1bd2ad038fe3fa">ntop_urlsK</a>   = 10;                    <span class="comment">/* top n url's (by kbytes)  */</span>
<a name="l00146"></a><a class="code" href="webalizer_8h.html#a573c7e2a32733a06a3b0dbb9430569f">00146</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#a573c7e2a32733a06a3b0dbb9430569f">ntop_entry</a>   = 10;                    <span class="comment">/* top n entry url's        */</span>
<a name="l00147"></a><a class="code" href="webalizer_8h.html#9d1968145275f8eb19935b5c6d5b2848">00147</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#9d1968145275f8eb19935b5c6d5b2848">ntop_exit</a>    = 10;                    <span class="comment">/* top n exit url's         */</span>
<a name="l00148"></a><a class="code" href="webalizer_8h.html#78414d5060b40b23c1fbb95546fb74d3">00148</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#78414d5060b40b23c1fbb95546fb74d3">ntop_refs</a>    = 30;                    <span class="comment">/* top n referrers ""       */</span>
<a name="l00149"></a><a class="code" href="webalizer_8h.html#09d5297ba12ba78e65bcb4679036de17">00149</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#09d5297ba12ba78e65bcb4679036de17">ntop_agents</a>  = 15;                    <span class="comment">/* top n user agents ""     */</span>
<a name="l00150"></a><a class="code" href="webalizer_8h.html#fcd390bd7df1e721799f33f0ac87fdaf">00150</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#fcd390bd7df1e721799f33f0ac87fdaf">ntop_ctrys</a>   = 30;                    <span class="comment">/* top n countries   ""     */</span>
<a name="l00151"></a><a class="code" href="webalizer_8h.html#57e3ec40e1f85e8b2620950dc43b753f">00151</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#57e3ec40e1f85e8b2620950dc43b753f">ntop_search</a>  = 20;                    <span class="comment">/* top n search strings     */</span>
<a name="l00152"></a><a class="code" href="webalizer_8h.html#958b818c79b6fa3f2d0ab1ca4bb3e97c">00152</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#958b818c79b6fa3f2d0ab1ca4bb3e97c">ntop_users</a>   = 20;                    <span class="comment">/* top n users to display   */</span>
<a name="l00153"></a><a class="code" href="webalizer_8h.html#aae85fa49329c9361a901e52954764eb">00153</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#aae85fa49329c9361a901e52954764eb">ntop_notfound</a>= 50;                    <span class="comment">/* top n 404 to display     */</span>
<a name="l00154"></a>00154 
<a name="l00155"></a><a class="code" href="webalizer_8h.html#e80c0d7d06836110749922f34dd902c2">00155</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#e80c0d7d06836110749922f34dd902c2">all_sites</a>    = 0;                     <span class="comment">/* List All sites (0=no)    */</span>
<a name="l00156"></a><a class="code" href="webalizer_8h.html#633444563a9587349d9a5f158062b662">00156</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#633444563a9587349d9a5f158062b662">all_urls</a>     = 0;                     <span class="comment">/* List All URL's (0=no)    */</span>
<a name="l00157"></a><a class="code" href="webalizer_8h.html#5d9ecc711cb4edb47133e9c8329a2f6a">00157</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#5d9ecc711cb4edb47133e9c8329a2f6a">all_refs</a>     = 0;                     <span class="comment">/* List All Referrers       */</span>
<a name="l00158"></a><a class="code" href="webalizer_8h.html#e6a5e084455a29d95c410b6e6f509c07">00158</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#e6a5e084455a29d95c410b6e6f509c07">all_agents</a>   = 0;                     <span class="comment">/* List All User Agents     */</span>
<a name="l00159"></a><a class="code" href="webalizer_8h.html#f51b93932a98e306bd47239ec9c99f23">00159</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#f51b93932a98e306bd47239ec9c99f23">all_search</a>   = 0;                     <span class="comment">/* List All Search Strings  */</span>
<a name="l00160"></a><a class="code" href="webalizer_8h.html#395ccae1fd2f2450f623db87fbd9f9e1">00160</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#395ccae1fd2f2450f623db87fbd9f9e1">all_users</a>    = 0;                     <span class="comment">/* List All Usernames       */</span>
<a name="l00161"></a>00161 
<a name="l00162"></a><a class="code" href="webalizer_8h.html#54401b9d6a97a9951e2fb1bf09e83b2b">00162</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#54401b9d6a97a9951e2fb1bf09e83b2b">dump_sites</a>   = 0;                     <span class="comment">/* Dump tab delimited sites */</span>
<a name="l00163"></a><a class="code" href="webalizer_8h.html#a9f638a5b7e03638423ce8d5c3f5be6e">00163</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#a9f638a5b7e03638423ce8d5c3f5be6e">dump_urls</a>    = 0;                     <span class="comment">/* URL's                    */</span>
<a name="l00164"></a><a class="code" href="webalizer_8h.html#5e125d6b90581ab008f71bf272ec1aac">00164</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#5e125d6b90581ab008f71bf272ec1aac">dump_refs</a>    = 0;                     <span class="comment">/* Referrers                */</span>
<a name="l00165"></a><a class="code" href="webalizer_8h.html#95b4dacf3a1c2e18715bfbd268726afb">00165</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#95b4dacf3a1c2e18715bfbd268726afb">dump_agents</a>  = 0;                     <span class="comment">/* User Agents              */</span>
<a name="l00166"></a><a class="code" href="webalizer_8h.html#a6b267f406cddbd150680fb2ce5260b1">00166</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#a6b267f406cddbd150680fb2ce5260b1">dump_users</a>   = 0;                     <span class="comment">/* Usernames                */</span>
<a name="l00167"></a><a class="code" href="webalizer_8h.html#5acb64968750f92b0c7443ec44dde282">00167</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#5acb64968750f92b0c7443ec44dde282">dump_search</a>  = 0;                     <span class="comment">/* Search strings           */</span>
<a name="l00168"></a><a class="code" href="webalizer_8h.html#2a20cc7746e90fec505b066fda4e1f5d">00168</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#2a20cc7746e90fec505b066fda4e1f5d">dump_header</a>  = 0;                     <span class="comment">/* Dump header as first rec */</span>
<a name="l00169"></a><a class="code" href="webalizer_8h.html#10b59e622c5a54e43f7ec491e5bc1776">00169</a> <span class="keywordtype">char</span>    *<a class="code" href="webalizer_8c.html#10b59e622c5a54e43f7ec491e5bc1776">dump_path</a>   = NULL;                  <span class="comment">/* Path for dump files      */</span>
<a name="l00170"></a>00170 
<a name="l00171"></a><a class="code" href="webalizer_8h.html#8447667f9dc8021c4f17284b9a12f776">00171</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#8447667f9dc8021c4f17284b9a12f776">cur_year</a>=0, <a class="code" href="webalizer_8c.html#d8ec6498bcc8d8eb82d92bc5c1aacc8d">cur_month</a>=0,              <span class="comment">/* year/month/day/hour      */</span>
<a name="l00172"></a><a class="code" href="webalizer_8h.html#ae0bcd47798b959a96cb28082a0f151b">00172</a>         <a class="code" href="webalizer_8c.html#6edfa42467177fc02002d61038a98f39">cur_day</a>=0, <a class="code" href="webalizer_8c.html#ae0bcd47798b959a96cb28082a0f151b">cur_hour</a>=0,                <span class="comment">/* tracking variables       */</span>
<a name="l00173"></a><a class="code" href="webalizer_8h.html#a2131c365f9da2fb93a57aed95b563d8">00173</a>         <a class="code" href="webalizer_8c.html#726c08db04038ffbeffd72a3181ac519">cur_min</a>=0, <a class="code" href="webalizer_8c.html#a2131c365f9da2fb93a57aed95b563d8">cur_sec</a>=0;
<a name="l00174"></a>00174 
<a name="l00175"></a><a class="code" href="webalizer_8h.html#4327980462d3207e34bf99fce007b511">00175</a> u_long  <a class="code" href="webalizer_8c.html#4327980462d3207e34bf99fce007b511">cur_tstamp</a>=0;                         <span class="comment">/* Timestamp...             */</span>
<a name="l00176"></a><a class="code" href="webalizer_8c.html#f385cef2f38414353e7bc598d05b76c5">00176</a> u_long  <a class="code" href="webalizer_8c.html#f385cef2f38414353e7bc598d05b76c5">rec_tstamp</a>=0;  
<a name="l00177"></a><a class="code" href="webalizer_8c.html#f3d950913119a2fc8ebe574b68c7174b">00177</a> u_long  <a class="code" href="webalizer_8c.html#f3d950913119a2fc8ebe574b68c7174b">req_tstamp</a>=0;
<a name="l00178"></a><a class="code" href="webalizer_8h.html#71f3fc3b6564ee11c34ff02cee2a3e05">00178</a> u_long  <a class="code" href="webalizer_8c.html#71f3fc3b6564ee11c34ff02cee2a3e05">epoch</a>;                                <span class="comment">/* used for timestamp adj.  */</span>
<a name="l00179"></a>00179 
<a name="l00180"></a><a class="code" href="webalizer_8h.html#b1757477076fc2811cf714a92dc18d0f">00180</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#b1757477076fc2811cf714a92dc18d0f">check_dup</a>=0;                          <span class="comment">/* check for dup flag       */</span>
<a name="l00181"></a><a class="code" href="webalizer_8h.html#480128e1291f32b04678ddac9dc69457">00181</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#480128e1291f32b04678ddac9dc69457">gz_log</a>=0;                             <span class="comment">/* gziped log? (0=no)       */</span>
<a name="l00182"></a>00182 
<a name="l00183"></a><a class="code" href="webalizer_8h.html#1952e11824da591d81fdf3371627ae86">00183</a> <span class="keywordtype">double</span>  <a class="code" href="webalizer_8c.html#1952e11824da591d81fdf3371627ae86">t_xfer</a>=0.0;                           <span class="comment">/* monthly total xfer value */</span>
<a name="l00184"></a><a class="code" href="webalizer_8h.html#e37f859c6ceb40434ecd96c6ba5d0565">00184</a> u_long  <a class="code" href="webalizer_8c.html#4f0e430951167c36ff37f1373c453d40">t_hit</a>=0,<a class="code" href="webalizer_8c.html#8d8f1b3ebaff4207130ee4e068a74578">t_file</a>=0,<a class="code" href="webalizer_8c.html#e37f859c6ceb40434ecd96c6ba5d0565">t_site</a>=0,            <span class="comment">/* monthly total vars       */</span>
<a name="l00185"></a><a class="code" href="webalizer_8h.html#593eb26715b7f629074c61861d8dd8b3">00185</a>         <a class="code" href="webalizer_8c.html#593eb26715b7f629074c61861d8dd8b3">t_url</a>=0,<a class="code" href="webalizer_8c.html#54f4adcbb2769b5082a138f23c9bb07e">t_ref</a>=0,<a class="code" href="webalizer_8c.html#681645a12ff433a6d191ac4eabbb265d">t_agent</a>=0,
<a name="l00186"></a><a class="code" href="webalizer_8h.html#241257c2fb7477a7dc9191c01e8a155a">00186</a>         <a class="code" href="webalizer_8c.html#dab177cb0d83726239072547f166262a">t_page</a>=0, <a class="code" href="webalizer_8c.html#241257c2fb7477a7dc9191c01e8a155a">t_visit</a>=0, <a class="code" href="webalizer_8c.html#196ee522ca1e09cef5b8962a7c63e4e2">t_user</a>=0;
<a name="l00187"></a>00187 
<a name="l00188"></a><a class="code" href="webalizer_8h.html#d8577082542e8d61ae9d21b5cdc09de6">00188</a> <span class="keywordtype">double</span>  <a class="code" href="webalizer_8c.html#d8577082542e8d61ae9d21b5cdc09de6">tm_xfer</a>[31];                          <span class="comment">/* daily transfer totals    */</span>
<a name="l00189"></a>00189 
<a name="l00190"></a><a class="code" href="webalizer_8h.html#f3d33c8d579ff7b3d41abb0e618f70a5">00190</a> u_long  <a class="code" href="webalizer_8c.html#90b2c6f5c71d87e07a6aa0694651c7a8">tm_hit</a>[31], <a class="code" href="webalizer_8c.html#985c7f07bdd01aea04be87abba0d225b">tm_file</a>[31],              <span class="comment">/* daily total arrays       */</span>
<a name="l00191"></a>00191         <a class="code" href="webalizer_8c.html#3016395581c35bac86027a654deb0db5">tm_site</a>[31], <a class="code" href="webalizer_8c.html#2b0163914dcd84396a9d6dae48ee4a54">tm_page</a>[31],
<a name="l00192"></a>00192         <a class="code" href="webalizer_8c.html#f3d33c8d579ff7b3d41abb0e618f70a5">tm_visit</a>[31];
<a name="l00193"></a>00193 
<a name="l00194"></a><a class="code" href="webalizer_8h.html#f80cf0d40e63789f26cf6ee643eb3b4c">00194</a> u_long  <a class="code" href="webalizer_8c.html#f80cf0d40e63789f26cf6ee643eb3b4c">dt_site</a>;                              <span class="comment">/* daily 'sites' total      */</span>
<a name="l00195"></a>00195 
<a name="l00196"></a><a class="code" href="webalizer_8h.html#0fbe52a528ae909f4058a35bdab8d034">00196</a> u_long  <a class="code" href="webalizer_8c.html#14a295f77051b0898135267236453dd6">ht_hit</a>=0, <a class="code" href="webalizer_8c.html#0fbe52a528ae909f4058a35bdab8d034">mh_hit</a>=0;                   <span class="comment">/* hourly hits totals       */</span>
<a name="l00197"></a>00197 
<a name="l00198"></a><a class="code" href="webalizer_8h.html#cdb9ccdbdd487d188cd174056a7dcd80">00198</a> u_long  <a class="code" href="webalizer_8c.html#2c634f4ff63cf16a5bb219632d9da1f5">th_hit</a>[24], <a class="code" href="webalizer_8c.html#8d6ce1fa8aba3c7f1ed1c7e19ea0541c">th_file</a>[24],              <span class="comment">/* hourly total arrays      */</span>
<a name="l00199"></a>00199         <a class="code" href="webalizer_8c.html#cdb9ccdbdd487d188cd174056a7dcd80">th_page</a>[24];
<a name="l00200"></a>00200 
<a name="l00201"></a><a class="code" href="webalizer_8h.html#a063714cc339793854ef49bb72c4382b">00201</a> <span class="keywordtype">double</span>  <a class="code" href="webalizer_8c.html#a063714cc339793854ef49bb72c4382b">th_xfer</a>[24];
<a name="l00202"></a>00202 
<a name="l00203"></a><a class="code" href="webalizer_8h.html#3322d751ac470f626bc34fb8b34c1759">00203</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#4637ce886571ae33e34d7d0ae8d50df8">f_day</a>,<a class="code" href="webalizer_8c.html#3322d751ac470f626bc34fb8b34c1759">l_day</a>;                          <span class="comment">/* first/last day vars      */</span>
<a name="l00204"></a>00204 
<a name="l00205"></a><a class="code" href="webalizer_8c.html#fb4af3ebf8357e94b736496594995cee">00205</a> <span class="keyword">struct  </span>utsname <a class="code" href="webalizer_8c.html#fb4af3ebf8357e94b736496594995cee">system_info</a>;                  <span class="comment">/* system info structure    */</span>
<a name="l00206"></a>00206 
<a name="l00207"></a><a class="code" href="webalizer_8c.html#e29a508fc80a24e71cc41101f6bf9039">00207</a> u_long  <a class="code" href="webalizer_8c.html#e29a508fc80a24e71cc41101f6bf9039">ul_bogus</a> =0;                          <span class="comment">/* Dummy counter for groups */</span>
<a name="l00208"></a>00208 
<a name="l00209"></a><a class="code" href="webalizer_8h.html#b78a7a0970e517ad18adea541d2b2b32">00209</a> <span class="keyword">struct  </span><a class="code" href="structlog__struct.html">log_struct</a> <a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>;                   <span class="comment">/* expanded log storage     */</span>
<a name="l00210"></a>00210 
<a name="l00211"></a><a class="code" href="webalizer_8c.html#3c3ca8cc859a31aec6578f0dcf1b32a5">00211</a> time_t  <a class="code" href="webalizer_8c.html#3c3ca8cc859a31aec6578f0dcf1b32a5">now</a>;                                  <span class="comment">/* used by cur_time funct   */</span>
<a name="l00212"></a><a class="code" href="webalizer_8c.html#7f17db71b666ac0527009f1cd876cac0">00212</a> <span class="keyword">struct  </span>tm *<a class="code" href="webalizer_8c.html#7f17db71b666ac0527009f1cd876cac0">tp</a>;                               <span class="comment">/* to generate timestamp    */</span>
<a name="l00213"></a><a class="code" href="webalizer_8c.html#17cd1753a5a06a50ec97b8e85f56af0e">00213</a> <span class="keywordtype">char</span>    <a class="code" href="webalizer_8c.html#17cd1753a5a06a50ec97b8e85f56af0e">timestamp</a>[32];                        <span class="comment">/* for the reports          */</span>
<a name="l00214"></a>00214 
<a name="l00215"></a><a class="code" href="webalizer_8c.html#96781ba6a30d70f2b7f56fb409a3da01">00215</a> gzFile  <a class="code" href="webalizer_8c.html#96781ba6a30d70f2b7f56fb409a3da01">gzlog_fp</a>;                             <span class="comment">/* gzip logfile pointer     */</span>
<a name="l00216"></a><a class="code" href="webalizer_8c.html#a574e45a6e318dd8f45530c13db10cc1">00216</a> FILE    *<a class="code" href="webalizer_8c.html#a574e45a6e318dd8f45530c13db10cc1">log_fp</a>;                              <span class="comment">/* regular logfile pointer  */</span>
<a name="l00217"></a>00217 
<a name="l00218"></a><a class="code" href="webalizer_8c.html#09b4e72533ab279f7930a9a5e3ab050c">00218</a> <span class="keywordtype">char</span>    <a class="code" href="webalizer_8c.html#09b4e72533ab279f7930a9a5e3ab050c">buffer</a>[<a class="code" href="webalizer_8h.html#eca034f67218340ecb2261a22c2f3dcd">BUFSIZE</a>];                      <span class="comment">/* log file record buffer   */</span>
<a name="l00219"></a><a class="code" href="webalizer_8c.html#ee9788649de43fb36bc42d15b1c829ff">00219</a> <span class="keywordtype">char</span>    <a class="code" href="webalizer_8c.html#ee9788649de43fb36bc42d15b1c829ff">tmp_buf</a>[<a class="code" href="webalizer_8h.html#eca034f67218340ecb2261a22c2f3dcd">BUFSIZE</a>];                     <span class="comment">/* used to temp save above  */</span>
<a name="l00220"></a>00220 
<a name="l00221"></a><a class="code" href="webalizer_8h.html#acb9022e3fedc2d14e55e9854fa3cbcf">00221</a> <a class="code" href="structcountry__code.html">CLISTPTR</a> *<a class="code" href="webalizer_8c.html#acb9022e3fedc2d14e55e9854fa3cbcf">top_ctrys</a>    = NULL;                <span class="comment">/* Top countries table      */</span>
<a name="l00222"></a>00222 
<a name="l00223"></a><a class="code" href="webalizer_8c.html#0ca8208fe0ebf85a7d26cb53c31f8a78">00223</a> <span class="preprocessor">#define GZ_BUFSIZE 16384                      </span><span class="comment">/* our_getfs buffer size    */</span>
<a name="l00224"></a><a class="code" href="webalizer_8c.html#0f09c2c14de82a844b4cce5c76184709">00224</a> <span class="keywordtype">char</span>    <a class="code" href="webalizer_8c.html#0f09c2c14de82a844b4cce5c76184709">f_buf</a>[<a class="code" href="webalizer_8c.html#0ca8208fe0ebf85a7d26cb53c31f8a78">GZ_BUFSIZE</a>];                    <span class="comment">/* our_getfs buffer         */</span>
<a name="l00225"></a><a class="code" href="webalizer_8c.html#405a69d1287c4dd254d758f0e2114f60">00225</a> <span class="keywordtype">char</span>    *<a class="code" href="webalizer_8c.html#405a69d1287c4dd254d758f0e2114f60">f_cp</a>=<a class="code" href="webalizer_8c.html#0f09c2c14de82a844b4cce5c76184709">f_buf</a>+<a class="code" href="webalizer_8c.html#0ca8208fe0ebf85a7d26cb53c31f8a78">GZ_BUFSIZE</a>;               <span class="comment">/* pointer into the buffer  */</span>
<a name="l00226"></a><a class="code" href="webalizer_8c.html#912061ffd86d7c9c5d45a818091a1809">00226</a> <span class="keywordtype">int</span>     <a class="code" href="webalizer_8c.html#912061ffd86d7c9c5d45a818091a1809">f_end</a>;                                <span class="comment">/* count to end of buffer   */</span> 
<a name="l00227"></a>00227 
<a name="l00228"></a>00228 <span class="comment">/*********************************************/</span>
<a name="l00229"></a>00229 <span class="comment">/* MAIN - start here                         */</span>
<a name="l00230"></a>00230 <span class="comment">/*********************************************/</span>
<a name="l00231"></a>00231 
<a name="l00232"></a><a class="code" href="webalizer_8c.html#0ddf1224851353fc92bfbff6f499fa97">00232</a> <span class="keywordtype">int</span> <a class="code" href="webalizer_8c.html#0ddf1224851353fc92bfbff6f499fa97">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])
<a name="l00233"></a>00233 {
<a name="l00234"></a>00234    <span class="comment">/* Alloc memory for the 404 errors with MAXRESP size */</span>
<a name="l00235"></a>00235    <span class="keywordtype">void</span> * tmp_ptr = calloc(<a class="code" href="webalizer_8h.html#3d47d7a8b615ae32d0978491b0fdd2a7">MAXRESP</a>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structresponse__url.html">response_url</a>));
<a name="l00236"></a>00236    <span class="keywordflow">if</span> (tmp_ptr) {
<a name="l00237"></a>00237         <a class="code" href="webalizer_8h.html#a8ed05f974eff62796d7d6bb0863d253">respnotfound</a> = (<span class="keyword">struct </span>response_url *) tmp_ptr;
<a name="l00238"></a>00238    } <span class="keywordflow">else</span> {
<a name="l00239"></a>00239         fprintf(stderr, <span class="stringliteral">"ERROR: Can't allocate enough memory\n"</span>);
<a name="l00240"></a>00240         exit(0);
<a name="l00241"></a>00241    }
<a name="l00242"></a>00242    u_long maxresp = <a class="code" href="webalizer_8h.html#3d47d7a8b615ae32d0978491b0fdd2a7">MAXRESP</a>;             <span class="comment">/* set constant for realloc    */</span>
<a name="l00243"></a>00243    u_long z       = 0;                   <span class="comment">/* set generic 404 counter     */</span>
<a name="l00244"></a>00244    <span class="keywordtype">int</span> flag       = 0;                   <span class="comment">/* set flag for 404 counter    */</span>
<a name="l00245"></a>00245    <a class="code" href="webalizer_8h.html#520aedc681661bda91ae6b58266be08d">resp_counter</a>   = 0;                   <span class="comment">/* set total 404 counter       */</span>
<a name="l00246"></a>00246    <span class="keywordtype">int</span>      i;                           <span class="comment">/* generic counter             */</span>
<a name="l00247"></a>00247    <span class="keywordtype">char</span>     *cp1, *cp2, *cp3, *str;      <span class="comment">/* generic char pointers       */</span>
<a name="l00248"></a>00248    <a class="code" href="structnlist.html">NLISTPTR</a> lptr;                        <span class="comment">/* generic list pointer        */</span>
<a name="l00249"></a>00249 
<a name="l00250"></a>00250    <span class="keyword">extern</span> <span class="keywordtype">char</span> *optarg;                  <span class="comment">/* used for command line       */</span>
<a name="l00251"></a>00251    <span class="keyword">extern</span> <span class="keywordtype">int</span> optind;                    <span class="comment">/* parsing routine 'getopt'    */</span>
<a name="l00252"></a>00252    <span class="keyword">extern</span> <span class="keywordtype">int</span> opterr;
<a name="l00253"></a>00253 
<a name="l00254"></a>00254    time_t start_time, end_time;          <span class="comment">/* program timers              */</span>
<a name="l00255"></a>00255    <span class="keywordtype">float</span>  temp_time;                     <span class="comment">/* temporary time storage      */</span>
<a name="l00256"></a>00256    <span class="keyword">struct </span>tms     mytms;                 <span class="comment">/* bogus tms structure         */</span>
<a name="l00257"></a>00257 
<a name="l00258"></a>00258    <span class="keywordtype">int</span>    rec_year,rec_month=1,rec_day,rec_hour,rec_min,rec_sec;
<a name="l00259"></a>00259 
<a name="l00260"></a>00260    <span class="keywordtype">int</span>    good_rec    =0;                <span class="comment">/* 1 if we had a good record   */</span>
<a name="l00261"></a>00261    u_long total_rec   =0;                <span class="comment">/* Total Records Processed     */</span>
<a name="l00262"></a>00262    u_long total_ignore=0;                <span class="comment">/* Total Records Ignored       */</span>
<a name="l00263"></a>00263    u_long total_bad   =0;                <span class="comment">/* Total Bad Records           */</span>
<a name="l00264"></a>00264 
<a name="l00265"></a>00265    <span class="keywordtype">int</span>    max_ctry;                      <span class="comment">/* max countries defined       */</span>
<a name="l00266"></a>00266 
<a name="l00267"></a>00267    <span class="comment">/* month names used for parsing logfile (shouldn't be lang specific) */</span>
<a name="l00268"></a>00268    <span class="keywordtype">char</span> *log_month[12]={ <span class="stringliteral">"jan"</span>, <span class="stringliteral">"feb"</span>, <span class="stringliteral">"mar"</span>,
<a name="l00269"></a>00269                          <span class="stringliteral">"apr"</span>, <span class="stringliteral">"may"</span>, <span class="stringliteral">"jun"</span>,
<a name="l00270"></a>00270                          <span class="stringliteral">"jul"</span>, <span class="stringliteral">"aug"</span>, <span class="stringliteral">"sep"</span>,
<a name="l00271"></a>00271                          <span class="stringliteral">"oct"</span>, <span class="stringliteral">"nov"</span>, <span class="stringliteral">"dec"</span>};
<a name="l00272"></a>00272 
<a name="l00273"></a>00273    <span class="comment">/* initalize epoch */</span>
<a name="l00274"></a>00274    <a class="code" href="webalizer_8c.html#71f3fc3b6564ee11c34ff02cee2a3e05">epoch</a>=<a class="code" href="webalizer_8c.html#8fb8978d91b70fd80d00d381cb115731">jdate</a>(1,1,1970);                <span class="comment">/* used for timestamp adj.     */</span>
<a name="l00275"></a>00275 
<a name="l00276"></a>00276    <span class="comment">/* add default index. alias */</span>
<a name="l00277"></a>00277    <a class="code" href="linklist_8c.html#8839d62523e9b12655cca004617bbe77">add_nlist</a>(<span class="stringliteral">"index."</span>,&amp;<a class="code" href="linklist_8c.html#a35b4fc28f26c83f77336185f9aa7175">index_alias</a>);
<a name="l00278"></a>00278 
<a name="l00279"></a>00279    snprintf(<a class="code" href="webalizer_8c.html#ee9788649de43fb36bc42d15b1c829ff">tmp_buf</a>, <span class="keyword">sizeof</span>(<a class="code" href="webalizer_8c.html#ee9788649de43fb36bc42d15b1c829ff">tmp_buf</a>),<span class="stringliteral">"%s/webalizer.conf"</span>,ETCDIR);
<a name="l00280"></a>00280    <span class="comment">/* check for default config file */</span>
<a name="l00281"></a>00281    <span class="keywordflow">if</span> (!access(<span class="stringliteral">"webalizer.conf"</span>,F_OK))
<a name="l00282"></a>00282       <a class="code" href="webalizer_8c.html#7e50c67e6aba9c0c3025c04b0a7aedc4">get_config</a>(<span class="stringliteral">"webalizer.conf"</span>);
<a name="l00283"></a>00283    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!access(tmp_buf,F_OK))
<a name="l00284"></a>00284       <a class="code" href="webalizer_8c.html#7e50c67e6aba9c0c3025c04b0a7aedc4">get_config</a>(tmp_buf);
<a name="l00285"></a>00285 
<a name="l00286"></a>00286    <span class="comment">/* get command line options */</span>
<a name="l00287"></a>00287    opterr = 0;     <span class="comment">/* disable parser errors */</span>
<a name="l00288"></a>00288    <span class="keywordflow">while</span> ((i=getopt(argc,argv,<span class="stringliteral">"a:A:c:C:dD:e:E:fF:g:GhHiI:l:Lm:M:n:N:o:pP:qQr:R:s:S:t:Tu:U:vVx:XY"</span>))!=EOF)
<a name="l00289"></a>00289    {
<a name="l00290"></a>00290       <span class="keywordflow">switch</span> (i)
<a name="l00291"></a>00291       {
<a name="l00292"></a>00292         <span class="keywordflow">case</span> <span class="charliteral">'a'</span>: <a class="code" href="linklist_8c.html#8839d62523e9b12655cca004617bbe77">add_nlist</a>(optarg,&amp;<a class="code" href="linklist_8c.html#89feb23799329906fbd4a3d47a303027">hidden_agents</a>); <span class="keywordflow">break</span>; <span class="comment">/* Hide agents   */</span>
<a name="l00293"></a>00293         <span class="keywordflow">case</span> <span class="charliteral">'A'</span>: <a class="code" href="webalizer_8c.html#09d5297ba12ba78e65bcb4679036de17">ntop_agents</a>=atoi(optarg);  <span class="keywordflow">break</span>;  <span class="comment">/* Top agents          */</span>
<a name="l00294"></a>00294         <span class="keywordflow">case</span> <span class="charliteral">'c'</span>: <a class="code" href="webalizer_8c.html#7e50c67e6aba9c0c3025c04b0a7aedc4">get_config</a>(optarg);        <span class="keywordflow">break</span>;  <span class="comment">/* Config file         */</span>
<a name="l00295"></a>00295         <span class="keywordflow">case</span> <span class="charliteral">'C'</span>: <a class="code" href="webalizer_8c.html#fcd390bd7df1e721799f33f0ac87fdaf">ntop_ctrys</a>=atoi(optarg);   <span class="keywordflow">break</span>;  <span class="comment">/* Top countries       */</span>
<a name="l00296"></a>00296         <span class="keywordflow">case</span> <span class="charliteral">'d'</span>: <a class="code" href="webalizer_8c.html#4f7caf3ead45aac3963d1e354e820017">debug_mode</a>=1;              <span class="keywordflow">break</span>;  <span class="comment">/* Debug               */</span>
<a name="l00297"></a>00297         <span class="keywordflow">case</span> <span class="charliteral">'D'</span>: <a class="code" href="webalizer_8c.html#3cb74b5ee16f5910ee70cc4944d1300a">dns_cache</a>=optarg;          <span class="keywordflow">break</span>;  <span class="comment">/* DNS Cache filename  */</span>
<a name="l00298"></a>00298         <span class="keywordflow">case</span> <span class="charliteral">'e'</span>: <a class="code" href="webalizer_8c.html#a573c7e2a32733a06a3b0dbb9430569f">ntop_entry</a>=atoi(optarg);   <span class="keywordflow">break</span>;  <span class="comment">/* Top entry pages     */</span>
<a name="l00299"></a>00299         <span class="keywordflow">case</span> <span class="charliteral">'E'</span>: <a class="code" href="webalizer_8c.html#9d1968145275f8eb19935b5c6d5b2848">ntop_exit</a>=atoi(optarg);    <span class="keywordflow">break</span>;  <span class="comment">/* Top exit pages      */</span>
<a name="l00300"></a>00300         <span class="keywordflow">case</span> <span class="charliteral">'f'</span>: <a class="code" href="webalizer_8c.html#23652bde57737d1f6f700f29c4762728">fold_seq_err</a>=1;            <span class="keywordflow">break</span>;  <span class="comment">/* Fold sequence errs  */</span>
<a name="l00301"></a>00301         <span class="keywordflow">case</span> <span class="charliteral">'F'</span>: <a class="code" href="webalizer_8c.html#d1e2a6d9014a2af70dfa80ce7b69d4b0">log_type</a>=(optarg[0]==<span class="charliteral">'f'</span>)?
<a name="l00302"></a>00302                    <a class="code" href="webalizer_8h.html#cf5d4c2811adb735aaf5b32f62cc3cea">LOG_FTP</a>:(optarg[0]==<span class="charliteral">'s'</span>)?
<a name="l00303"></a>00303                    <a class="code" href="webalizer_8h.html#43821087b540ecbc400b7cef8ab10be0">LOG_SQUID</a>:<a class="code" href="webalizer_8h.html#5ce0d49d0e92ba00b7385ef68d26b51a">LOG_CLF</a>;        <span class="keywordflow">break</span>;  <span class="comment">/* define log type     */</span>
<a name="l00304"></a>00304         <span class="keywordflow">case</span> <span class="charliteral">'g'</span>: <a class="code" href="webalizer_8c.html#3b91bd084088b32764aaa00f48083faf">group_domains</a>=atoi(optarg); <span class="keywordflow">break</span>; <span class="comment">/* GroupDomains (0=no) */</span>
<a name="l00305"></a>00305         <span class="keywordflow">case</span> <span class="charliteral">'G'</span>: <a class="code" href="webalizer_8c.html#ef88d69bc7f6d6214835f0f15ef4522a">hourly_graph</a>=0;            <span class="keywordflow">break</span>;  <span class="comment">/* no hourly graph     */</span>
<a name="l00306"></a>00306         <span class="keywordflow">case</span> <span class="charliteral">'h'</span>: <a class="code" href="webalizer_8c.html#beb1db8f30c512b9050440ec49248364">print_opts</a>(argv[0]);       <span class="keywordflow">break</span>;  <span class="comment">/* help                */</span>
<a name="l00307"></a>00307         <span class="keywordflow">case</span> <span class="charliteral">'H'</span>: <a class="code" href="webalizer_8c.html#6359837576bb8bf34e8b6984cee1e53a">hourly_stats</a>=0;            <span class="keywordflow">break</span>;  <span class="comment">/* no hourly stats     */</span>
<a name="l00308"></a>00308         <span class="keywordflow">case</span> <span class="charliteral">'i'</span>: <a class="code" href="webalizer_8c.html#9c25fea667217c12ecade9cfac496daa">ignore_hist</a>=1;             <span class="keywordflow">break</span>;  <span class="comment">/* Ignore history      */</span>
<a name="l00309"></a>00309         <span class="keywordflow">case</span> <span class="charliteral">'I'</span>: <a class="code" href="linklist_8c.html#8839d62523e9b12655cca004617bbe77">add_nlist</a>(optarg,&amp;<a class="code" href="linklist_8c.html#a35b4fc28f26c83f77336185f9aa7175">index_alias</a>); <span class="keywordflow">break</span>; <span class="comment">/* Index alias     */</span>
<a name="l00310"></a>00310         <span class="keywordflow">case</span> <span class="charliteral">'l'</span>: <a class="code" href="webalizer_8c.html#b0e6606dc823003635fbd6408bd03439">graph_lines</a>=atoi(optarg);  <span class="keywordflow">break</span>;  <span class="comment">/* Graph Lines         */</span>
<a name="l00311"></a>00311         <span class="keywordflow">case</span> <span class="charliteral">'L'</span>: <a class="code" href="webalizer_8c.html#8209c1ed16bfdf4913b7837d8d0b8520">graph_legend</a>=0;            <span class="keywordflow">break</span>;  <span class="comment">/* Graph Legends       */</span>
<a name="l00312"></a>00312         <span class="keywordflow">case</span> <span class="charliteral">'m'</span>: <a class="code" href="webalizer_8c.html#95c29ea4f1f207b5be0cdd3cefa935d1">visit_timeout</a>=atoi(optarg); <span class="keywordflow">break</span>; <span class="comment">/* Visit Timeout       */</span>
<a name="l00313"></a>00313         <span class="keywordflow">case</span> <span class="charliteral">'M'</span>: <a class="code" href="webalizer_8c.html#23d6ba920f8b5ddaea1f3e92958bdaba">mangle_agent</a>=atoi(optarg); <span class="keywordflow">break</span>;  <span class="comment">/* mangle user agents  */</span>
<a name="l00314"></a>00314         <span class="keywordflow">case</span> <span class="charliteral">'n'</span>: <a class="code" href="webalizer_8c.html#674a1f0ec86ffb26578c11999c89a3c0">hname</a>=optarg;              <span class="keywordflow">break</span>;  <span class="comment">/* Hostname            */</span>
<a name="l00315"></a>00315         <span class="keywordflow">case</span> <span class="charliteral">'N'</span>: <a class="code" href="webalizer_8c.html#90492045766d92f08b5e160135ade65c">dns_children</a>=atoi(optarg); <span class="keywordflow">break</span>;  <span class="comment">/* # of DNS children   */</span>
<a name="l00316"></a>00316         <span class="keywordflow">case</span> <span class="charliteral">'o'</span>: <a class="code" href="webalizer_8c.html#6910a5df32ce9909ffbacfafaa6e3645">out_dir</a>=optarg;            <span class="keywordflow">break</span>;  <span class="comment">/* Output directory    */</span>
<a name="l00317"></a>00317         <span class="keywordflow">case</span> <span class="charliteral">'p'</span>: <a class="code" href="webalizer_8c.html#534a10f9409e025831882efe4a58f959">incremental</a>=1;             <span class="keywordflow">break</span>;  <span class="comment">/* Incremental run     */</span>
<a name="l00318"></a>00318         <span class="keywordflow">case</span> <span class="charliteral">'P'</span>: <a class="code" href="linklist_8c.html#8839d62523e9b12655cca004617bbe77">add_nlist</a>(optarg,&amp;<a class="code" href="linklist_8c.html#556b3c90c27ba5b38626945734914353">page_type</a>); <span class="keywordflow">break</span>; <span class="comment">/* page view types   */</span>
<a name="l00319"></a>00319         <span class="keywordflow">case</span> <span class="charliteral">'q'</span>: <a class="code" href="webalizer_8c.html#0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>=1;                 <span class="keywordflow">break</span>;  <span class="comment">/* Quiet (verbose=1)   */</span>
<a name="l00320"></a>00320         <span class="keywordflow">case</span> <span class="charliteral">'Q'</span>: <a class="code" href="webalizer_8c.html#0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>=0;                 <span class="keywordflow">break</span>;  <span class="comment">/* Really Quiet        */</span>
<a name="l00321"></a>00321         <span class="keywordflow">case</span> <span class="charliteral">'r'</span>: <a class="code" href="linklist_8c.html#8839d62523e9b12655cca004617bbe77">add_nlist</a>(optarg,&amp;<a class="code" href="linklist_8c.html#7f8ec975eaff8227a3e09efb17d3e064">hidden_refs</a>);   <span class="keywordflow">break</span>; <span class="comment">/* Hide referrer */</span>
<a name="l00322"></a>00322         <span class="keywordflow">case</span> <span class="charliteral">'R'</span>: <a class="code" href="webalizer_8c.html#78414d5060b40b23c1fbb95546fb74d3">ntop_refs</a>=atoi(optarg);    <span class="keywordflow">break</span>;  <span class="comment">/* Top referrers       */</span>
<a name="l00323"></a>00323         <span class="keywordflow">case</span> <span class="charliteral">'s'</span>: <a class="code" href="linklist_8c.html#8839d62523e9b12655cca004617bbe77">add_nlist</a>(optarg,&amp;<a class="code" href="linklist_8c.html#96bde86b735761b0b2b03d057d7bddfd">hidden_sites</a>);  <span class="keywordflow">break</span>; <span class="comment">/* Hide site     */</span>
<a name="l00324"></a>00324         <span class="keywordflow">case</span> <span class="charliteral">'S'</span>: <a class="code" href="webalizer_8c.html#57531d5f29d4cbdaac1f25e52f4a069d">ntop_sites</a>=atoi(optarg);   <span class="keywordflow">break</span>;  <span class="comment">/* Top sites           */</span>
<a name="l00325"></a>00325         <span class="keywordflow">case</span> <span class="charliteral">'t'</span>: <a class="code" href="lang_8h.html#56970821c884da0e4d8fd75e51bc37d9">msg_title</a>=optarg;          <span class="keywordflow">break</span>;  <span class="comment">/* Report title        */</span>
<a name="l00326"></a>00326         <span class="keywordflow">case</span> <span class="charliteral">'T'</span>: <a class="code" href="webalizer_8c.html#445501b8b84e1293820c0142acd34113">time_me</a>=1;                 <span class="keywordflow">break</span>;  <span class="comment">/* TimeMe              */</span>
<a name="l00327"></a>00327         <span class="keywordflow">case</span> <span class="charliteral">'u'</span>: <a class="code" href="linklist_8c.html#8839d62523e9b12655cca004617bbe77">add_nlist</a>(optarg,&amp;<a class="code" href="linklist_8c.html#fb86638f144a8726901b06185e2415af">hidden_urls</a>);   <span class="keywordflow">break</span>; <span class="comment">/* hide URL      */</span>
<a name="l00328"></a>00328         <span class="keywordflow">case</span> <span class="charliteral">'U'</span>: <a class="code" href="webalizer_8c.html#a450ef7a6e4e6148f9cb184144a7c8cc">ntop_urls</a>=atoi(optarg);    <span class="keywordflow">break</span>;  <span class="comment">/* Top urls            */</span>
<a name="l00329"></a>00329         <span class="keywordflow">case</span> <span class="charliteral">'v'</span>:
<a name="l00330"></a>00330         <span class="keywordflow">case</span> <span class="charliteral">'V'</span>: <a class="code" href="webalizer_8c.html#6302aaae12249e8ea16bfdc7de892f21">print_version</a>();           <span class="keywordflow">break</span>;  <span class="comment">/* Version             */</span>
<a name="l00331"></a>00331         <span class="keywordflow">case</span> <span class="charliteral">'x'</span>: <a class="code" href="webalizer_8c.html#ef5a49b05e1bff557f85797e61dcd23a">html_ext</a>=optarg;           <span class="keywordflow">break</span>;  <span class="comment">/* HTML file extension */</span>
<a name="l00332"></a>00332         <span class="keywordflow">case</span> <span class="charliteral">'X'</span>: <a class="code" href="webalizer_8c.html#a77fbf13eba0ffbb98b893c0089cb49b">hide_sites</a>=1;              <span class="keywordflow">break</span>;  <span class="comment">/* Hide ind. sites     */</span>
<a name="l00333"></a>00333         <span class="keywordflow">case</span> <span class="charliteral">'Y'</span>: <a class="code" href="webalizer_8c.html#f1ef30cbdcfd1e369800371e296aaec2">ctry_graph</a>=0;              <span class="keywordflow">break</span>;  <span class="comment">/* Supress ctry graph  */</span>
<a name="l00334"></a>00334       }
<a name="l00335"></a>00335    }
<a name="l00336"></a>00336 
<a name="l00337"></a>00337    <span class="keywordflow">if</span> (argc - optind != 0) <a class="code" href="webalizer_8c.html#9db6dddd9890ca88ccca763b0533919b">log_fname</a> = argv[optind];
<a name="l00338"></a>00338    <span class="keywordflow">if</span> ( <a class="code" href="webalizer_8c.html#9db6dddd9890ca88ccca763b0533919b">log_fname</a> &amp;&amp; (<a class="code" href="webalizer_8c.html#9db6dddd9890ca88ccca763b0533919b">log_fname</a>[0]==<span class="charliteral">'-'</span>)) <a class="code" href="webalizer_8c.html#9db6dddd9890ca88ccca763b0533919b">log_fname</a>=NULL; <span class="comment">/* force STDIN?   */</span>
<a name="l00339"></a>00339 
<a name="l00340"></a>00340    <span class="comment">/* check for gzipped file - .gz */</span>
<a name="l00341"></a>00341    <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#9db6dddd9890ca88ccca763b0533919b">log_fname</a>) <span class="keywordflow">if</span> (!strcmp((<a class="code" href="webalizer_8c.html#9db6dddd9890ca88ccca763b0533919b">log_fname</a>+strlen(<a class="code" href="webalizer_8c.html#9db6dddd9890ca88ccca763b0533919b">log_fname</a>)-3),<span class="stringliteral">".gz"</span>)) <a class="code" href="webalizer_8c.html#480128e1291f32b04678ddac9dc69457">gz_log</a>=1;
<a name="l00342"></a>00342 
<a name="l00343"></a>00343    <span class="comment">/* setup our internal variables */</span>
<a name="l00344"></a>00344    <a class="code" href="webalizer_8c.html#c13990c5857877d516d60af22bfbc492">init_counters</a>();                      <span class="comment">/* initalize main counters         */</span>
<a name="l00345"></a>00345 
<a name="l00346"></a>00346    <span class="keywordflow">if</span> (<a class="code" href="linklist_8c.html#556b3c90c27ba5b38626945734914353">page_type</a>==NULL)                  <span class="comment">/* check if page types present     */</span>
<a name="l00347"></a>00347    {
<a name="l00348"></a>00348       <span class="keywordflow">if</span> ((<a class="code" href="webalizer_8c.html#d1e2a6d9014a2af70dfa80ce7b69d4b0">log_type</a> == <a class="code" href="webalizer_8h.html#5ce0d49d0e92ba00b7385ef68d26b51a">LOG_CLF</a>) || (<a class="code" href="webalizer_8c.html#d1e2a6d9014a2af70dfa80ce7b69d4b0">log_type</a> == <a class="code" href="webalizer_8h.html#43821087b540ecbc400b7cef8ab10be0">LOG_SQUID</a>))
<a name="l00349"></a>00349       {
<a name="l00350"></a>00350          <a class="code" href="linklist_8c.html#8839d62523e9b12655cca004617bbe77">add_nlist</a>(<span class="stringliteral">"htm*"</span>  ,&amp;<a class="code" href="linklist_8c.html#556b3c90c27ba5b38626945734914353">page_type</a>); <span class="comment">/* if no page types specified, we  */</span>
<a name="l00351"></a>00351          <a class="code" href="linklist_8c.html#8839d62523e9b12655cca004617bbe77">add_nlist</a>(<span class="stringliteral">"cgi"</span>   ,&amp;<a class="code" href="linklist_8c.html#556b3c90c27ba5b38626945734914353">page_type</a>); <span class="comment">/* use the default ones here...    */</span>
<a name="l00352"></a>00352          <span class="keywordflow">if</span> (!<a class="code" href="linklist_8c.html#29bda5ebb6dd2f9b19d8f9519eaf94ff">isinlist</a>(<a class="code" href="linklist_8c.html#556b3c90c27ba5b38626945734914353">page_type</a>,<a class="code" href="webalizer_8c.html#ef5a49b05e1bff557f85797e61dcd23a">html_ext</a>)) <a class="code" href="linklist_8c.html#8839d62523e9b12655cca004617bbe77">add_nlist</a>(<a class="code" href="webalizer_8c.html#ef5a49b05e1bff557f85797e61dcd23a">html_ext</a>,&amp;<a class="code" href="linklist_8c.html#556b3c90c27ba5b38626945734914353">page_type</a>);
<a name="l00353"></a>00353       }
<a name="l00354"></a>00354       <span class="keywordflow">else</span> <a class="code" href="linklist_8c.html#8839d62523e9b12655cca004617bbe77">add_nlist</a>(<span class="stringliteral">"txt"</span> ,&amp;<a class="code" href="linklist_8c.html#556b3c90c27ba5b38626945734914353">page_type</a>); <span class="comment">/* FTP logs default to .txt        */</span>
<a name="l00355"></a>00355    }
<a name="l00356"></a>00356 
<a name="l00357"></a>00357    <span class="keywordflow">for</span> (max_ctry=0;<a class="code" href="lang_8h.html#2da4e4ffd517ae749587bd8692434663">ctry</a>[max_ctry].<a class="code" href="structcountry__code.html#835c53390df57142797eae431d0d7a8b">desc</a>;max_ctry++);
<a name="l00358"></a>00358    <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#fcd390bd7df1e721799f33f0ac87fdaf">ntop_ctrys</a> &gt; max_ctry) <a class="code" href="webalizer_8c.html#fcd390bd7df1e721799f33f0ac87fdaf">ntop_ctrys</a> = max_ctry;   <span class="comment">/* force upper limit */</span>
<a name="l00359"></a>00359    <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#b0e6606dc823003635fbd6408bd03439">graph_lines</a>&gt; 20)       <a class="code" href="webalizer_8c.html#b0e6606dc823003635fbd6408bd03439">graph_lines</a>= 20;         <span class="comment">/* keep graphs sane! */</span>
<a name="l00360"></a>00360 
<a name="l00361"></a>00361    <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#d1e2a6d9014a2af70dfa80ce7b69d4b0">log_type</a> == <a class="code" href="webalizer_8h.html#cf5d4c2811adb735aaf5b32f62cc3cea">LOG_FTP</a>)
<a name="l00362"></a>00362    {
<a name="l00363"></a>00363       <span class="comment">/* disable stuff for ftp logs */</span>
<a name="l00364"></a>00364       <a class="code" href="webalizer_8c.html#a573c7e2a32733a06a3b0dbb9430569f">ntop_entry</a>=<a class="code" href="webalizer_8c.html#9d1968145275f8eb19935b5c6d5b2848">ntop_exit</a>=0;
<a name="l00365"></a>00365       <a class="code" href="webalizer_8c.html#57e3ec40e1f85e8b2620950dc43b753f">ntop_search</a>=0;
<a name="l00366"></a>00366    }
<a name="l00367"></a>00367    <span class="keywordflow">else</span>
<a name="l00368"></a>00368    {
<a name="l00369"></a>00369       <span class="keywordflow">if</span> (<a class="code" href="linklist_8c.html#d93c06cbf86de996601e602d07da3663">search_list</a>==NULL)
<a name="l00370"></a>00370       {
<a name="l00371"></a>00371          <span class="comment">/* If no search engines defined, define some :) */</span>
<a name="l00372"></a>00372          <a class="code" href="linklist_8c.html#7a76399c20af4803b0efcc757733039d">add_glist</a>(<span class="stringliteral">"google.de      q="</span>      ,&amp;<a class="code" href="linklist_8c.html#d93c06cbf86de996601e602d07da3663">search_list</a>);
<a name="l00373"></a>00373          <a class="code" href="linklist_8c.html#7a76399c20af4803b0efcc757733039d">add_glist</a>(<span class="stringliteral">"google.at      q="</span>      ,&amp;<a class="code" href="linklist_8c.html#d93c06cbf86de996601e602d07da3663">search_list</a>);
<a name="l00374"></a>00374          <a class="code" href="linklist_8c.html#7a76399c20af4803b0efcc757733039d">add_glist</a>(<span class="stringliteral">"google.ch      q="</span>      ,&amp;<a class="code" href="linklist_8c.html#d93c06cbf86de996601e602d07da3663">search_list</a>);
<a name="l00375"></a>00375          <a class="code" href="linklist_8c.html#7a76399c20af4803b0efcc757733039d">add_glist</a>(<span class="stringliteral">"google.com     q="</span>      ,&amp;<a class="code" href="linklist_8c.html#d93c06cbf86de996601e602d07da3663">search_list</a>);
<a name="l00376"></a>00376          <a class="code" href="linklist_8c.html#7a76399c20af4803b0efcc757733039d">add_glist</a>(<span class="stringliteral">"yahoo.de       p="</span>      ,&amp;<a class="code" href="linklist_8c.html#d93c06cbf86de996601e602d07da3663">search_list</a>);
<a name="l00377"></a>00377          <a class="code" href="linklist_8c.html#7a76399c20af4803b0efcc757733039d">add_glist</a>(<span class="stringliteral">"yahoo.com      p="</span>      ,&amp;<a class="code" href="linklist_8c.html#d93c06cbf86de996601e602d07da3663">search_list</a>);
<a name="l00378"></a>00378          <a class="code" href="linklist_8c.html#7a76399c20af4803b0efcc757733039d">add_glist</a>(<span class="stringliteral">"altavista.com  q="</span>      ,&amp;<a class="code" href="linklist_8c.html#d93c06cbf86de996601e602d07da3663">search_list</a>);
<a name="l00379"></a>00379          <a class="code" href="linklist_8c.html#7a76399c20af4803b0efcc757733039d">add_glist</a>(<span class="stringliteral">"eureka.com     q="</span>      ,&amp;<a class="code" href="linklist_8c.html#d93c06cbf86de996601e602d07da3663">search_list</a>);
<a name="l00380"></a>00380          <a class="code" href="linklist_8c.html#7a76399c20af4803b0efcc757733039d">add_glist</a>(<span class="stringliteral">"lycos.com      query="</span>  ,&amp;<a class="code" href="linklist_8c.html#d93c06cbf86de996601e602d07da3663">search_list</a>);
<a name="l00381"></a>00381          <a class="code" href="linklist_8c.html#7a76399c20af4803b0efcc757733039d">add_glist</a>(<span class="stringliteral">"hotbot.com     MT="</span>     ,&amp;<a class="code" href="linklist_8c.html#d93c06cbf86de996601e602d07da3663">search_list</a>);
<a name="l00382"></a>00382          <a class="code" href="linklist_8c.html#7a76399c20af4803b0efcc757733039d">add_glist</a>(<span class="stringliteral">"msn.com        MT="</span>     ,&amp;<a class="code" href="linklist_8c.html#d93c06cbf86de996601e602d07da3663">search_list</a>);
<a name="l00383"></a>00383          <a class="code" href="linklist_8c.html#7a76399c20af4803b0efcc757733039d">add_glist</a>(<span class="stringliteral">"infoseek.com   qt="</span>     ,&amp;<a class="code" href="linklist_8c.html#d93c06cbf86de996601e602d07da3663">search_list</a>);
<a name="l00384"></a>00384          <a class="code" href="linklist_8c.html#7a76399c20af4803b0efcc757733039d">add_glist</a>(<span class="stringliteral">"webcrawler searchText="</span> ,&amp;<a class="code" href="linklist_8c.html#d93c06cbf86de996601e602d07da3663">search_list</a>);
<a name="l00385"></a>00385          <a class="code" href="linklist_8c.html#7a76399c20af4803b0efcc757733039d">add_glist</a>(<span class="stringliteral">"excite         search="</span> ,&amp;<a class="code" href="linklist_8c.html#d93c06cbf86de996601e602d07da3663">search_list</a>);
<a name="l00386"></a>00386          <a class="code" href="linklist_8c.html#7a76399c20af4803b0efcc757733039d">add_glist</a>(<span class="stringliteral">"netscape.com   search="</span> ,&amp;<a class="code" href="linklist_8c.html#d93c06cbf86de996601e602d07da3663">search_list</a>);
<a name="l00387"></a>00387          <a class="code" href="linklist_8c.html#7a76399c20af4803b0efcc757733039d">add_glist</a>(<span class="stringliteral">"mamma.com      query="</span>  ,&amp;<a class="code" href="linklist_8c.html#d93c06cbf86de996601e602d07da3663">search_list</a>);
<a name="l00388"></a>00388          <a class="code" href="linklist_8c.html#7a76399c20af4803b0efcc757733039d">add_glist</a>(<span class="stringliteral">"alltheweb.com  query="</span>  ,&amp;<a class="code" href="linklist_8c.html#d93c06cbf86de996601e602d07da3663">search_list</a>);
<a name="l00389"></a>00389          <a class="code" href="linklist_8c.html#7a76399c20af4803b0efcc757733039d">add_glist</a>(<span class="stringliteral">"northernlight.com qr="</span>  ,&amp;<a class="code" href="linklist_8c.html#d93c06cbf86de996601e602d07da3663">search_list</a>);
<a name="l00390"></a>00390 
<a name="l00391"></a>00391       }
<a name="l00392"></a>00392    }
<a name="l00393"></a>00393 
<a name="l00394"></a>00394    <span class="comment">/* ensure entry/exits don't exceed urls */</span>
<a name="l00395"></a>00395    i=(<a class="code" href="webalizer_8c.html#a450ef7a6e4e6148f9cb184144a7c8cc">ntop_urls</a>&gt;<a class="code" href="webalizer_8c.html#21acc4795c6bb4027a1bd2ad038fe3fa">ntop_urlsK</a>)?<a class="code" href="webalizer_8c.html#a450ef7a6e4e6148f9cb184144a7c8cc">ntop_urls</a>:<a class="code" href="webalizer_8c.html#21acc4795c6bb4027a1bd2ad038fe3fa">ntop_urlsK</a>;
<a name="l00396"></a>00396    <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#a573c7e2a32733a06a3b0dbb9430569f">ntop_entry</a>&gt;i) <a class="code" href="webalizer_8c.html#a573c7e2a32733a06a3b0dbb9430569f">ntop_entry</a>=i;
<a name="l00397"></a>00397    <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#9d1968145275f8eb19935b5c6d5b2848">ntop_exit</a>&gt;i)  <a class="code" href="webalizer_8c.html#9d1968145275f8eb19935b5c6d5b2848">ntop_exit</a>=i;
<a name="l00398"></a>00398 
<a name="l00399"></a>00399    <span class="keywordflow">for</span> (i=0;i&lt;<a class="code" href="webalizer_8h.html#381dfed3a446e2b49171f4593a701df8">MAXHASH</a>;i++)
<a name="l00400"></a>00400    {
<a name="l00401"></a>00401       <a class="code" href="hashtab_8c.html#408742678920fdb90b2926c215e8e19c">sm_htab</a>[i]=<a class="code" href="hashtab_8c.html#e5ddad8435a9d403e79f4bd320fea151">sd_htab</a>[i]=NULL;        <span class="comment">/* initalize hash tables           */</span>
<a name="l00402"></a>00402       <a class="code" href="hashtab_8c.html#2f99d64abd1711a4b10ee71d070811a7">um_htab</a>[i]=NULL;
<a name="l00403"></a>00403       <a class="code" href="hashtab_8c.html#4b36877a2219872c641eb9a58ae45ce8">rm_htab</a>[i]=NULL;
<a name="l00404"></a>00404       <a class="code" href="hashtab_8c.html#4886dbd661ad553906dc83e1a8031316">am_htab</a>[i]=NULL;
<a name="l00405"></a>00405       <a class="code" href="hashtab_8c.html#e9a8ef54a4b421e3d16dc313f162ccff">sr_htab</a>[i]=NULL;
<a name="l00406"></a>00406    }
<a name="l00407"></a>00407 
<a name="l00408"></a>00408    <span class="comment">/* Be polite and announce yourself... */</span>
<a name="l00409"></a>00409    <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>&gt;1)
<a name="l00410"></a>00410    {
<a name="l00411"></a>00411       uname(&amp;<a class="code" href="webalizer_8c.html#fb4af3ebf8357e94b736496594995cee">system_info</a>);
<a name="l00412"></a>00412       printf(<span class="stringliteral">"OOS [Webalizer] V%s-%s (%s %s) %s\n"</span>,
<a name="l00413"></a>00413               <a class="code" href="webalizer_8c.html#56abfaab87c46691c1ef3ad0df23e864">version</a>,<a class="code" href="webalizer_8c.html#59179d90a91f573f3c081592845ee19c">editlvl</a>,<a class="code" href="webalizer_8c.html#fb4af3ebf8357e94b736496594995cee">system_info</a>.sysname,
<a name="l00414"></a>00414               <a class="code" href="webalizer_8c.html#fb4af3ebf8357e94b736496594995cee">system_info</a>.release,language);
<a name="l00415"></a>00415       printf(<span class="stringliteral">"Webalizer V2.01-10 (Linux 2.6.13-15-default) German \n"</span>);
<a name="l00416"></a>00416       printf(<span class="stringliteral">"Webalizer Xtended RB13 patch implemented (22-May-2006)\n"</span>);
<a name="l00417"></a>00417    }
<a name="l00418"></a>00418 
<a name="l00419"></a>00419 <span class="preprocessor">#ifndef USE_DNS</span>
<a name="l00420"></a>00420 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (strstr(argv[0],<span class="stringliteral">"webazolver"</span>)!=0)
<a name="l00421"></a>00421    {
<a name="l00422"></a>00422       printf(<span class="stringliteral">"DNS support not present, aborting...\n"</span>);
<a name="l00423"></a>00423       printf(<span class="stringliteral">"Webalizer Xtended RB13 patch implemented (22-May-2006)\n"</span>);
<a name="l00424"></a>00424 
<a name="l00425"></a>00425       exit(1);
<a name="l00426"></a>00426    }
<a name="l00427"></a>00427 <span class="preprocessor">#endif  </span><span class="comment">/* USE_DNS */</span>
<a name="l00428"></a>00428 
<a name="l00429"></a>00429    <span class="comment">/* open log file */</span>
<a name="l00430"></a>00430    <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#480128e1291f32b04678ddac9dc69457">gz_log</a>)
<a name="l00431"></a>00431    {
<a name="l00432"></a>00432       <a class="code" href="webalizer_8c.html#96781ba6a30d70f2b7f56fb409a3da01">gzlog_fp</a> = gzopen(<a class="code" href="webalizer_8c.html#9db6dddd9890ca88ccca763b0533919b">log_fname</a>,<span class="stringliteral">"rb"</span>);
<a name="l00433"></a>00433       <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#96781ba6a30d70f2b7f56fb409a3da01">gzlog_fp</a>==Z_NULL)
<a name="l00434"></a>00434       {
<a name="l00435"></a>00435          <span class="comment">/* Error: Can't open log file ... */</span>
<a name="l00436"></a>00436          fprintf(stderr, <span class="stringliteral">"%s %s\n"</span>,msg_log_err,<a class="code" href="webalizer_8c.html#9db6dddd9890ca88ccca763b0533919b">log_fname</a>);
<a name="l00437"></a>00437          exit(1);
<a name="l00438"></a>00438       }
<a name="l00439"></a>00439    }
<a name="l00440"></a>00440    <span class="keywordflow">else</span>
<a name="l00441"></a>00441    {
<a name="l00442"></a>00442       <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#9db6dddd9890ca88ccca763b0533919b">log_fname</a>)
<a name="l00443"></a>00443       {
<a name="l00444"></a>00444          <a class="code" href="webalizer_8c.html#a574e45a6e318dd8f45530c13db10cc1">log_fp</a> = fopen(<a class="code" href="webalizer_8c.html#9db6dddd9890ca88ccca763b0533919b">log_fname</a>,<span class="stringliteral">"r"</span>);
<a name="l00445"></a>00445          <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#a574e45a6e318dd8f45530c13db10cc1">log_fp</a>==NULL)
<a name="l00446"></a>00446          {
<a name="l00447"></a>00447             <span class="comment">/* Error: Can't open log file ... */</span>
<a name="l00448"></a>00448             fprintf(stderr, <span class="stringliteral">"%s %s\n"</span>,msg_log_err,<a class="code" href="webalizer_8c.html#9db6dddd9890ca88ccca763b0533919b">log_fname</a>);
<a name="l00449"></a>00449             exit(1);
<a name="l00450"></a>00450          }
<a name="l00451"></a>00451       }
<a name="l00452"></a>00452    }
<a name="l00453"></a>00453 
<a name="l00454"></a>00454    <span class="comment">/* Using logfile ... */</span>
<a name="l00455"></a>00455    <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>&gt;1)
<a name="l00456"></a>00456    {
<a name="l00457"></a>00457       printf(<span class="stringliteral">"%s %s ("</span>,msg_log_use,<a class="code" href="webalizer_8c.html#9db6dddd9890ca88ccca763b0533919b">log_fname</a>?<a class="code" href="webalizer_8c.html#9db6dddd9890ca88ccca763b0533919b">log_fname</a>:<span class="stringliteral">"STDIN"</span>);
<a name="l00458"></a>00458       <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#480128e1291f32b04678ddac9dc69457">gz_log</a>) printf(<span class="stringliteral">"gzip-"</span>);
<a name="l00459"></a>00459       <span class="keywordflow">switch</span> (<a class="code" href="webalizer_8c.html#d1e2a6d9014a2af70dfa80ce7b69d4b0">log_type</a>)
<a name="l00460"></a>00460       {
<a name="l00461"></a>00461          <span class="comment">/* display log file type hint */</span>
<a name="l00462"></a>00462          <span class="keywordflow">case</span> <a class="code" href="webalizer_8h.html#5ce0d49d0e92ba00b7385ef68d26b51a">LOG_CLF</a>:   printf(<span class="stringliteral">"clf)\n"</span>);   <span class="keywordflow">break</span>;
<a name="l00463"></a>00463          <span class="keywordflow">case</span> <a class="code" href="webalizer_8h.html#cf5d4c2811adb735aaf5b32f62cc3cea">LOG_FTP</a>:   printf(<span class="stringliteral">"ftp)\n"</span>);   <span class="keywordflow">break</span>;
<a name="l00464"></a>00464          <span class="keywordflow">case</span> <a class="code" href="webalizer_8h.html#43821087b540ecbc400b7cef8ab10be0">LOG_SQUID</a>: printf(<span class="stringliteral">"squid)\n"</span>); <span class="keywordflow">break</span>;
<a name="l00465"></a>00465       }
<a name="l00466"></a>00466    }
<a name="l00467"></a>00467 
<a name="l00468"></a>00468    <span class="comment">/* switch directories if needed */</span>
<a name="l00469"></a>00469    <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#6910a5df32ce9909ffbacfafaa6e3645">out_dir</a>)
<a name="l00470"></a>00470    {
<a name="l00471"></a>00471       <span class="keywordflow">if</span> (chdir(<a class="code" href="webalizer_8c.html#6910a5df32ce9909ffbacfafaa6e3645">out_dir</a>) != 0)
<a name="l00472"></a>00472       {
<a name="l00473"></a>00473          <span class="comment">/* Error: Can't change directory to ... */</span>
<a name="l00474"></a>00474          fprintf(stderr, <span class="stringliteral">"%s %s\n"</span>,msg_dir_err,out_dir);
<a name="l00475"></a>00475          exit(1);
<a name="l00476"></a>00476       }
<a name="l00477"></a>00477    }
<a name="l00478"></a>00478 
<a name="l00479"></a>00479 <span class="preprocessor">#ifdef USE_DNS</span>
<a name="l00480"></a>00480 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (strstr(argv[0],<span class="stringliteral">"webazolver"</span>)!=0)
<a name="l00481"></a>00481    {
<a name="l00482"></a>00482       <span class="keywordflow">if</span> (!<a class="code" href="webalizer_8c.html#90492045766d92f08b5e160135ade65c">dns_children</a>) <a class="code" href="webalizer_8c.html#90492045766d92f08b5e160135ade65c">dns_children</a>=5;  <span class="comment">/* default dns children if needed */</span>
<a name="l00483"></a>00483       <span class="keywordflow">if</span> (!<a class="code" href="webalizer_8c.html#3cb74b5ee16f5910ee70cc4944d1300a">dns_cache</a>)
<a name="l00484"></a>00484       {
<a name="l00485"></a>00485          <span class="comment">/* No cache file specified, aborting... */</span>
<a name="l00486"></a>00486          fprintf(stderr,<span class="stringliteral">"%s\n"</span>,msg_dns_nocf);     <span class="comment">/* Must have a cache file */</span>
<a name="l00487"></a>00487          exit(1);
<a name="l00488"></a>00488       }
<a name="l00489"></a>00489    }
<a name="l00490"></a>00490 
<a name="l00491"></a>00491    <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#3cb74b5ee16f5910ee70cc4944d1300a">dns_cache</a> &amp;&amp; <a class="code" href="webalizer_8c.html#90492045766d92f08b5e160135ade65c">dns_children</a>)    <span class="comment">/* run-time resolution */</span>
<a name="l00492"></a>00492    {
<a name="l00493"></a>00493       <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#90492045766d92f08b5e160135ade65c">dns_children</a> &gt; MAXCHILD) <a class="code" href="webalizer_8c.html#90492045766d92f08b5e160135ade65c">dns_children</a>=MAXCHILD;
<a name="l00494"></a>00494       <span class="comment">/* DNS Lookup (#children): */</span>
<a name="l00495"></a>00495       <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>&gt;1) printf(<span class="stringliteral">"%s (%d): "</span>,msg_dns_rslv,<a class="code" href="webalizer_8c.html#90492045766d92f08b5e160135ade65c">dns_children</a>);
<a name="l00496"></a>00496       fflush(stdout);
<a name="l00497"></a>00497       (<a class="code" href="webalizer_8c.html#480128e1291f32b04678ddac9dc69457">gz_log</a>)?dns_resolver(<a class="code" href="webalizer_8c.html#96781ba6a30d70f2b7f56fb409a3da01">gzlog_fp</a>):dns_resolver(<a class="code" href="webalizer_8c.html#a574e45a6e318dd8f45530c13db10cc1">log_fp</a>);
<a name="l00498"></a>00498       (<a class="code" href="webalizer_8c.html#480128e1291f32b04678ddac9dc69457">gz_log</a>)?gzrewind(<a class="code" href="webalizer_8c.html#96781ba6a30d70f2b7f56fb409a3da01">gzlog_fp</a>):(<a class="code" href="webalizer_8c.html#9db6dddd9890ca88ccca763b0533919b">log_fname</a>)?rewind(<a class="code" href="webalizer_8c.html#a574e45a6e318dd8f45530c13db10cc1">log_fp</a>):exit(0);
<a name="l00499"></a>00499    }
<a name="l00500"></a>00500 
<a name="l00501"></a>00501    <span class="keywordflow">if</span> (strstr(argv[0],<span class="stringliteral">"webazolver"</span>)!=0) exit(0);   <span class="comment">/* webazolver exits here */</span>
<a name="l00502"></a>00502 
<a name="l00503"></a>00503    <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#3cb74b5ee16f5910ee70cc4944d1300a">dns_cache</a>)
<a name="l00504"></a>00504    {
<a name="l00505"></a>00505       <span class="keywordflow">if</span> (!open_cache()) { <a class="code" href="webalizer_8c.html#3cb74b5ee16f5910ee70cc4944d1300a">dns_cache</a>=NULL; dns_db=NULL; }
<a name="l00506"></a>00506       <span class="keywordflow">else</span>
<a name="l00507"></a>00507       {
<a name="l00508"></a>00508          <span class="comment">/* Using DNS cache file &lt;filaneme&gt; */</span>
<a name="l00509"></a>00509          <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>&gt;1) printf(<span class="stringliteral">"%s %s\n"</span>,msg_dns_usec,<a class="code" href="webalizer_8c.html#3cb74b5ee16f5910ee70cc4944d1300a">dns_cache</a>);
<a name="l00510"></a>00510       }
<a name="l00511"></a>00511    }
<a name="l00512"></a>00512 <span class="preprocessor">#endif  </span><span class="comment">/* USE_DNS */</span>
<a name="l00513"></a>00513 
<a name="l00514"></a>00514    <span class="comment">/* Creating output in ... */</span>
<a name="l00515"></a>00515    <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>&gt;1)
<a name="l00516"></a>00516       printf(<span class="stringliteral">"%s %s\n"</span>,msg_dir_use,<a class="code" href="webalizer_8c.html#6910a5df32ce9909ffbacfafaa6e3645">out_dir</a>?<a class="code" href="webalizer_8c.html#6910a5df32ce9909ffbacfafaa6e3645">out_dir</a>:msg_cur_dir);
<a name="l00517"></a>00517 
<a name="l00518"></a>00518    <span class="comment">/* prep hostname */</span>
<a name="l00519"></a>00519    <span class="keywordflow">if</span> (!<a class="code" href="webalizer_8c.html#674a1f0ec86ffb26578c11999c89a3c0">hname</a>)
<a name="l00520"></a>00520    {
<a name="l00521"></a>00521       <span class="keywordflow">if</span> (uname(&amp;<a class="code" href="webalizer_8c.html#fb4af3ebf8357e94b736496594995cee">system_info</a>)) <a class="code" href="webalizer_8c.html#674a1f0ec86ffb26578c11999c89a3c0">hname</a>=<span class="stringliteral">"localhost"</span>;
<a name="l00522"></a>00522       <span class="keywordflow">else</span> <a class="code" href="webalizer_8c.html#674a1f0ec86ffb26578c11999c89a3c0">hname</a>=system_info.nodename;
<a name="l00523"></a>00523    }
<a name="l00524"></a>00524 
<a name="l00525"></a>00525    <span class="comment">/* Hostname for reports is ... */</span>
<a name="l00526"></a>00526    <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>&gt;1) printf(<span class="stringliteral">"%s '%s'\n"</span>,msg_hostname,<a class="code" href="webalizer_8c.html#674a1f0ec86ffb26578c11999c89a3c0">hname</a>);
<a name="l00527"></a>00527 
<a name="l00528"></a>00528    <span class="comment">/* get past history */</span>
<a name="l00529"></a>00529    <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#9c25fea667217c12ecade9cfac496daa">ignore_hist</a>) {<span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>&gt;1) printf(<span class="stringliteral">"%s\n"</span>,msg_ign_hist); }
<a name="l00530"></a>00530    <span class="keywordflow">else</span> <a class="code" href="preserve_8c.html#d7ce84df67f8fe6fb2ae68f70445e3ff">get_history</a>();
<a name="l00531"></a>00531 
<a name="l00532"></a>00532    <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#534a10f9409e025831882efe4a58f959">incremental</a>)                      <span class="comment">/* incremental processing?         */</span>
<a name="l00533"></a>00533    {
<a name="l00534"></a>00534       <span class="keywordflow">if</span> ((i=<a class="code" href="preserve_8c.html#87684b62a3f6bfdc76f25d5fb679c901">restore_state</a>()))           <span class="comment">/* restore internal data structs   */</span>
<a name="l00535"></a>00535       {
<a name="l00536"></a>00536          <span class="comment">/* Error: Unable to restore run data (error num) */</span>
<a name="l00537"></a>00537          <span class="comment">/* if (verbose) fprintf(stderr,"%s (%d)\n",msg_bad_data,i); */</span>
<a name="l00538"></a>00538          fprintf(stderr,<span class="stringliteral">"%s (%d)\n"</span>,msg_bad_data,i);
<a name="l00539"></a>00539          exit(1);
<a name="l00540"></a>00540       }
<a name="l00541"></a>00541       <span class="keywordflow">if</span> (<a class="code" href="webalizer_8h.html#520aedc681661bda91ae6b58266be08d">resp_counter</a>&gt;=<a class="code" href="webalizer_8h.html#3d47d7a8b615ae32d0978491b0fdd2a7">MAXRESP</a>)
<a name="l00542"></a>00542       {
<a name="l00543"></a>00543          <span class="comment">/* set maxresp to the # of entries in webalizer.current if there */</span>
<a name="l00544"></a>00544          <span class="comment">/* are more 404 error entries in it than predefined in MAXRESP   */</span>
<a name="l00545"></a>00545          maxresp=<a class="code" href="webalizer_8h.html#520aedc681661bda91ae6b58266be08d">resp_counter</a>;
<a name="l00546"></a>00546       }
<a name="l00547"></a>00547    }
<a name="l00548"></a>00548 
<a name="l00549"></a>00549    <span class="comment">/* Allocate memory for our TOP countries array */</span>
<a name="l00550"></a>00550    <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#fcd390bd7df1e721799f33f0ac87fdaf">ntop_ctrys</a>  != 0)
<a name="l00551"></a>00551    { <span class="keywordflow">if</span> ( (<a class="code" href="webalizer_8c.html#acb9022e3fedc2d14e55e9854fa3cbcf">top_ctrys</a>=calloc(<a class="code" href="webalizer_8c.html#fcd390bd7df1e721799f33f0ac87fdaf">ntop_ctrys</a>,<span class="keyword">sizeof</span>(<a class="code" href="structcountry__code.html">CLISTPTR</a>))) == NULL)
<a name="l00552"></a>00552     <span class="comment">/* Can't get memory, Top Countries disabled! */</span>
<a name="l00553"></a>00553     {<span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) fprintf(stderr,<span class="stringliteral">"%s\n"</span>,msg_nomem_tc); <a class="code" href="webalizer_8c.html#fcd390bd7df1e721799f33f0ac87fdaf">ntop_ctrys</a>=0;}}
<a name="l00554"></a>00554 
<a name="l00555"></a>00555    start_time = times(&amp;mytms);
<a name="l00556"></a>00556 
<a name="l00557"></a>00557    <span class="comment">/*********************************************/</span>
<a name="l00558"></a>00558    <span class="comment">/* MAIN PROCESS LOOP - read through log file */</span>
<a name="l00559"></a>00559    <span class="comment">/*********************************************/</span>
<a name="l00560"></a>00560 
<a name="l00561"></a>00561    <span class="keywordflow">while</span> ( (<a class="code" href="webalizer_8c.html#480128e1291f32b04678ddac9dc69457">gz_log</a>)?(<a class="code" href="webalizer_8c.html#8abb48bca3dbb868295ee2ce344e3d95">our_gzgets</a>(<a class="code" href="webalizer_8c.html#96781ba6a30d70f2b7f56fb409a3da01">gzlog_fp</a>,<a class="code" href="webalizer_8c.html#09b4e72533ab279f7930a9a5e3ab050c">buffer</a>,<a class="code" href="webalizer_8h.html#eca034f67218340ecb2261a22c2f3dcd">BUFSIZE</a>) != Z_NULL):
<a name="l00562"></a>00562            (fgets(<a class="code" href="webalizer_8c.html#09b4e72533ab279f7930a9a5e3ab050c">buffer</a>,<a class="code" href="webalizer_8h.html#eca034f67218340ecb2261a22c2f3dcd">BUFSIZE</a>,<a class="code" href="webalizer_8c.html#9db6dddd9890ca88ccca763b0533919b">log_fname</a>?<a class="code" href="webalizer_8c.html#a574e45a6e318dd8f45530c13db10cc1">log_fp</a>:stdin) != NULL))
<a name="l00563"></a>00563    {
<a name="l00564"></a>00564       total_rec++;
<a name="l00565"></a>00565       <span class="keywordflow">if</span> (strlen(buffer) == (<a class="code" href="webalizer_8h.html#eca034f67218340ecb2261a22c2f3dcd">BUFSIZE</a>-1))
<a name="l00566"></a>00566       {
<a name="l00567"></a>00567          <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>)
<a name="l00568"></a>00568          {
<a name="l00569"></a>00569             fprintf(stderr,<span class="stringliteral">"%s"</span>,msg_big_rec);
<a name="l00570"></a>00570             <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#4f7caf3ead45aac3963d1e354e820017">debug_mode</a>) fprintf(stderr,<span class="stringliteral">":\n%s"</span>,buffer);
<a name="l00571"></a>00571             <span class="keywordflow">else</span> fprintf(stderr,<span class="stringliteral">"\n"</span>);
<a name="l00572"></a>00572          }
<a name="l00573"></a>00573 
<a name="l00574"></a>00574          total_bad++;                     <span class="comment">/* bump bad record counter      */</span>
<a name="l00575"></a>00575 
<a name="l00576"></a>00576          <span class="comment">/* get the rest of the record */</span>
<a name="l00577"></a>00577          <span class="keywordflow">while</span> ( (<a class="code" href="webalizer_8c.html#480128e1291f32b04678ddac9dc69457">gz_log</a>)?(<a class="code" href="webalizer_8c.html#8abb48bca3dbb868295ee2ce344e3d95">our_gzgets</a>(gzlog_fp,buffer,<a class="code" href="webalizer_8h.html#eca034f67218340ecb2261a22c2f3dcd">BUFSIZE</a>)!=Z_NULL):
<a name="l00578"></a>00578                  (fgets(buffer,<a class="code" href="webalizer_8h.html#eca034f67218340ecb2261a22c2f3dcd">BUFSIZE</a>,<a class="code" href="webalizer_8c.html#9db6dddd9890ca88ccca763b0533919b">log_fname</a>?<a class="code" href="webalizer_8c.html#a574e45a6e318dd8f45530c13db10cc1">log_fp</a>:stdin)!=NULL))
<a name="l00579"></a>00579          {
<a name="l00580"></a>00580             <span class="keywordflow">if</span> (strlen(buffer) &lt; <a class="code" href="webalizer_8h.html#eca034f67218340ecb2261a22c2f3dcd">BUFSIZE</a>-1)
<a name="l00581"></a>00581             {
<a name="l00582"></a>00582                <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#4f7caf3ead45aac3963d1e354e820017">debug_mode</a> &amp;&amp; <a class="code" href="webalizer_8c.html#0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) fprintf(stderr,<span class="stringliteral">"%s\n"</span>,buffer);
<a name="l00583"></a>00583                <span class="keywordflow">break</span>;
<a name="l00584"></a>00584             }
<a name="l00585"></a>00585             <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#4f7caf3ead45aac3963d1e354e820017">debug_mode</a> &amp;&amp; <a class="code" href="webalizer_8c.html#0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) fprintf(stderr,<span class="stringliteral">"%s"</span>,buffer);
<a name="l00586"></a>00586          }
<a name="l00587"></a>00587          <span class="keywordflow">continue</span>;                        <span class="comment">/* go get next record if any    */</span>
<a name="l00588"></a>00588       }
<a name="l00589"></a>00589 
<a name="l00590"></a>00590       <span class="comment">/* got a record... */</span>
<a name="l00591"></a>00591       strcpy(<a class="code" href="webalizer_8c.html#ee9788649de43fb36bc42d15b1c829ff">tmp_buf</a>, buffer);            <span class="comment">/* save buffer in case of error */</span>
<a name="l00592"></a>00592       <span class="keywordflow">if</span> (<a class="code" href="parser_8c.html#f7f838e64a0d2b296d0b8b09b49d6b85">parse_record</a>(buffer))           <span class="comment">/* parse the record             */</span>
<a name="l00593"></a>00593       {
<a name="l00594"></a>00594          <span class="comment">/*********************************************/</span>
<a name="l00595"></a>00595          <span class="comment">/* PASSED MINIMAL CHECKS, DO A LITTLE MORE   */</span>
<a name="l00596"></a>00596          <span class="comment">/*********************************************/</span>
<a name="l00597"></a>00597 
<a name="l00598"></a>00598          <span class="comment">/* convert month name to lowercase */</span>
<a name="l00599"></a>00599          <span class="keywordflow">for</span> (i=4;i&lt;7;i++)
<a name="l00600"></a>00600             <a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#1a6e77deebf410bb8fefe35aa02e384c">datetime</a>[i]=tolower(<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#1a6e77deebf410bb8fefe35aa02e384c">datetime</a>[i]);
<a name="l00601"></a>00601 
<a name="l00602"></a>00602          <span class="comment">/* get year/month/day/hour/min/sec values    */</span>
<a name="l00603"></a>00603          for (i=0;i&lt;12;i++)
<a name="l00604"></a>00604          {
<a name="l00605"></a>00605             <span class="keywordflow">if</span> (strncmp(log_month[i],&amp;<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#1a6e77deebf410bb8fefe35aa02e384c">datetime</a>[4],3)==0)
<a name="l00606"></a>00606                { rec_month = i+1; <span class="keywordflow">break</span>; }
<a name="l00607"></a>00607          }
<a name="l00608"></a>00608 
<a name="l00609"></a>00609          rec_year=atoi(&amp;<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#1a6e77deebf410bb8fefe35aa02e384c">datetime</a>[8]);    <span class="comment">/* get year number (int)   */</span>
<a name="l00610"></a>00610          rec_day =atoi(&amp;<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#1a6e77deebf410bb8fefe35aa02e384c">datetime</a>[1]);    <span class="comment">/* get day number          */</span>
<a name="l00611"></a>00611          rec_hour=atoi(&amp;<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#1a6e77deebf410bb8fefe35aa02e384c">datetime</a>[13]);   <span class="comment">/* get hour number         */</span>
<a name="l00612"></a>00612          rec_min =atoi(&amp;<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#1a6e77deebf410bb8fefe35aa02e384c">datetime</a>[16]);   <span class="comment">/* get minute number       */</span>
<a name="l00613"></a>00613          rec_sec =atoi(&amp;<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#1a6e77deebf410bb8fefe35aa02e384c">datetime</a>[19]);   <span class="comment">/* get second number       */</span>
<a name="l00614"></a>00614 
<a name="l00615"></a>00615          <span class="comment">/* Kludge for Netscape server time (0-24?) error                   */</span>
<a name="l00616"></a>00616          <span class="keywordflow">if</span> (rec_hour&gt;23) rec_hour=0;
<a name="l00617"></a>00617 
<a name="l00618"></a>00618          <span class="comment">/* minimal sanity check on date */</span>
<a name="l00619"></a>00619          <span class="keywordflow">if</span> ((i&gt;=12)||(rec_min&gt;59)||(rec_sec&gt;59)||(rec_year&lt;1990))
<a name="l00620"></a>00620          {
<a name="l00621"></a>00621             total_bad++;                <span class="comment">/* if a bad date, bump counter      */</span>
<a name="l00622"></a>00622             <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>)
<a name="l00623"></a>00623             {
<a name="l00624"></a>00624                fprintf(stderr,<span class="stringliteral">"%s: %s [%lu]"</span>,
<a name="l00625"></a>00625                  msg_bad_date,<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#1a6e77deebf410bb8fefe35aa02e384c">datetime</a>,total_rec);
<a name="l00626"></a>00626                <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#4f7caf3ead45aac3963d1e354e820017">debug_mode</a>) fprintf(stderr,<span class="stringliteral">":\n%s\n"</span>,<a class="code" href="webalizer_8c.html#ee9788649de43fb36bc42d15b1c829ff">tmp_buf</a>);
<a name="l00627"></a>00627                <span class="keywordflow">else</span> fprintf(stderr,<span class="stringliteral">"\n"</span>);
<a name="l00628"></a>00628             }
<a name="l00629"></a>00629             <span class="keywordflow">continue</span>;                   <span class="comment">/* and ignore this record           */</span>
<a name="l00630"></a>00630          }
<a name="l00631"></a>00631 
<a name="l00632"></a>00632          <span class="comment">/*********************************************/</span>
<a name="l00633"></a>00633          <span class="comment">/* GOOD RECORD, CHECK INCREMENTAL/TIMESTAMPS */</span>
<a name="l00634"></a>00634          <span class="comment">/*********************************************/</span>
<a name="l00635"></a>00635 
<a name="l00636"></a>00636          <span class="comment">/* Flag as a good one */</span>
<a name="l00637"></a>00637          good_rec = 1;
<a name="l00638"></a>00638 
<a name="l00639"></a>00639          <span class="comment">/* get current records timestamp (seconds since epoch) */</span>
<a name="l00640"></a>00640          <a class="code" href="webalizer_8c.html#f3d950913119a2fc8ebe574b68c7174b">req_tstamp</a>=<a class="code" href="webalizer_8c.html#4327980462d3207e34bf99fce007b511">cur_tstamp</a>;
<a name="l00641"></a>00641          <a class="code" href="webalizer_8c.html#f385cef2f38414353e7bc598d05b76c5">rec_tstamp</a>=((<a class="code" href="webalizer_8c.html#8fb8978d91b70fd80d00d381cb115731">jdate</a>(rec_day,rec_month,rec_year)-<a class="code" href="webalizer_8c.html#71f3fc3b6564ee11c34ff02cee2a3e05">epoch</a>)*86400)+
<a name="l00642"></a>00642                      (rec_hour*3600)+(rec_min*60)+rec_sec;
<a name="l00643"></a>00643 
<a name="l00644"></a>00644          <span class="comment">/* Do we need to check for duplicate records? (incremental mode)   */</span>
<a name="l00645"></a>00645          <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#b1757477076fc2811cf714a92dc18d0f">check_dup</a>)
<a name="l00646"></a>00646          {
<a name="l00647"></a>00647             <span class="comment">/* check if less than/equal to last record processed            */</span>
<a name="l00648"></a>00648             <span class="keywordflow">if</span> ( <a class="code" href="webalizer_8c.html#f385cef2f38414353e7bc598d05b76c5">rec_tstamp</a> &lt;= <a class="code" href="webalizer_8c.html#4327980462d3207e34bf99fce007b511">cur_tstamp</a> )
<a name="l00649"></a>00649             {
<a name="l00650"></a>00650                <span class="comment">/* if it is, assume we have already processed and ignore it  */</span>
<a name="l00651"></a>00651                total_ignore++;
<a name="l00652"></a>00652                <span class="keywordflow">continue</span>;
<a name="l00653"></a>00653             }
<a name="l00654"></a>00654             <span class="keywordflow">else</span>
<a name="l00655"></a>00655             {
<a name="l00656"></a>00656                <span class="comment">/* if it isn't.. disable any more checks this run            */</span>
<a name="l00657"></a>00657                <a class="code" href="webalizer_8c.html#b1757477076fc2811cf714a92dc18d0f">check_dup</a>=0;
<a name="l00658"></a>00658                <span class="comment">/* now check if it's a new month                             */</span>
<a name="l00659"></a>00659                <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#d8ec6498bcc8d8eb82d92bc5c1aacc8d">cur_month</a> != rec_month)
<a name="l00660"></a>00660                {
<a name="l00661"></a>00661                   <a class="code" href="webalizer_8c.html#3d6b75394204fbb3dbe30423911cda44">clear_month</a>();
<a name="l00662"></a>00662                   <a class="code" href="webalizer_8c.html#a2131c365f9da2fb93a57aed95b563d8">cur_sec</a>   = rec_sec;          <span class="comment">/* set current counters     */</span>
<a name="l00663"></a>00663                   <a class="code" href="webalizer_8c.html#726c08db04038ffbeffd72a3181ac519">cur_min</a>   = rec_min;
<a name="l00664"></a>00664                   <a class="code" href="webalizer_8c.html#ae0bcd47798b959a96cb28082a0f151b">cur_hour</a>  = rec_hour;
<a name="l00665"></a>00665                   <a class="code" href="webalizer_8c.html#6edfa42467177fc02002d61038a98f39">cur_day</a>   = rec_day;
<a name="l00666"></a>00666                   <a class="code" href="webalizer_8c.html#d8ec6498bcc8d8eb82d92bc5c1aacc8d">cur_month</a> = rec_month;
<a name="l00667"></a>00667                   <a class="code" href="webalizer_8c.html#8447667f9dc8021c4f17284b9a12f776">cur_year</a>  = rec_year;
<a name="l00668"></a>00668                   <a class="code" href="webalizer_8c.html#4327980462d3207e34bf99fce007b511">cur_tstamp</a>= <a class="code" href="webalizer_8c.html#f385cef2f38414353e7bc598d05b76c5">rec_tstamp</a>;
<a name="l00669"></a>00669                   <a class="code" href="webalizer_8c.html#4637ce886571ae33e34d7d0ae8d50df8">f_day</a>=<a class="code" href="webalizer_8c.html#3322d751ac470f626bc34fb8b34c1759">l_day</a>=rec_day;          <span class="comment">/* reset first and last day */</span>
<a name="l00670"></a>00670                }
<a name="l00671"></a>00671             }
<a name="l00672"></a>00672          }
<a name="l00673"></a>00673 
<a name="l00674"></a>00674          <span class="comment">/* check for out of sequence records */</span>
<a name="l00675"></a>00675          <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#f385cef2f38414353e7bc598d05b76c5">rec_tstamp</a>/3600 &lt; <a class="code" href="webalizer_8c.html#4327980462d3207e34bf99fce007b511">cur_tstamp</a>/3600)
<a name="l00676"></a>00676          {
<a name="l00677"></a>00677             <span class="keywordflow">if</span> (!<a class="code" href="webalizer_8c.html#23652bde57737d1f6f700f29c4762728">fold_seq_err</a> &amp;&amp; ((<a class="code" href="webalizer_8c.html#f385cef2f38414353e7bc598d05b76c5">rec_tstamp</a>+<a class="code" href="webalizer_8h.html#557769cbf6a29c118bc171bd836c8622">SLOP_VAL</a>)/3600&lt;<a class="code" href="webalizer_8c.html#4327980462d3207e34bf99fce007b511">cur_tstamp</a>/3600) )
<a name="l00678"></a>00678                { total_ignore++; <span class="keywordflow">continue</span>; }
<a name="l00679"></a>00679             <span class="keywordflow">else</span>
<a name="l00680"></a>00680             {
<a name="l00681"></a>00681                rec_sec   = <a class="code" href="webalizer_8c.html#a2131c365f9da2fb93a57aed95b563d8">cur_sec</a>;             <span class="comment">/* if folding sequence      */</span>
<a name="l00682"></a>00682                rec_min   = <a class="code" href="webalizer_8c.html#726c08db04038ffbeffd72a3181ac519">cur_min</a>;             <span class="comment">/* errors, just make it     */</span>
<a name="l00683"></a>00683                rec_hour  = <a class="code" href="webalizer_8c.html#ae0bcd47798b959a96cb28082a0f151b">cur_hour</a>;            <span class="comment">/* look like the last       */</span>
<a name="l00684"></a>00684                rec_day   = <a class="code" href="webalizer_8c.html#6edfa42467177fc02002d61038a98f39">cur_day</a>;             <span class="comment">/* good records timestamp   */</span>
<a name="l00685"></a>00685                rec_month = <a class="code" href="webalizer_8c.html#d8ec6498bcc8d8eb82d92bc5c1aacc8d">cur_month</a>;
<a name="l00686"></a>00686                rec_year  = <a class="code" href="webalizer_8c.html#8447667f9dc8021c4f17284b9a12f776">cur_year</a>;
<a name="l00687"></a>00687                <a class="code" href="webalizer_8c.html#f385cef2f38414353e7bc598d05b76c5">rec_tstamp</a>= <a class="code" href="webalizer_8c.html#4327980462d3207e34bf99fce007b511">cur_tstamp</a>;
<a name="l00688"></a>00688             }
<a name="l00689"></a>00689          }
<a name="l00690"></a>00690          <a class="code" href="webalizer_8c.html#4327980462d3207e34bf99fce007b511">cur_tstamp</a>=<a class="code" href="webalizer_8c.html#f385cef2f38414353e7bc598d05b76c5">rec_tstamp</a>;                 <span class="comment">/* update current timestamp */</span>
<a name="l00691"></a>00691 
<a name="l00692"></a>00692          <span class="comment">/*********************************************/</span>
<a name="l00693"></a>00693          <span class="comment">/* DO SOME PRE-PROCESS FORMATTING            */</span>
<a name="l00694"></a>00694          <span class="comment">/*********************************************/</span>
<a name="l00695"></a>00695 
<a name="l00696"></a>00696          <span class="comment">/* fix URL field */</span>
<a name="l00697"></a>00697          cp1 = cp2 = <a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#479e09f2dc389f8a0a57b9c3146d9d32">url</a>;
<a name="l00698"></a>00698          <span class="comment">/* handle null '-' case here... */</span>
<a name="l00699"></a>00699          <span class="keywordflow">if</span> (*++cp1 == <span class="charliteral">'-'</span>) { *cp2++ = <span class="charliteral">'-'</span>; *cp2 = <span class="charliteral">'\0'</span>; }
<a name="l00700"></a>00700          <span class="keywordflow">else</span>
<a name="l00701"></a>00701          {
<a name="l00702"></a>00702             <span class="comment">/* strip actual URL out of request */</span>
<a name="l00703"></a>00703             <span class="keywordflow">while</span>  ( (*cp1 != <span class="charliteral">' '</span>) &amp;&amp; (*cp1 != <span class="charliteral">'\0'</span>) ) cp1++;
<a name="l00704"></a>00704             <span class="keywordflow">if</span> (*cp1 != <span class="charliteral">'\0'</span>)
<a name="l00705"></a>00705             {
<a name="l00706"></a>00706                <span class="comment">/* scan to begin of actual URL field */</span>
<a name="l00707"></a>00707                <span class="keywordflow">while</span> ((*cp1 == <span class="charliteral">' '</span>) &amp;&amp; (*cp1 != <span class="charliteral">'\0'</span>)) cp1++;
<a name="l00708"></a>00708                <span class="comment">/* remove duplicate / if needed */</span>
<a name="l00709"></a>00709                <span class="keywordflow">if</span> (( *cp1==<span class="charliteral">'/'</span>) &amp;&amp; (*(cp1+1)==<span class="charliteral">'/'</span>)) cp1++;
<a name="l00710"></a>00710                <span class="keywordflow">while</span> ((*cp1 != <span class="charliteral">' '</span>)&amp;&amp;(*cp1 != <span class="charliteral">'"'</span>)&amp;&amp;(*cp1 != <span class="charliteral">'\0'</span>))
<a name="l00711"></a>00711                   *cp2++ = *cp1++;
<a name="l00712"></a>00712                *cp2 = <span class="charliteral">'\0'</span>;
<a name="l00713"></a>00713             }
<a name="l00714"></a>00714          }
<a name="l00715"></a>00715 
<a name="l00716"></a>00716          <span class="comment">/* un-escape URL */</span>
<a name="l00717"></a>00717          <a class="code" href="webalizer_8c.html#5d5d55b66d7df3272cf98f061b6fd2f6">unescape</a>(<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#479e09f2dc389f8a0a57b9c3146d9d32">url</a>);
<a name="l00718"></a>00718 
<a name="l00719"></a>00719          <span class="comment">/* check for service (ie: http://) and lowercase if found */</span>
<a name="l00720"></a>00720          <span class="keywordflow">if</span> ( (cp2=strstr(<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#479e09f2dc389f8a0a57b9c3146d9d32">url</a>,<span class="stringliteral">"://"</span>)) != NULL)
<a name="l00721"></a>00721          {
<a name="l00722"></a>00722             cp1=<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#479e09f2dc389f8a0a57b9c3146d9d32">url</a>;
<a name="l00723"></a>00723             <span class="keywordflow">while</span> (cp1!=cp2)
<a name="l00724"></a>00724             {
<a name="l00725"></a>00725                <span class="keywordflow">if</span> ( (*cp1&gt;=<span class="charliteral">'A'</span>) &amp;&amp; (*cp1&lt;=<span class="charliteral">'Z'</span>)) *cp1 += <span class="charliteral">'a'</span>-<span class="charliteral">'A'</span>;
<a name="l00726"></a>00726                cp1++;
<a name="l00727"></a>00727             }
<a name="l00728"></a>00728          }
<a name="l00729"></a>00729 
<a name="l00730"></a>00730          <span class="comment">/* strip query portion of cgi scripts */</span>
<a name="l00731"></a>00731          cp1 = <a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#479e09f2dc389f8a0a57b9c3146d9d32">url</a>;
<a name="l00732"></a>00732          <span class="keywordflow">while</span> (*cp1 != <span class="charliteral">'\0'</span>)
<a name="l00733"></a>00733            <span class="keywordflow">if</span> (!<a class="code" href="webalizer_8c.html#6889c498251013344e6bcd437b077db0">isurlchar</a>(*cp1)) { *cp1 = <span class="charliteral">'\0'</span>; <span class="keywordflow">break</span>; }
<a name="l00734"></a>00734            <span class="keywordflow">else</span> cp1++;
<a name="l00735"></a>00735          <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#479e09f2dc389f8a0a57b9c3146d9d32">url</a>[0]==<span class="charliteral">'\0'</span>)
<a name="l00736"></a>00736            { <a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#479e09f2dc389f8a0a57b9c3146d9d32">url</a>[0]=<span class="charliteral">'/'</span>; <a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#479e09f2dc389f8a0a57b9c3146d9d32">url</a>[1]=<span class="charliteral">'\0'</span>; }
<a name="l00737"></a>00737 
<a name="l00738"></a>00738          <span class="comment">/* strip off index.html (or any aliases) */</span>
<a name="l00739"></a>00739          lptr=<a class="code" href="linklist_8c.html#a35b4fc28f26c83f77336185f9aa7175">index_alias</a>;
<a name="l00740"></a>00740          <span class="keywordflow">while</span> (lptr!=NULL)
<a name="l00741"></a>00741          {
<a name="l00742"></a>00742             <span class="keywordflow">if</span> ((cp1=strstr(<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#479e09f2dc389f8a0a57b9c3146d9d32">url</a>,lptr-&gt;string))!=NULL)
<a name="l00743"></a>00743             {
<a name="l00744"></a>00744                <span class="keywordflow">if</span> ((cp1==<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#479e09f2dc389f8a0a57b9c3146d9d32">url</a>)||(*(cp1-1)==<span class="charliteral">'/'</span>))
<a name="l00745"></a>00745                {
<a name="l00746"></a>00746                   *cp1=<span class="charliteral">'\0'</span>;
<a name="l00747"></a>00747                   <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#479e09f2dc389f8a0a57b9c3146d9d32">url</a>[0]==<span class="charliteral">'\0'</span>)
<a name="l00748"></a>00748                    { <a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#479e09f2dc389f8a0a57b9c3146d9d32">url</a>[0]=<span class="charliteral">'/'</span>; <a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#479e09f2dc389f8a0a57b9c3146d9d32">url</a>[1]=<span class="charliteral">'\0'</span>; }
<a name="l00749"></a>00749                   <span class="keywordflow">break</span>;
<a name="l00750"></a>00750                }
<a name="l00751"></a>00751             }
<a name="l00752"></a>00752             lptr=lptr-&gt;next;
<a name="l00753"></a>00753          }
<a name="l00754"></a>00754 
<a name="l00755"></a>00755          <span class="comment">/* unescape referrer */</span>
<a name="l00756"></a>00756          <a class="code" href="webalizer_8c.html#5d5d55b66d7df3272cf98f061b6fd2f6">unescape</a>(<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#cb4f74246c1b97c518bbcc8a4823c0d4">refer</a>);
<a name="l00757"></a>00757 
<a name="l00758"></a>00758          <span class="comment">/* fix referrer field */</span>
<a name="l00759"></a>00759          cp1 = <a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#cb4f74246c1b97c518bbcc8a4823c0d4">refer</a>;
<a name="l00760"></a>00760          cp3 = cp2 = cp1++;
<a name="l00761"></a>00761          <span class="keywordflow">if</span> ( (*cp2 != <span class="charliteral">'\0'</span>) &amp;&amp; (*cp2 == <span class="charliteral">'"'</span>) )
<a name="l00762"></a>00762          {
<a name="l00763"></a>00763             <span class="keywordflow">while</span> ( *cp1 != <span class="charliteral">'\0'</span> )
<a name="l00764"></a>00764             {
<a name="l00765"></a>00765                cp3=cp2;
<a name="l00766"></a>00766                <span class="keywordflow">if</span> ((*cp1&lt;32&amp;&amp;*cp1&gt;0) || *cp1==127 || *cp1==<span class="charliteral">'&lt;'</span>) *cp1=0;
<a name="l00767"></a>00767                <span class="keywordflow">else</span> *cp2++=*cp1++;
<a name="l00768"></a>00768             }
<a name="l00769"></a>00769             *cp3 = <span class="charliteral">'\0'</span>;
<a name="l00770"></a>00770          }
<a name="l00771"></a>00771 
<a name="l00772"></a>00772          <span class="comment">/* strip query portion of cgi referrals */</span>
<a name="l00773"></a>00773          cp1 = <a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#cb4f74246c1b97c518bbcc8a4823c0d4">refer</a>;
<a name="l00774"></a>00774          <span class="keywordflow">if</span> (*cp1 != <span class="charliteral">'\0'</span>)
<a name="l00775"></a>00775          {
<a name="l00776"></a>00776             <span class="keywordflow">while</span> (*cp1 != <span class="charliteral">'\0'</span>)
<a name="l00777"></a>00777             {
<a name="l00778"></a>00778                <span class="keywordflow">if</span> (!<a class="code" href="webalizer_8c.html#6889c498251013344e6bcd437b077db0">isurlchar</a>(*cp1))
<a name="l00779"></a>00779                {
<a name="l00780"></a>00780                   <span class="comment">/* Save query portion in log.rec.srchstr */</span>
<a name="l00781"></a>00781                   strncpy(<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#56f5b706fac667b9d9309ad128e5a102">srchstr</a>,cp1,<a class="code" href="webalizer_8h.html#fbd0e79f3020d8a6df0a85a2300bbd3c">MAXSRCH</a>);
<a name="l00782"></a>00782                   *cp1++=<span class="charliteral">'\0'</span>;
<a name="l00783"></a>00783                   <span class="keywordflow">break</span>;
<a name="l00784"></a>00784                }
<a name="l00785"></a>00785                <span class="keywordflow">else</span> cp1++;
<a name="l00786"></a>00786             }
<a name="l00787"></a>00787             <span class="comment">/* handle null referrer */</span>
<a name="l00788"></a>00788             <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#cb4f74246c1b97c518bbcc8a4823c0d4">refer</a>[0]==<span class="charliteral">'\0'</span>)
<a name="l00789"></a>00789               { <a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#cb4f74246c1b97c518bbcc8a4823c0d4">refer</a>[0]=<span class="charliteral">'-'</span>; <a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#cb4f74246c1b97c518bbcc8a4823c0d4">refer</a>[1]=<span class="charliteral">'\0'</span>; }
<a name="l00790"></a>00790          }
<a name="l00791"></a>00791 
<a name="l00792"></a>00792          <span class="comment">/* if HTTP request, lowercase http://sitename/ portion */</span>
<a name="l00793"></a>00793          cp1 = <a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#cb4f74246c1b97c518bbcc8a4823c0d4">refer</a>;
<a name="l00794"></a>00794          <span class="keywordflow">if</span> ( (*cp1==<span class="charliteral">'h'</span>) || (*cp1==<span class="charliteral">'H'</span>))
<a name="l00795"></a>00795          {
<a name="l00796"></a>00796             <span class="keywordflow">while</span> ( (*cp1!=<span class="charliteral">'/'</span>) &amp;&amp; (*cp1!=<span class="charliteral">'\0'</span>))
<a name="l00797"></a>00797             {
<a name="l00798"></a>00798                <span class="keywordflow">if</span> ( (*cp1&gt;=<span class="charliteral">'A'</span>) &amp;&amp; (*cp1&lt;=<span class="charliteral">'Z'</span>)) *cp1 += <span class="charliteral">'a'</span>-<span class="charliteral">'A'</span>;
<a name="l00799"></a>00799                cp1++;
<a name="l00800"></a>00800             }
<a name="l00801"></a>00801             <span class="comment">/* now do hostname */</span>
<a name="l00802"></a>00802             <span class="keywordflow">if</span> ( (*cp1==<span class="charliteral">'/'</span>) &amp;&amp; ( *(cp1+1)==<span class="charliteral">'/'</span>)) {cp1++; cp1++;}
<a name="l00803"></a>00803             <span class="keywordflow">while</span> ( (*cp1!=<span class="charliteral">'/'</span>) &amp;&amp; (*cp1!=<span class="charliteral">'\0'</span>))
<a name="l00804"></a>00804             {
<a name="l00805"></a>00805                <span class="keywordflow">if</span> ( (*cp1&gt;=<span class="charliteral">'A'</span>) &amp;&amp; (*cp1&lt;=<span class="charliteral">'Z'</span>)) *cp1 += <span class="charliteral">'a'</span>-<span class="charliteral">'A'</span>;
<a name="l00806"></a>00806                cp1++;
<a name="l00807"></a>00807             }
<a name="l00808"></a>00808          }
<a name="l00809"></a>00809 
<a name="l00810"></a>00810          <span class="comment">/* Do we need to mangle? */</span>
<a name="l00811"></a>00811          <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#23d6ba920f8b5ddaea1f3e92958bdaba">mangle_agent</a>)
<a name="l00812"></a>00812          {
<a name="l00813"></a>00813             str=cp2=<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#b512bdcfac62ef38139eaf1701994a4f">agent</a>;
<a name="l00814"></a>00814             cp1=strstr(str,<span class="stringliteral">"ompatible"</span>); <span class="comment">/* check known fakers */</span>
<a name="l00815"></a>00815             <span class="keywordflow">if</span> (cp1!=NULL) {
<a name="l00816"></a>00816                 <span class="keywordflow">while</span> (*cp1!=<span class="charliteral">';'</span>&amp;&amp;*cp1!=<span class="charliteral">'\0'</span>) cp1++;
<a name="l00817"></a>00817                 <span class="comment">/* kludge for Mozilla/3.01 (compatible;) */</span>
<a name="l00818"></a>00818                 <span class="keywordflow">if</span> (*cp1++==<span class="charliteral">';'</span> &amp;&amp; strcmp(cp1,<span class="stringliteral">")\""</span>)) { <span class="comment">/* success! */</span>
<a name="l00819"></a>00819                     <span class="keywordflow">while</span> (*cp1 == <span class="charliteral">' '</span>) cp1++; <span class="comment">/* eat spaces */</span>
<a name="l00820"></a>00820                     <span class="keywordflow">while</span> (*cp1!=<span class="charliteral">'.'</span>&amp;&amp;*cp1!=<span class="charliteral">'\0'</span>&amp;&amp;*cp1!=<span class="charliteral">';'</span>) *cp2++=*cp1++;
<a name="l00821"></a>00821                     <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#23d6ba920f8b5ddaea1f3e92958bdaba">mangle_agent</a>&lt;5)
<a name="l00822"></a>00822                     {
<a name="l00823"></a>00823                         <span class="keywordflow">while</span> (*cp1!=<span class="charliteral">'.'</span>&amp;&amp;*cp1!=<span class="charliteral">';'</span>&amp;&amp;*cp1!=<span class="charliteral">'\0'</span>) *cp2++=*cp1++;
<a name="l00824"></a>00824                         <span class="keywordflow">if</span> (*cp1!=<span class="charliteral">';'</span>&amp;&amp;*cp1!=<span class="charliteral">'\0'</span>) {
<a name="l00825"></a>00825                             *cp2++=*cp1++;
<a name="l00826"></a>00826                             *cp2++=*cp1++;
<a name="l00827"></a>00827                         }
<a name="l00828"></a>00828                     }
<a name="l00829"></a>00829                     <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#23d6ba920f8b5ddaea1f3e92958bdaba">mangle_agent</a>&lt;4)
<a name="l00830"></a>00830                         <span class="keywordflow">if</span> (*cp1&gt;=<span class="charliteral">'0'</span>&amp;&amp;*cp1&lt;=<span class="charliteral">'9'</span>) *cp2++=*cp1++;
<a name="l00831"></a>00831                     <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#23d6ba920f8b5ddaea1f3e92958bdaba">mangle_agent</a>&lt;3)
<a name="l00832"></a>00832                         <span class="keywordflow">while</span> (*cp1!=<span class="charliteral">';'</span>&amp;&amp;*cp1!=<span class="charliteral">'\0'</span>&amp;&amp;*cp1!=<span class="charliteral">'('</span>) *cp2++=*cp1++;
<a name="l00833"></a>00833                     <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#23d6ba920f8b5ddaea1f3e92958bdaba">mangle_agent</a>&lt;2)
<a name="l00834"></a>00834                     {
<a name="l00835"></a>00835                         <span class="comment">/* Level 1 - try to get OS */</span>
<a name="l00836"></a>00836                         cp1=strstr(str,<span class="stringliteral">")"</span>);
<a name="l00837"></a>00837                         <span class="keywordflow">if</span> (cp1!=NULL)
<a name="l00838"></a>00838                         {
<a name="l00839"></a>00839                             *cp2++=<span class="charliteral">' '</span>;
<a name="l00840"></a>00840                             *cp2++=<span class="charliteral">'('</span>;
<a name="l00841"></a>00841                             <span class="keywordflow">while</span> (*cp1!=<span class="charliteral">';'</span>&amp;&amp;*cp1!=<span class="charliteral">'('</span>&amp;&amp;cp1!=str) cp1--;
<a name="l00842"></a>00842                             <span class="keywordflow">if</span> (cp1!=str&amp;&amp;*cp1!=<span class="charliteral">'\0'</span>) cp1++;
<a name="l00843"></a>00843                             <span class="keywordflow">while</span> (*cp1==<span class="charliteral">' '</span>&amp;&amp;*cp1!=<span class="charliteral">'\0'</span>) cp1++;
<a name="l00844"></a>00844                             <span class="keywordflow">while</span> (*cp1!=<span class="charliteral">')'</span>&amp;&amp;*cp1!=<span class="charliteral">'\0'</span>) *cp2++=*cp1++;
<a name="l00845"></a>00845                             *cp2++=<span class="charliteral">')'</span>;
<a name="l00846"></a>00846                         }
<a name="l00847"></a>00847                     }
<a name="l00848"></a>00848                     *cp2=<span class="charliteral">'\0'</span>;
<a name="l00849"></a>00849                 } <span class="keywordflow">else</span> { <span class="comment">/* nothing after "compatible", should we mangle? */</span>
<a name="l00850"></a>00850                     <span class="comment">/* not for now */</span>
<a name="l00851"></a>00851                 }
<a name="l00852"></a>00852             } <span class="keywordflow">else</span> {
<a name="l00853"></a>00853                 cp1=strstr(str,<span class="stringliteral">"Opera"</span>);  <span class="comment">/* Opera flavor         */</span>
<a name="l00854"></a>00854                 <span class="keywordflow">if</span> (cp1!=NULL)
<a name="l00855"></a>00855                 {
<a name="l00856"></a>00856                     <span class="keywordflow">while</span> (*cp1!=<span class="charliteral">'/'</span>&amp;&amp;*cp1!=<span class="charliteral">' '</span>&amp;&amp;*cp1!=<span class="charliteral">'\0'</span>) *cp2++=*cp1++;
<a name="l00857"></a>00857                     <span class="keywordflow">while</span> (*cp1!=<span class="charliteral">'.'</span>&amp;&amp;*cp1!=<span class="charliteral">'\0'</span>) *cp2++=*cp1++;
<a name="l00858"></a>00858                     <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#23d6ba920f8b5ddaea1f3e92958bdaba">mangle_agent</a>&lt;5)
<a name="l00859"></a>00859                     {
<a name="l00860"></a>00860                         <span class="keywordflow">while</span> (*cp1!=<span class="charliteral">'.'</span>&amp;&amp;*cp1!=<span class="charliteral">'\0'</span>) *cp2++=*cp1++;
<a name="l00861"></a>00861                         *cp2++=*cp1++;
<a name="l00862"></a>00862                         *cp2++=*cp1++;
<a name="l00863"></a>00863                     }
<a name="l00864"></a>00864                     <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#23d6ba920f8b5ddaea1f3e92958bdaba">mangle_agent</a>&lt;4)
<a name="l00865"></a>00865                         <span class="keywordflow">if</span> (*cp1&gt;=<span class="charliteral">'0'</span>&amp;&amp;*cp1&lt;=<span class="charliteral">'9'</span>) *cp2++=*cp1++;
<a name="l00866"></a>00866                     <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#23d6ba920f8b5ddaea1f3e92958bdaba">mangle_agent</a>&lt;3)
<a name="l00867"></a>00867                         <span class="keywordflow">while</span> (*cp1!=<span class="charliteral">' '</span>&amp;&amp;*cp1!=<span class="charliteral">'\0'</span>&amp;&amp;*cp1!=<span class="charliteral">'('</span>) 
<a name="l00868"></a>00868                             *cp2++=*cp1++;
<a name="l00869"></a>00869                     <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#23d6ba920f8b5ddaea1f3e92958bdaba">mangle_agent</a>&lt;2)
<a name="l00870"></a>00870                     {
<a name="l00871"></a>00871                         cp1=strstr(str,<span class="stringliteral">"("</span>);
<a name="l00872"></a>00872                         <span class="keywordflow">if</span> (cp1!=NULL)
<a name="l00873"></a>00873                         {
<a name="l00874"></a>00874                             cp1++;
<a name="l00875"></a>00875                             *cp2++=<span class="charliteral">' '</span>;
<a name="l00876"></a>00876                             *cp2++=<span class="charliteral">'('</span>;
<a name="l00877"></a>00877                             <span class="keywordflow">while</span> (*cp1!=<span class="charliteral">';'</span>&amp;&amp;*cp1!=<span class="charliteral">')'</span>&amp;&amp;*cp1!=<span class="charliteral">'\0'</span>) 
<a name="l00878"></a>00878                                 *cp2++=*cp1++;
<a name="l00879"></a>00879                             *cp2++=<span class="charliteral">')'</span>;
<a name="l00880"></a>00880                         }
<a name="l00881"></a>00881                     }
<a name="l00882"></a>00882                     *cp2=<span class="charliteral">'\0'</span>;
<a name="l00883"></a>00883                 } <span class="keywordflow">else</span> { 
<a name="l00884"></a>00884                     cp1=strstr(str,<span class="stringliteral">"Mozilla"</span>);  <span class="comment">/* Netscape flavor      */</span>
<a name="l00885"></a>00885                     <span class="keywordflow">if</span> (cp1!=NULL)
<a name="l00886"></a>00886                     {
<a name="l00887"></a>00887                         <span class="keywordflow">while</span> (*cp1!=<span class="charliteral">'/'</span>&amp;&amp;*cp1!=<span class="charliteral">' '</span>&amp;&amp;*cp1!=<span class="charliteral">'\0'</span>) *cp2++=*cp1++;
<a name="l00888"></a>00888                         <span class="keywordflow">if</span> (*cp1==<span class="charliteral">' '</span>) *cp1=<span class="charliteral">'/'</span>;
<a name="l00889"></a>00889                         <span class="keywordflow">while</span> (*cp1!=<span class="charliteral">'.'</span>&amp;&amp;*cp1!=<span class="charliteral">'\0'</span>) *cp2++=*cp1++;
<a name="l00890"></a>00890                         <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#23d6ba920f8b5ddaea1f3e92958bdaba">mangle_agent</a>&lt;5)
<a name="l00891"></a>00891                         {
<a name="l00892"></a>00892                             <span class="keywordflow">while</span> (*cp1!=<span class="charliteral">'.'</span>&amp;&amp;*cp1!=<span class="charliteral">'\0'</span>) *cp2++=*cp1++;
<a name="l00893"></a>00893                             *cp2++=*cp1++;
<a name="l00894"></a>00894                             *cp2++=*cp1++;
<a name="l00895"></a>00895                         }
<a name="l00896"></a>00896                         <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#23d6ba920f8b5ddaea1f3e92958bdaba">mangle_agent</a>&lt;4)
<a name="l00897"></a>00897                             <span class="keywordflow">if</span> (*cp1&gt;=<span class="charliteral">'0'</span>&amp;&amp;*cp1&lt;=<span class="charliteral">'9'</span>) *cp2++=*cp1++;
<a name="l00898"></a>00898                         <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#23d6ba920f8b5ddaea1f3e92958bdaba">mangle_agent</a>&lt;3)
<a name="l00899"></a>00899                             <span class="keywordflow">while</span> (*cp1!=<span class="charliteral">' '</span>&amp;&amp;*cp1!=<span class="charliteral">'\0'</span>&amp;&amp;*cp1!=<span class="charliteral">'('</span>) 
<a name="l00900"></a>00900                                 *cp2++=*cp1++;
<a name="l00901"></a>00901                         <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#23d6ba920f8b5ddaea1f3e92958bdaba">mangle_agent</a>&lt;2)
<a name="l00902"></a>00902                         {
<a name="l00903"></a>00903                             <span class="comment">/* Level 1 - Try to get OS */</span>
<a name="l00904"></a>00904                             cp1=strstr(str,<span class="stringliteral">"("</span>);
<a name="l00905"></a>00905                             <span class="keywordflow">if</span> (cp1!=NULL)
<a name="l00906"></a>00906                             {
<a name="l00907"></a>00907                                 cp1++;
<a name="l00908"></a>00908                                 *cp2++=<span class="charliteral">' '</span>;
<a name="l00909"></a>00909                                 *cp2++=<span class="charliteral">'('</span>;
<a name="l00910"></a>00910                                 <span class="keywordflow">while</span> (*cp1!=<span class="charliteral">';'</span>&amp;&amp;*cp1!=<span class="charliteral">')'</span>&amp;&amp;*cp1!=<span class="charliteral">'\0'</span>) 
<a name="l00911"></a>00911                                     *cp2++=*cp1++;
<a name="l00912"></a>00912                                 *cp2++=<span class="charliteral">')'</span>;
<a name="l00913"></a>00913                             }
<a name="l00914"></a>00914                         }
<a name="l00915"></a>00915                         *cp2=<span class="charliteral">'\0'</span>;
<a name="l00916"></a>00916                     }
<a name="l00917"></a>00917                 }
<a name="l00918"></a>00918             }
<a name="l00919"></a>00919          }
<a name="l00920"></a>00920 
<a name="l00921"></a>00921          <span class="comment">/* if necessary, shrink referrer to fit storage */</span>
<a name="l00922"></a>00922          <span class="keywordflow">if</span> (strlen(<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#cb4f74246c1b97c518bbcc8a4823c0d4">refer</a>)&gt;=<a class="code" href="webalizer_8h.html#2c5b86478207547dbb0f2f026725c8f8">MAXREFH</a>)
<a name="l00923"></a>00923          {
<a name="l00924"></a>00924             <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) fprintf(stderr,<span class="stringliteral">"%s [%lu]\n"</span>,
<a name="l00925"></a>00925                 msg_big_ref,total_rec);
<a name="l00926"></a>00926             <a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#cb4f74246c1b97c518bbcc8a4823c0d4">refer</a>[<a class="code" href="webalizer_8h.html#2c5b86478207547dbb0f2f026725c8f8">MAXREFH</a>-1]=<span class="charliteral">'\0'</span>;
<a name="l00927"></a>00927          }
<a name="l00928"></a>00928 
<a name="l00929"></a>00929          <span class="comment">/* if necessary, shrink URL to fit storage */</span>
<a name="l00930"></a>00930          <span class="keywordflow">if</span> (strlen(<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#479e09f2dc389f8a0a57b9c3146d9d32">url</a>)&gt;=<a class="code" href="webalizer_8h.html#25de11d4cd5b64bfd955e494e2b5d815">MAXURLH</a>)
<a name="l00931"></a>00931          {
<a name="l00932"></a>00932             <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) fprintf(stderr,<span class="stringliteral">"%s [%lu]\n"</span>,
<a name="l00933"></a>00933                 msg_big_req,total_rec);
<a name="l00934"></a>00934             <a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#479e09f2dc389f8a0a57b9c3146d9d32">url</a>[<a class="code" href="webalizer_8h.html#25de11d4cd5b64bfd955e494e2b5d815">MAXURLH</a>-1]=<span class="charliteral">'\0'</span>;
<a name="l00935"></a>00935          }
<a name="l00936"></a>00936 
<a name="l00937"></a>00937          <span class="comment">/* fix user agent field */</span>
<a name="l00938"></a>00938          cp1 = <a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#b512bdcfac62ef38139eaf1701994a4f">agent</a>;
<a name="l00939"></a>00939          cp3 = cp2 = cp1++;
<a name="l00940"></a>00940          <span class="keywordflow">if</span> ( (*cp2 != <span class="charliteral">'\0'</span>) &amp;&amp; ((*cp2 == <span class="charliteral">'"'</span>)||(*cp2 == <span class="charliteral">'('</span>)) )
<a name="l00941"></a>00941          {
<a name="l00942"></a>00942             <span class="keywordflow">while</span> (*cp1 |= <span class="charliteral">'\0'</span>) { cp3 = cp2; *cp2++ = *cp1++; }
<a name="l00943"></a>00943             *cp3 = <span class="charliteral">'\0'</span>;
<a name="l00944"></a>00944          }
<a name="l00945"></a>00945          cp1 = <a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#b512bdcfac62ef38139eaf1701994a4f">agent</a>;    <span class="comment">/* CHANGE !!! */</span>
<a name="l00946"></a>00946          <span class="keywordflow">while</span> (*cp1 != 0)       <span class="comment">/* get rid of more common _bad_ chars ;)   */</span>
<a name="l00947"></a>00947          {
<a name="l00948"></a>00948             <span class="keywordflow">if</span> ( (*cp1 &lt; 32) || (*cp1==127) || (*cp1==<span class="charliteral">'&lt;'</span>) || (*cp1==<span class="charliteral">'&gt;'</span>) )
<a name="l00949"></a>00949                { *cp1=<span class="charliteral">'\0'</span>; <span class="keywordflow">break</span>; }
<a name="l00950"></a>00950             <span class="keywordflow">else</span> cp1++;
<a name="l00951"></a>00951          }
<a name="l00952"></a>00952 
<a name="l00953"></a>00953          <span class="comment">/* fix username if needed */</span>
<a name="l00954"></a>00954          <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#abac03796cba2fed0c5185a55e5578bd">ident</a>[0]==0)
<a name="l00955"></a>00955           {  <a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#abac03796cba2fed0c5185a55e5578bd">ident</a>[0]=<span class="charliteral">'-'</span>; <a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#abac03796cba2fed0c5185a55e5578bd">ident</a>[1]=<span class="charliteral">'\0'</span>; }
<a name="l00956"></a>00956          <span class="keywordflow">else</span>
<a name="l00957"></a>00957          {
<a name="l00958"></a>00958             cp3=<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#abac03796cba2fed0c5185a55e5578bd">ident</a>;
<a name="l00959"></a>00959             <span class="keywordflow">while</span> (*cp3&gt;=32 &amp;&amp; *cp3!=<span class="charliteral">'"'</span>) cp3++;
<a name="l00960"></a>00960             *cp3=<span class="charliteral">'\0'</span>;
<a name="l00961"></a>00961          }
<a name="l00962"></a>00962          <span class="comment">/* unescape user name */</span>
<a name="l00963"></a>00963          <a class="code" href="webalizer_8c.html#5d5d55b66d7df3272cf98f061b6fd2f6">unescape</a>(<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#abac03796cba2fed0c5185a55e5578bd">ident</a>);
<a name="l00964"></a>00964 
<a name="l00965"></a>00965          <span class="comment">/********************************************/</span>
<a name="l00966"></a>00966          <span class="comment">/* PROCESS RECORD                           */</span>
<a name="l00967"></a>00967          <span class="comment">/********************************************/</span>
<a name="l00968"></a>00968 
<a name="l00969"></a>00969          <span class="comment">/* first time through? */</span>
<a name="l00970"></a>00970          <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#d8ec6498bcc8d8eb82d92bc5c1aacc8d">cur_month</a> == 0)
<a name="l00971"></a>00971          {
<a name="l00972"></a>00972              <span class="comment">/* if yes, init our date vars */</span>
<a name="l00973"></a>00973              <a class="code" href="webalizer_8c.html#d8ec6498bcc8d8eb82d92bc5c1aacc8d">cur_month</a>=rec_month; <a class="code" href="webalizer_8c.html#8447667f9dc8021c4f17284b9a12f776">cur_year</a>=rec_year;
<a name="l00974"></a>00974              <a class="code" href="webalizer_8c.html#6edfa42467177fc02002d61038a98f39">cur_day</a>=rec_day; <a class="code" href="webalizer_8c.html#ae0bcd47798b959a96cb28082a0f151b">cur_hour</a>=rec_hour;
<a name="l00975"></a>00975              <a class="code" href="webalizer_8c.html#726c08db04038ffbeffd72a3181ac519">cur_min</a>=rec_min; <a class="code" href="webalizer_8c.html#a2131c365f9da2fb93a57aed95b563d8">cur_sec</a>=rec_sec;
<a name="l00976"></a>00976              <a class="code" href="webalizer_8c.html#4637ce886571ae33e34d7d0ae8d50df8">f_day</a>=rec_day;
<a name="l00977"></a>00977          }
<a name="l00978"></a>00978 
<a name="l00979"></a>00979          <span class="comment">/* adjust last day processed if different */</span>
<a name="l00980"></a>00980          <span class="keywordflow">if</span> (rec_day &gt; <a class="code" href="webalizer_8c.html#3322d751ac470f626bc34fb8b34c1759">l_day</a>) <a class="code" href="webalizer_8c.html#3322d751ac470f626bc34fb8b34c1759">l_day</a> = rec_day;
<a name="l00981"></a>00981  
<a name="l00982"></a>00982          <span class="comment">/* update min/sec stuff */</span>
<a name="l00983"></a>00983          <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#a2131c365f9da2fb93a57aed95b563d8">cur_sec</a> != rec_sec) <a class="code" href="webalizer_8c.html#a2131c365f9da2fb93a57aed95b563d8">cur_sec</a> = rec_sec;
<a name="l00984"></a>00984          <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#726c08db04038ffbeffd72a3181ac519">cur_min</a> != rec_min) <a class="code" href="webalizer_8c.html#726c08db04038ffbeffd72a3181ac519">cur_min</a> = rec_min;
<a name="l00985"></a>00985 
<a name="l00986"></a>00986          <span class="comment">/* check for hour change  */</span>
<a name="l00987"></a>00987          <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#ae0bcd47798b959a96cb28082a0f151b">cur_hour</a> != rec_hour)
<a name="l00988"></a>00988          {
<a name="l00989"></a>00989             <span class="comment">/* if yes, init hourly stuff */</span>
<a name="l00990"></a>00990             <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#14a295f77051b0898135267236453dd6">ht_hit</a> &gt; <a class="code" href="webalizer_8c.html#0fbe52a528ae909f4058a35bdab8d034">mh_hit</a>) <a class="code" href="webalizer_8c.html#0fbe52a528ae909f4058a35bdab8d034">mh_hit</a> = <a class="code" href="webalizer_8c.html#14a295f77051b0898135267236453dd6">ht_hit</a>;
<a name="l00991"></a>00991             <a class="code" href="webalizer_8c.html#14a295f77051b0898135267236453dd6">ht_hit</a> = 0;
<a name="l00992"></a>00992             <a class="code" href="webalizer_8c.html#ae0bcd47798b959a96cb28082a0f151b">cur_hour</a> = rec_hour;
<a name="l00993"></a>00993          }
<a name="l00994"></a>00994 
<a name="l00995"></a>00995          <span class="comment">/* check for day change   */</span>
<a name="l00996"></a>00996          <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#6edfa42467177fc02002d61038a98f39">cur_day</a> != rec_day)
<a name="l00997"></a>00997          {
<a name="l00998"></a>00998             <span class="comment">/* if yes, init daily stuff */</span>
<a name="l00999"></a>00999             <a class="code" href="webalizer_8c.html#3016395581c35bac86027a654deb0db5">tm_site</a>[<a class="code" href="webalizer_8c.html#6edfa42467177fc02002d61038a98f39">cur_day</a>-1]=<a class="code" href="webalizer_8c.html#f80cf0d40e63789f26cf6ee643eb3b4c">dt_site</a>; <a class="code" href="webalizer_8c.html#f80cf0d40e63789f26cf6ee643eb3b4c">dt_site</a>=0;
<a name="l01000"></a>01000             <a class="code" href="webalizer_8c.html#f3d33c8d579ff7b3d41abb0e618f70a5">tm_visit</a>[<a class="code" href="webalizer_8c.html#6edfa42467177fc02002d61038a98f39">cur_day</a>-1]=<a class="code" href="hashtab_8c.html#c7baccdb17212972eee28ccc861dd307">tot_visit</a>(<a class="code" href="hashtab_8c.html#e5ddad8435a9d403e79f4bd320fea151">sd_htab</a>);
<a name="l01001"></a>01001             <a class="code" href="hashtab_8c.html#306d5a1540d43fa136c10272cb2f0a4a">del_hlist</a>(<a class="code" href="hashtab_8c.html#e5ddad8435a9d403e79f4bd320fea151">sd_htab</a>);
<a name="l01002"></a>01002             <a class="code" href="webalizer_8c.html#6edfa42467177fc02002d61038a98f39">cur_day</a> = rec_day;
<a name="l01003"></a>01003          }
<a name="l01004"></a>01004 
<a name="l01005"></a>01005          <span class="comment">/* check for month change */</span>
<a name="l01006"></a>01006          <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#d8ec6498bcc8d8eb82d92bc5c1aacc8d">cur_month</a> != rec_month)
<a name="l01007"></a>01007          {
<a name="l01008"></a>01008             <span class="comment">/* if yes, do monthly stuff */</span>
<a name="l01009"></a>01009             <a class="code" href="webalizer_8c.html#241257c2fb7477a7dc9191c01e8a155a">t_visit</a>=<a class="code" href="hashtab_8c.html#c7baccdb17212972eee28ccc861dd307">tot_visit</a>(<a class="code" href="hashtab_8c.html#408742678920fdb90b2926c215e8e19c">sm_htab</a>);
<a name="l01010"></a>01010             <a class="code" href="hashtab_8c.html#8bd37405a172f7642453f9a1fae7438f">month_update_exit</a>(<a class="code" href="webalizer_8c.html#f3d950913119a2fc8ebe574b68c7174b">req_tstamp</a>);    <span class="comment">/* process exit pages      */</span>
<a name="l01011"></a>01011             <a class="code" href="output_8c.html#a88c70787fac7e72d1f6509b38b6bcab">write_month_html</a>();               <span class="comment">/* generate HTML for month */</span>
<a name="l01012"></a>01012             <a class="code" href="webalizer_8c.html#3d6b75394204fbb3dbe30423911cda44">clear_month</a>();
<a name="l01013"></a>01013             <a class="code" href="webalizer_8c.html#d8ec6498bcc8d8eb82d92bc5c1aacc8d">cur_month</a> = rec_month;            <span class="comment">/* update our flags        */</span>
<a name="l01014"></a>01014             <a class="code" href="webalizer_8c.html#8447667f9dc8021c4f17284b9a12f776">cur_year</a>  = rec_year;
<a name="l01015"></a>01015             <a class="code" href="webalizer_8c.html#4637ce886571ae33e34d7d0ae8d50df8">f_day</a>=<a class="code" href="webalizer_8c.html#3322d751ac470f626bc34fb8b34c1759">l_day</a>=rec_day;
<a name="l01016"></a>01016             free(<a class="code" href="webalizer_8h.html#a8ed05f974eff62796d7d6bb0863d253">respnotfound</a>);      <span class="comment">/* free old memory from the last month */</span>
<a name="l01017"></a>01017             <span class="comment">/* Alloc memory for the 404 errors with MAXRESP size */</span>
<a name="l01018"></a>01018             <span class="keywordtype">void</span> * tmp_ptr = calloc(<a class="code" href="webalizer_8h.html#3d47d7a8b615ae32d0978491b0fdd2a7">MAXRESP</a>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structresponse__url.html">response_url</a>));
<a name="l01019"></a>01019             <span class="keywordflow">if</span> (tmp_ptr) {
<a name="l01020"></a>01020                 <a class="code" href="webalizer_8h.html#a8ed05f974eff62796d7d6bb0863d253">respnotfound</a> = (<span class="keyword">struct </span><a class="code" href="structresponse__url.html">response_url</a> *) tmp_ptr;
<a name="l01021"></a>01021             } <span class="keywordflow">else</span> {
<a name="l01022"></a>01022                 fprintf(stderr, <span class="stringliteral">"ERROR: Can't allocate enough memory\n"</span>);
<a name="l01023"></a>01023                 exit(0);
<a name="l01024"></a>01024             }
<a name="l01025"></a>01025             maxresp      = <a class="code" href="webalizer_8h.html#3d47d7a8b615ae32d0978491b0fdd2a7">MAXRESP</a>;     <span class="comment">/* reset constant for realloc    */</span>
<a name="l01026"></a>01026             z            = 0;           <span class="comment">/* reset generic 404 counter     */</span>
<a name="l01027"></a>01027             flag         = 0;           <span class="comment">/* reset flag for 404 counter    */</span>
<a name="l01028"></a>01028             <a class="code" href="webalizer_8h.html#520aedc681661bda91ae6b58266be08d">resp_counter</a> = 0;           <span class="comment">/* reset total 404 counter       */</span>
<a name="l01029"></a>01029          }
<a name="l01030"></a>01030 
<a name="l01031"></a>01031 <span class="preprocessor">#ifdef USE_DNS</span>
<a name="l01032"></a>01032 <span class="preprocessor"></span>         <span class="comment">/* Resolve IP address if needed */</span>
<a name="l01033"></a>01033          <span class="keywordflow">if</span> (dns_db)
<a name="l01034"></a>01034          {
<a name="l01035"></a>01035             <span class="keywordflow">if</span> (inet_addr(<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#8d92ed4a00d2d6b0f155bdbfcc551478">hostname</a>) != INADDR_NONE)
<a name="l01036"></a>01036             resolve_dns(&amp;<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>);
<a name="l01037"></a>01037          }
<a name="l01038"></a>01038 <span class="preprocessor">#endif</span>
<a name="l01039"></a>01039 <span class="preprocessor"></span>
<a name="l01040"></a>01040          <span class="comment">/* lowercase hostname */</span>
<a name="l01041"></a>01041          cp1 = <a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#8d92ed4a00d2d6b0f155bdbfcc551478">hostname</a>;
<a name="l01042"></a>01042          <span class="keywordflow">while</span> (*cp1 != <span class="charliteral">'\0'</span>)
<a name="l01043"></a>01043          {
<a name="l01044"></a>01044             <span class="keywordflow">if</span> ( (*cp1&gt;=<span class="charliteral">'A'</span>) &amp;&amp; (*cp1&lt;=<span class="charliteral">'Z'</span>) ) *cp1 += <span class="charliteral">'a'</span>-<span class="charliteral">'A'</span>;
<a name="l01045"></a>01045             <span class="keywordflow">if</span> ( (isalnum((<span class="keywordtype">int</span>)*cp1))||(*cp1==<span class="charliteral">'.'</span>)||(*cp1==<span class="charliteral">'-'</span>) ) cp1++;
<a name="l01046"></a>01046             <span class="keywordflow">else</span> *cp1=<span class="charliteral">'\0'</span>;
<a name="l01047"></a>01047          }
<a name="l01048"></a>01048 
<a name="l01049"></a>01049          <span class="comment">/* Catch blank hostnames here */</span>
<a name="l01050"></a>01050          <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#8d92ed4a00d2d6b0f155bdbfcc551478">hostname</a>[0]==<span class="charliteral">'\0'</span>)
<a name="l01051"></a>01051             strncpy(<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#8d92ed4a00d2d6b0f155bdbfcc551478">hostname</a>,<span class="stringliteral">"Unknown"</span>,8);
<a name="l01052"></a>01052 
<a name="l01053"></a>01053          <span class="comment">/* Ignore/Include check */</span>
<a name="l01054"></a>01054          <span class="keywordflow">if</span> ( (<a class="code" href="linklist_8c.html#29bda5ebb6dd2f9b19d8f9519eaf94ff">isinlist</a>(<a class="code" href="linklist_8c.html#54c446a5497d9c6f94704e50f3ab099f">include_sites</a>,<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#8d92ed4a00d2d6b0f155bdbfcc551478">hostname</a>)==NULL) &amp;&amp;
<a name="l01055"></a>01055               (<a class="code" href="linklist_8c.html#29bda5ebb6dd2f9b19d8f9519eaf94ff">isinlist</a>(<a class="code" href="linklist_8c.html#10e92b92241988092187d4a28d95d057">include_urls</a>,<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#479e09f2dc389f8a0a57b9c3146d9d32">url</a>)==NULL)       &amp;&amp;
<a name="l01056"></a>01056               (<a class="code" href="linklist_8c.html#29bda5ebb6dd2f9b19d8f9519eaf94ff">isinlist</a>(<a class="code" href="linklist_8c.html#72e046ed2702acb3b3cc2aa444f861b0">include_refs</a>,<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#cb4f74246c1b97c518bbcc8a4823c0d4">refer</a>)==NULL)     &amp;&amp;
<a name="l01057"></a>01057               (<a class="code" href="linklist_8c.html#29bda5ebb6dd2f9b19d8f9519eaf94ff">isinlist</a>(<a class="code" href="linklist_8c.html#29034f7c35846ae0399bd7b358be1d94">include_agents</a>,<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#b512bdcfac62ef38139eaf1701994a4f">agent</a>)==NULL)   &amp;&amp;
<a name="l01058"></a>01058               (<a class="code" href="linklist_8c.html#29bda5ebb6dd2f9b19d8f9519eaf94ff">isinlist</a>(<a class="code" href="linklist_8c.html#4301d92f7f72fdda0af03033d967155b">include_users</a>,<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#abac03796cba2fed0c5185a55e5578bd">ident</a>)==NULL)    )
<a name="l01059"></a>01059          {
<a name="l01060"></a>01060             <span class="keywordflow">if</span> (<a class="code" href="linklist_8c.html#29bda5ebb6dd2f9b19d8f9519eaf94ff">isinlist</a>(<a class="code" href="linklist_8c.html#9df089ae5b8931353b2e79b9a33c70e6">ignored_sites</a>,<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#8d92ed4a00d2d6b0f155bdbfcc551478">hostname</a>)!=NULL)
<a name="l01061"></a>01061               { total_ignore++; <span class="keywordflow">continue</span>; }
<a name="l01062"></a>01062             <span class="keywordflow">if</span> (<a class="code" href="linklist_8c.html#29bda5ebb6dd2f9b19d8f9519eaf94ff">isinlist</a>(<a class="code" href="linklist_8c.html#9a30b4cfe3e814caad5864bf70683264">ignored_urls</a>,<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#479e09f2dc389f8a0a57b9c3146d9d32">url</a>)!=NULL)
<a name="l01063"></a>01063               { total_ignore++; <span class="keywordflow">continue</span>; }
<a name="l01064"></a>01064             <span class="keywordflow">if</span> (<a class="code" href="linklist_8c.html#29bda5ebb6dd2f9b19d8f9519eaf94ff">isinlist</a>(<a class="code" href="linklist_8c.html#60013ce10d008e9eb74a4b6f28959729">ignored_agents</a>,<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#b512bdcfac62ef38139eaf1701994a4f">agent</a>)!=NULL)
<a name="l01065"></a>01065               { total_ignore++; <span class="keywordflow">continue</span>; }
<a name="l01066"></a>01066             <span class="keywordflow">if</span> (<a class="code" href="linklist_8c.html#29bda5ebb6dd2f9b19d8f9519eaf94ff">isinlist</a>(<a class="code" href="linklist_8c.html#761639dc29cca53d524007b9fb4a6e65">ignored_refs</a>,<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#cb4f74246c1b97c518bbcc8a4823c0d4">refer</a>)!=NULL)
<a name="l01067"></a>01067               { total_ignore++; <span class="keywordflow">continue</span>; }
<a name="l01068"></a>01068             <span class="keywordflow">if</span> (<a class="code" href="linklist_8c.html#29bda5ebb6dd2f9b19d8f9519eaf94ff">isinlist</a>(<a class="code" href="linklist_8c.html#c61949a50def3ceeaf32f93f01d1ea16">ignored_users</a>,<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#abac03796cba2fed0c5185a55e5578bd">ident</a>)!=NULL)
<a name="l01069"></a>01069               { total_ignore++; <span class="keywordflow">continue</span>; }
<a name="l01070"></a>01070          }
<a name="l01071"></a>01071 
<a name="l01072"></a>01072          <span class="comment">/* Bump response code totals */</span>
<a name="l01073"></a>01073          <span class="keywordflow">switch</span> (<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#b8db9826a57acc82a4c7d99948a9b89c">resp_code</a>) {
<a name="l01074"></a>01074           <span class="keywordflow">case</span> <a class="code" href="webalizer_8h.html#2973ef9c3946a53a2d2abb55a55a3b97">RC_CONTINUE</a>:         i=<a class="code" href="webalizer_8h.html#83ecb43db7919a2df7837349bbb39e87">IDX_CONTINUE</a>;         <span class="keywordflow">break</span>;
<a name="l01075"></a>01075           <span class="keywordflow">case</span> <a class="code" href="webalizer_8h.html#5c3ddeb1827b40ef72ef2eacf1008e5d">RC_SWITCHPROTO</a>:      i=<a class="code" href="webalizer_8h.html#f75dbc50a390198de5a2b7fa3a1cf74e">IDX_SWITCHPROTO</a>;      <span class="keywordflow">break</span>;
<a name="l01076"></a>01076           <span class="keywordflow">case</span> <a class="code" href="webalizer_8h.html#c96a9e3f6c17299d532eb572ef0ea415">RC_OK</a>:               i=<a class="code" href="webalizer_8h.html#8414d7b1864c34564ece4a0bbc184b59">IDX_OK</a>;               <span class="keywordflow">break</span>;
<a name="l01077"></a>01077           <span class="keywordflow">case</span> <a class="code" href="webalizer_8h.html#f0332079723f3067bbfaaa3898c92f83">RC_CREATED</a>:          i=<a class="code" href="webalizer_8h.html#d4e7a4a0de3d9e8f8fd702d4cc107e5c">IDX_CREATED</a>;          <span class="keywordflow">break</span>;
<a name="l01078"></a>01078           <span class="keywordflow">case</span> <a class="code" href="webalizer_8h.html#1dc4c23d4b1d53e2c441c8f0be4a6c8f">RC_ACCEPTED</a>:         i=<a class="code" href="webalizer_8h.html#933e0eb54658be0ad274c542b96b143d">IDX_ACCEPTED</a>;         <span class="keywordflow">break</span>;
<a name="l01079"></a>01079           <span class="keywordflow">case</span> <a class="code" href="webalizer_8h.html#8ecd21218957eab5e7e58325f40f6552">RC_NONAUTHINFO</a>:      i=<a class="code" href="webalizer_8h.html#939fa36123980dca45b09a9c642c45b4">IDX_NONAUTHINFO</a>;      <span class="keywordflow">break</span>;
<a name="l01080"></a>01080           <span class="keywordflow">case</span> <a class="code" href="webalizer_8h.html#2a4892c2fd090a258e299fe74a2b62bc">RC_NOCONTENT</a>:        i=<a class="code" href="webalizer_8h.html#56130b6b2cce89fee3bd155d7697792a">IDX_NOCONTENT</a>;        <span class="keywordflow">break</span>;
<a name="l01081"></a>01081           <span class="keywordflow">case</span> <a class="code" href="webalizer_8h.html#83082fa7e8fef231b575b90477032d0d">RC_RESETCONTENT</a>:     i=<a class="code" href="webalizer_8h.html#06fdfc6a30a2c0e48f0f5e4aa47064c9">IDX_RESETCONTENT</a>;     <span class="keywordflow">break</span>;
<a name="l01082"></a>01082           <span class="keywordflow">case</span> <a class="code" href="webalizer_8h.html#893e07be696874c598cea81950e6c072">RC_PARTIALCONTENT</a>:   i=<a class="code" href="webalizer_8h.html#781f7d89028f787181cb19ae2467e1fa">IDX_PARTIALCONTENT</a>;   <span class="keywordflow">break</span>;
<a name="l01083"></a>01083           <span class="keywordflow">case</span> <a class="code" href="webalizer_8h.html#e57d896ee18e8ef51e3787d3d00227ad">RC_MULTIPLECHOICES</a>:  i=<a class="code" href="webalizer_8h.html#6f4595e5a6403777c1e6cb5831206156">IDX_MULTIPLECHOICES</a>;  <span class="keywordflow">break</span>;
<a name="l01084"></a>01084           <span class="keywordflow">case</span> <a class="code" href="webalizer_8h.html#377e76f0029c632db82eeed9ca566170">RC_MOVEDPERM</a>:        i=<a class="code" href="webalizer_8h.html#dfb37d5b32200232d0b76ecea8f26c84">IDX_MOVEDPERM</a>;        <span class="keywordflow">break</span>;
<a name="l01085"></a>01085           <span class="keywordflow">case</span> <a class="code" href="webalizer_8h.html#c68cd020d1f6ac6c183545ac2ddedac4">RC_MOVEDTEMP</a>:        i=<a class="code" href="webalizer_8h.html#f6cbf62366bb52a3609fd1e37f9cda52">IDX_MOVEDTEMP</a>;        <span class="keywordflow">break</span>;
<a name="l01086"></a>01086           <span class="keywordflow">case</span> <a class="code" href="webalizer_8h.html#f8c87dee2a752ec00cd4cc68294af9bc">RC_SEEOTHER</a>:         i=<a class="code" href="webalizer_8h.html#7e2706d21cedca3fe0b354d5a1ead818">IDX_SEEOTHER</a>;         <span class="keywordflow">break</span>;
<a name="l01087"></a>01087           <span class="keywordflow">case</span> <a class="code" href="webalizer_8h.html#eff5fe0e9d6e0d3b059e98fa6a7af4c0">RC_NOMOD</a>:            i=<a class="code" href="webalizer_8h.html#9bfe7536dafc3a3c706d948d72807a3a">IDX_NOMOD</a>;            <span class="keywordflow">break</span>;
<a name="l01088"></a>01088           <span class="keywordflow">case</span> <a class="code" href="webalizer_8h.html#ffbf5096b0418235f7c14eec29c4aa0f">RC_USEPROXY</a>:         i=<a class="code" href="webalizer_8h.html#78d0d675c3de5dae71aa53d872331bc4">IDX_USEPROXY</a>;         <span class="keywordflow">break</span>;
<a name="l01089"></a>01089           <span class="keywordflow">case</span> <a class="code" href="webalizer_8h.html#f51f0ab3e378b9069e91c0cdb70967f0">RC_MOVEDTEMPORARILY</a>: i=<a class="code" href="webalizer_8h.html#93c6942088e638bf6e98b953d9f2d1f7">IDX_MOVEDTEMPORARILY</a>; <span class="keywordflow">break</span>;
<a name="l01090"></a>01090           <span class="keywordflow">case</span> <a class="code" href="webalizer_8h.html#fe7364776d74e37117c140dd2a57120d">RC_BAD</a>:              i=<a class="code" href="webalizer_8h.html#48260339557cf3534665eb05912a1868">IDX_BAD</a>;              <span class="keywordflow">break</span>;
<a name="l01091"></a>01091           <span class="keywordflow">case</span> <a class="code" href="webalizer_8h.html#77accf4be7686d8af84c6629d04176ae">RC_UNAUTH</a>:           i=<a class="code" href="webalizer_8h.html#8ea05eb3e8a1b38e57de383d26c37504">IDX_UNAUTH</a>;           <span class="keywordflow">break</span>;
<a name="l01092"></a>01092           <span class="keywordflow">case</span> <a class="code" href="webalizer_8h.html#632840a368cc8995b7cf7c5a2a8fcae9">RC_PAYMENTREQ</a>:       i=<a class="code" href="webalizer_8h.html#aa47991200d3a366985009e68b0f24a0">IDX_PAYMENTREQ</a>;       <span class="keywordflow">break</span>;
<a name="l01093"></a>01093           <span class="keywordflow">case</span> <a class="code" href="webalizer_8h.html#80228f15ff6a244a08c671165772a4cb">RC_FORBIDDEN</a>:        i=<a class="code" href="webalizer_8h.html#b7b99408c850493c8014826e8bb2c6f3">IDX_FORBIDDEN</a>;        <span class="keywordflow">break</span>;
<a name="l01094"></a>01094           <span class="keywordflow">case</span> <a class="code" href="webalizer_8h.html#71678208a421e84056782803d8a4b123">RC_NOTFOUND</a>:         i=<a class="code" href="webalizer_8h.html#e54d154c414e589efe8192c8207d2839">IDX_NOTFOUND</a>;         <span class="keywordflow">break</span>;
<a name="l01095"></a>01095           <span class="keywordflow">case</span> <a class="code" href="webalizer_8h.html#aefe9210427876578c52b3d1b9585d26">RC_METHODNOTALLOWED</a>: i=<a class="code" href="webalizer_8h.html#41fb3f3f6b1da41411b493a2dd061beb">IDX_METHODNOTALLOWED</a>; <span class="keywordflow">break</span>;
<a name="l01096"></a>01096           <span class="keywordflow">case</span> <a class="code" href="webalizer_8h.html#84e1c25114a994a902bcc647855ac889">RC_NOTACCEPTABLE</a>:    i=<a class="code" href="webalizer_8h.html#beee00b54b28f24ee992a5ccd3107c1c">IDX_NOTACCEPTABLE</a>;    <span class="keywordflow">break</span>;
<a name="l01097"></a>01097           <span class="keywordflow">case</span> <a class="code" href="webalizer_8h.html#bb3cc66b80375945009d866c67106eec">RC_PROXYAUTHREQ</a>:     i=<a class="code" href="webalizer_8h.html#2512abf4bfb02560c15b69fbb96f1116">IDX_PROXYAUTHREQ</a>;     <span class="keywordflow">break</span>;
<a name="l01098"></a>01098           <span class="keywordflow">case</span> <a class="code" href="webalizer_8h.html#d434474a429a400a76b36167c2883eb0">RC_TIMEOUT</a>:          i=<a class="code" href="webalizer_8h.html#c6815df17d8a5de1d1d9f2cfebc54549">IDX_TIMEOUT</a>;          <span class="keywordflow">break</span>;
<a name="l01099"></a>01099           <span class="keywordflow">case</span> <a class="code" href="webalizer_8h.html#de706652b6ba7c52ded58b8945282a10">RC_CONFLICT</a>:         i=<a class="code" href="webalizer_8h.html#80993fd20ef234e37cd81707101a93e5">IDX_CONFLICT</a>;         <span class="keywordflow">break</span>;
<a name="l01100"></a>01100           <span class="keywordflow">case</span> <a class="code" href="webalizer_8h.html#e3c00160efe3330657c85c15d047490c">RC_GONE</a>:             i=<a class="code" href="webalizer_8h.html#016b0abec5b38a6587c1efdc0220b768">IDX_GONE</a>;             <span class="keywordflow">break</span>;
<a name="l01101"></a>01101           <span class="keywordflow">case</span> <a class="code" href="webalizer_8h.html#d8e34c952fc0f159e05586be6444fd7e">RC_LENGTHREQ</a>:        i=<a class="code" href="webalizer_8h.html#81cd1be9f15877380c00d1c71bd511ff">IDX_LENGTHREQ</a>;        <span class="keywordflow">break</span>;
<a name="l01102"></a>01102           <span class="keywordflow">case</span> <a class="code" href="webalizer_8h.html#1b9f678bdf687297ee1d2c6d33901a9d">RC_PREFAILED</a>:        i=<a class="code" href="webalizer_8h.html#dd268ced3960a37e6f03794d754d37c4">IDX_PREFAILED</a>;        <span class="keywordflow">break</span>;
<a name="l01103"></a>01103           <span class="keywordflow">case</span> <a class="code" href="webalizer_8h.html#09481992e00a806a61fa09aa85ba914a">RC_REQENTTOOLARGE</a>:   i=<a class="code" href="webalizer_8h.html#800af5d850306ceda4230bc357eb49a1">IDX_REQENTTOOLARGE</a>;   <span class="keywordflow">break</span>;
<a name="l01104"></a>01104           <span class="keywordflow">case</span> <a class="code" href="webalizer_8h.html#94a11e7b21ac575205e9100b72e23d8d">RC_REQURITOOLARGE</a>:   i=<a class="code" href="webalizer_8h.html#2ff00bc5fadae34827ff0514047124b4">IDX_REQURITOOLARGE</a>;   <span class="keywordflow">break</span>;
<a name="l01105"></a>01105           <span class="keywordflow">case</span> <a class="code" href="webalizer_8h.html#816d51d9feb10e5a9aeeb0e10029b280">RC_UNSUPMEDIATYPE</a>:   i=<a class="code" href="webalizer_8h.html#e11d6a0f8e87a7188ecc2d97b40e6027">IDX_UNSUPMEDIATYPE</a>;   <span class="keywordflow">break</span>;
<a name="l01106"></a>01106           <span class="keywordflow">case</span> <a class="code" href="webalizer_8h.html#cdb353643fa046961295e21975c5cc9d">RC_RNGNOTSATISFIABLE</a>:i=<a class="code" href="webalizer_8h.html#5aafa8994d729c3cbcc7c6564ee32793">IDX_RNGNOTSATISFIABLE</a>;<span class="keywordflow">break</span>;
<a name="l01107"></a>01107           <span class="keywordflow">case</span> <a class="code" href="webalizer_8h.html#491c8d8e375207b66d0d730c96f7f72f">RC_EXPECTATIONFAILED</a>:i=<a class="code" href="webalizer_8h.html#31802e28bbe27706459b6d1a9649cebb">IDX_EXPECTATIONFAILED</a>;<span class="keywordflow">break</span>;
<a name="l01108"></a>01108           <span class="keywordflow">case</span> <a class="code" href="webalizer_8h.html#154fcfc91d9d9dc80189afa640f7505e">RC_SERVERERR</a>:        i=<a class="code" href="webalizer_8h.html#172077342801961a306c9d7a1fac4433">IDX_SERVERERR</a>;        <span class="keywordflow">break</span>;
<a name="l01109"></a>01109           <span class="keywordflow">case</span> <a class="code" href="webalizer_8h.html#ede48bc0a06917580753201049f9e396">RC_NOTIMPLEMENTED</a>:   i=<a class="code" href="webalizer_8h.html#7ed773dca0aac3af7eb48e70d7483ebb">IDX_NOTIMPLEMENTED</a>;   <span class="keywordflow">break</span>;
<a name="l01110"></a>01110           <span class="keywordflow">case</span> <a class="code" href="webalizer_8h.html#1d6c4fd6c60fc320baee08a960890fc3">RC_BADGATEWAY</a>:       i=<a class="code" href="webalizer_8h.html#2de048827e8a84dab33a5421e9eb2819">IDX_BADGATEWAY</a>;       <span class="keywordflow">break</span>;
<a name="l01111"></a>01111           <span class="keywordflow">case</span> <a class="code" href="webalizer_8h.html#1be4e098cbdf953b61ea3e9014b04179">RC_UNAVAIL</a>:          i=<a class="code" href="webalizer_8h.html#e22b7bcbc25b5d27c2f17f513e5fb470">IDX_UNAVAIL</a>;          <span class="keywordflow">break</span>;
<a name="l01112"></a>01112           <span class="keywordflow">case</span> <a class="code" href="webalizer_8h.html#9a6769b1960fc266b7276c99ae6be4b4">RC_GATEWAYTIMEOUT</a>:   i=<a class="code" href="webalizer_8h.html#4b7b0e69b67e440b46ddc4c2b9cee01a">IDX_GATEWAYTIMEOUT</a>;   <span class="keywordflow">break</span>;
<a name="l01113"></a>01113           <span class="keywordflow">case</span> <a class="code" href="webalizer_8h.html#97071445bafc08e42f84edfb030bd18e">RC_BADHTTPVER</a>:       i=<a class="code" href="webalizer_8h.html#e4191d0093c406af5911ea618427431c">IDX_BADHTTPVER</a>;       <span class="keywordflow">break</span>;
<a name="l01114"></a>01114           <span class="keywordflow">default</span>:                  i=<a class="code" href="webalizer_8h.html#b93bf51da9eb22f9c1137af150b41875">IDX_UNDEFINED</a>;        <span class="keywordflow">break</span>;
<a name="l01115"></a>01115          }
<a name="l01116"></a>01116          <a class="code" href="lang_8h.html#6fbb1449f14f39208f656061d49c280b">response</a>[i].<a class="code" href="structresponse__code.html#a973afefbe5e787ef2fee765f05bbfaf">count</a>++;
<a name="l01117"></a>01117 
<a name="l01118"></a>01118          <span class="comment">/* Check if response is a 404 error */</span>
<a name="l01119"></a>01119          <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#b8db9826a57acc82a4c7d99948a9b89c">resp_code</a> == <a class="code" href="webalizer_8h.html#71678208a421e84056782803d8a4b123">RC_NOTFOUND</a>) {
<a name="l01120"></a>01120              <span class="keywordflow">if</span> (<a class="code" href="webalizer_8h.html#520aedc681661bda91ae6b58266be08d">resp_counter</a> &gt; 0) {
<a name="l01121"></a>01121                  <span class="keywordflow">for</span> (z=0;z&lt;<a class="code" href="webalizer_8h.html#520aedc681661bda91ae6b58266be08d">resp_counter</a>;z++) { <span class="comment">/* 404 already exists? */</span>
<a name="l01122"></a>01122                       <span class="keywordflow">if</span> (strcmp(<a class="code" href="webalizer_8h.html#a8ed05f974eff62796d7d6bb0863d253">respnotfound</a>[z].<a class="code" href="structresponse__url.html#c997088a7965d5b69b6aec48f77deea6">respurl</a>,<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#479e09f2dc389f8a0a57b9c3146d9d32">url</a>) == 0 ) {
<a name="l01123"></a>01123                           <a class="code" href="webalizer_8h.html#a8ed05f974eff62796d7d6bb0863d253">respnotfound</a>[z].<a class="code" href="structresponse__url.html#82f3189f3b02c8eb1edc0f0da8ceb0e7">count</a>++;
<a name="l01124"></a>01124                           flag = 1;     <span class="comment">/* set flag for 404 counter */</span>
<a name="l01125"></a>01125                           <span class="keywordflow">break</span>;        <span class="comment">/* we leave the routine     */</span>
<a name="l01126"></a>01126                       }
<a name="l01127"></a>01127                  }
<a name="l01128"></a>01128              }
<a name="l01129"></a>01129              <span class="keywordflow">if</span> (flag != 1) { <span class="comment">/* 404 does not exist yet */</span>
<a name="l01130"></a>01130                  <span class="comment">/* realloc the memory if necessary */</span>
<a name="l01131"></a>01131                  <span class="keywordflow">if</span> (<a class="code" href="webalizer_8h.html#520aedc681661bda91ae6b58266be08d">resp_counter</a>&gt;=maxresp) {
<a name="l01132"></a>01132                      maxresp+=<a class="code" href="webalizer_8h.html#08a8f937430dfb2f8d178491808565c4">INCRESP</a>;
<a name="l01133"></a>01133                      <span class="keywordtype">void</span> * new_ptr = realloc(<a class="code" href="webalizer_8h.html#a8ed05f974eff62796d7d6bb0863d253">respnotfound</a>, 
<a name="l01134"></a>01134                                 <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structresponse__url.html">response_url</a>)*(maxresp));
<a name="l01135"></a>01135                      <span class="keywordflow">if</span>(new_ptr) {
<a name="l01136"></a>01136                         <a class="code" href="webalizer_8h.html#a8ed05f974eff62796d7d6bb0863d253">respnotfound</a> = (<span class="keyword">struct </span>response_url *) new_ptr;
<a name="l01137"></a>01137                         strncpy(<a class="code" href="webalizer_8h.html#a8ed05f974eff62796d7d6bb0863d253">respnotfound</a>[<a class="code" href="webalizer_8h.html#520aedc681661bda91ae6b58266be08d">resp_counter</a>].<a class="code" href="structresponse__url.html#c997088a7965d5b69b6aec48f77deea6">respurl</a>,<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#479e09f2dc389f8a0a57b9c3146d9d32">url</a>, 
<a name="l01138"></a>01138                                 <span class="keyword">sizeof</span>(<a class="code" href="webalizer_8h.html#a8ed05f974eff62796d7d6bb0863d253">respnotfound</a>[<a class="code" href="webalizer_8h.html#520aedc681661bda91ae6b58266be08d">resp_counter</a>].respurl)-1);
<a name="l01139"></a>01139                         <a class="code" href="webalizer_8h.html#a8ed05f974eff62796d7d6bb0863d253">respnotfound</a>[<a class="code" href="webalizer_8h.html#520aedc681661bda91ae6b58266be08d">resp_counter</a>].<a class="code" href="structresponse__url.html#c997088a7965d5b69b6aec48f77deea6">respurl</a>[<span class="keyword">sizeof</span>(<a class="code" href="webalizer_8h.html#a8ed05f974eff62796d7d6bb0863d253">respnotfound</a>[<a class="code" href="webalizer_8h.html#520aedc681661bda91ae6b58266be08d">resp_counter</a>].<a class="code" href="structresponse__url.html#c997088a7965d5b69b6aec48f77deea6">respurl</a>)-1]=<span class="charliteral">'\0'</span>;
<a name="l01140"></a>01140                         <a class="code" href="webalizer_8h.html#a8ed05f974eff62796d7d6bb0863d253">respnotfound</a>[<a class="code" href="webalizer_8h.html#520aedc681661bda91ae6b58266be08d">resp_counter</a>].<a class="code" href="structresponse__url.html#82f3189f3b02c8eb1edc0f0da8ceb0e7">count</a>=0;
<a name="l01141"></a>01141                         <a class="code" href="webalizer_8h.html#520aedc681661bda91ae6b58266be08d">resp_counter</a>+=1;
<a name="l01142"></a>01142                      } <span class="keywordflow">else</span> {
<a name="l01143"></a>01143                         fprintf(stderr, <span class="stringliteral">"ERROR: Can't reallocate enough memory\n"</span>);
<a name="l01144"></a>01144                         exit(0);
<a name="l01145"></a>01145                      }
<a name="l01146"></a>01146                  } <span class="keywordflow">else</span> {
<a name="l01147"></a>01147                     strncpy(<a class="code" href="webalizer_8h.html#a8ed05f974eff62796d7d6bb0863d253">respnotfound</a>[<a class="code" href="webalizer_8h.html#520aedc681661bda91ae6b58266be08d">resp_counter</a>].<a class="code" href="structresponse__url.html#c997088a7965d5b69b6aec48f77deea6">respurl</a>,<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#479e09f2dc389f8a0a57b9c3146d9d32">url</a>, 
<a name="l01148"></a>01148                                 <span class="keyword">sizeof</span>(<a class="code" href="webalizer_8h.html#a8ed05f974eff62796d7d6bb0863d253">respnotfound</a>[<a class="code" href="webalizer_8h.html#520aedc681661bda91ae6b58266be08d">resp_counter</a>].respurl)-1);
<a name="l01149"></a>01149                     <a class="code" href="webalizer_8h.html#a8ed05f974eff62796d7d6bb0863d253">respnotfound</a>[<a class="code" href="webalizer_8h.html#520aedc681661bda91ae6b58266be08d">resp_counter</a>].<a class="code" href="structresponse__url.html#c997088a7965d5b69b6aec48f77deea6">respurl</a>[<span class="keyword">sizeof</span>(<a class="code" href="webalizer_8h.html#a8ed05f974eff62796d7d6bb0863d253">respnotfound</a>[<a class="code" href="webalizer_8h.html#520aedc681661bda91ae6b58266be08d">resp_counter</a>].<a class="code" href="structresponse__url.html#c997088a7965d5b69b6aec48f77deea6">respurl</a>)-1]=<span class="charliteral">'\0'</span>;
<a name="l01150"></a>01150                     <a class="code" href="webalizer_8h.html#a8ed05f974eff62796d7d6bb0863d253">respnotfound</a>[<a class="code" href="webalizer_8h.html#520aedc681661bda91ae6b58266be08d">resp_counter</a>].<a class="code" href="structresponse__url.html#82f3189f3b02c8eb1edc0f0da8ceb0e7">count</a>=0;
<a name="l01151"></a>01151                     <a class="code" href="webalizer_8h.html#520aedc681661bda91ae6b58266be08d">resp_counter</a>+=1;
<a name="l01152"></a>01152                  }
<a name="l01153"></a>01153              }
<a name="l01154"></a>01154              flag = 0;                  <span class="comment">/* reset flag for 404 counter       */</span>
<a name="l01155"></a>01155          }
<a name="l01156"></a>01156          
<a name="l01157"></a>01157          <span class="comment">/* now save in the various hash tables... */</span>
<a name="l01158"></a>01158          <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#b8db9826a57acc82a4c7d99948a9b89c">resp_code</a>==<a class="code" href="webalizer_8h.html#c96a9e3f6c17299d532eb572ef0ea415">RC_OK</a> || <a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#b8db9826a57acc82a4c7d99948a9b89c">resp_code</a>==<a class="code" href="webalizer_8h.html#893e07be696874c598cea81950e6c072">RC_PARTIALCONTENT</a>)
<a name="l01159"></a>01159             i=1; <span class="keywordflow">else</span> i=0;
<a name="l01160"></a>01160          
<a name="l01161"></a>01161          <span class="comment">/* URL/ident hash table (only if valid response code) */</span>
<a name="l01162"></a>01162          <span class="keywordflow">if</span> ((<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#b8db9826a57acc82a4c7d99948a9b89c">resp_code</a>==<a class="code" href="webalizer_8h.html#c96a9e3f6c17299d532eb572ef0ea415">RC_OK</a>)||(<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#b8db9826a57acc82a4c7d99948a9b89c">resp_code</a>==<a class="code" href="webalizer_8h.html#eff5fe0e9d6e0d3b059e98fa6a7af4c0">RC_NOMOD</a>)||
<a name="l01163"></a>01163              (<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#b8db9826a57acc82a4c7d99948a9b89c">resp_code</a>==<a class="code" href="webalizer_8h.html#893e07be696874c598cea81950e6c072">RC_PARTIALCONTENT</a>))
<a name="l01164"></a>01164          {
<a name="l01165"></a>01165             <span class="comment">/* URL hash table */</span>
<a name="l01166"></a>01166             <span class="keywordflow">if</span> (<a class="code" href="hashtab_8c.html#c4f10ed3d908404570fa30fae460b7d0">put_unode</a>(<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#479e09f2dc389f8a0a57b9c3146d9d32">url</a>,<a class="code" href="hashtab_8h.html#468764de892a2303272613f54f955b0b">OBJ_REG</a>,(u_long)1,
<a name="l01167"></a>01167                 <a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#8147dacfe44060fa40bb3caf79e3fdd1">xfer_size</a>,&amp;<a class="code" href="webalizer_8c.html#593eb26715b7f629074c61861d8dd8b3">t_url</a>,(u_long)0,(u_long)0,<a class="code" href="hashtab_8c.html#2f99d64abd1711a4b10ee71d070811a7">um_htab</a>))
<a name="l01168"></a>01168             {
<a name="l01169"></a>01169                <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>)
<a name="l01170"></a>01170                <span class="comment">/* Error adding URL node, skipping ... */</span>
<a name="l01171"></a>01171                fprintf(stderr,<span class="stringliteral">"%s %s\n"</span>, msg_nomem_u, <a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#479e09f2dc389f8a0a57b9c3146d9d32">url</a>);
<a name="l01172"></a>01172             }
<a name="l01173"></a>01173 
<a name="l01174"></a>01174             <span class="comment">/* ident (username) hash table */</span>
<a name="l01175"></a>01175             <span class="keywordflow">if</span> (<a class="code" href="hashtab_8c.html#9febd80a08973165c09cd1f42f429838">put_inode</a>(<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#abac03796cba2fed0c5185a55e5578bd">ident</a>,<a class="code" href="hashtab_8h.html#468764de892a2303272613f54f955b0b">OBJ_REG</a>,
<a name="l01176"></a>01176                 1,(u_long)i,<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#8147dacfe44060fa40bb3caf79e3fdd1">xfer_size</a>,&amp;<a class="code" href="webalizer_8c.html#196ee522ca1e09cef5b8962a7c63e4e2">t_user</a>,
<a name="l01177"></a>01177                 0,<a class="code" href="webalizer_8c.html#f385cef2f38414353e7bc598d05b76c5">rec_tstamp</a>,<a class="code" href="hashtab_8c.html#1a7bfe1ecf3b78722bcee9d08e8178a1">im_htab</a>))
<a name="l01178"></a>01178             {
<a name="l01179"></a>01179                <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>)
<a name="l01180"></a>01180                <span class="comment">/* Error adding ident node, skipping .... */</span>
<a name="l01181"></a>01181                fprintf(stderr,<span class="stringliteral">"%s %s\n"</span>, msg_nomem_i, <a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#abac03796cba2fed0c5185a55e5578bd">ident</a>);
<a name="l01182"></a>01182             }
<a name="l01183"></a>01183          }
<a name="l01184"></a>01184 
<a name="l01185"></a>01185          <span class="comment">/* referrer hash table */</span>
<a name="l01186"></a>01186          <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#78414d5060b40b23c1fbb95546fb74d3">ntop_refs</a>)
<a name="l01187"></a>01187          {
<a name="l01188"></a>01188             <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#cb4f74246c1b97c518bbcc8a4823c0d4">refer</a>[0]!=<span class="charliteral">'\0'</span>)
<a name="l01189"></a>01189              <span class="keywordflow">if</span> (<a class="code" href="hashtab_8c.html#b4002d9ddebb92b4a979361424d2e51b">put_rnode</a>(<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#cb4f74246c1b97c518bbcc8a4823c0d4">refer</a>,<a class="code" href="hashtab_8h.html#468764de892a2303272613f54f955b0b">OBJ_REG</a>,(u_long)1,&amp;<a class="code" href="webalizer_8c.html#54f4adcbb2769b5082a138f23c9bb07e">t_ref</a>,<a class="code" href="hashtab_8c.html#4b36877a2219872c641eb9a58ae45ce8">rm_htab</a>))
<a name="l01190"></a>01190              {
<a name="l01191"></a>01191               <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>)
<a name="l01192"></a>01192               fprintf(stderr,<span class="stringliteral">"%s %s\n"</span>, msg_nomem_r, <a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#cb4f74246c1b97c518bbcc8a4823c0d4">refer</a>);
<a name="l01193"></a>01193              }
<a name="l01194"></a>01194          }
<a name="l01195"></a>01195 
<a name="l01196"></a>01196          <span class="comment">/* hostname (site) hash table - daily */</span>
<a name="l01197"></a>01197          <span class="keywordflow">if</span> (<a class="code" href="hashtab_8c.html#f2f25ed90b609c69446b8446454ca7a0">put_hnode</a>(<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#8d92ed4a00d2d6b0f155bdbfcc551478">hostname</a>,<a class="code" href="hashtab_8h.html#468764de892a2303272613f54f955b0b">OBJ_REG</a>,
<a name="l01198"></a>01198              1,(u_long)i,<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#8147dacfe44060fa40bb3caf79e3fdd1">xfer_size</a>,&amp;<a class="code" href="webalizer_8c.html#f80cf0d40e63789f26cf6ee643eb3b4c">dt_site</a>,
<a name="l01199"></a>01199              0,<a class="code" href="webalizer_8c.html#f385cef2f38414353e7bc598d05b76c5">rec_tstamp</a>,<span class="stringliteral">""</span>,<a class="code" href="hashtab_8c.html#e5ddad8435a9d403e79f4bd320fea151">sd_htab</a>))
<a name="l01200"></a>01200          {
<a name="l01201"></a>01201             <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>)
<a name="l01202"></a>01202             <span class="comment">/* Error adding host node (daily), skipping .... */</span>
<a name="l01203"></a>01203             fprintf(stderr,<span class="stringliteral">"%s %s\n"</span>,msg_nomem_dh, <a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#8d92ed4a00d2d6b0f155bdbfcc551478">hostname</a>);
<a name="l01204"></a>01204          }
<a name="l01205"></a>01205 
<a name="l01206"></a>01206          <span class="comment">/* hostname (site) hash table - monthly */</span>
<a name="l01207"></a>01207          <span class="keywordflow">if</span> (<a class="code" href="hashtab_8c.html#f2f25ed90b609c69446b8446454ca7a0">put_hnode</a>(<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#8d92ed4a00d2d6b0f155bdbfcc551478">hostname</a>,<a class="code" href="hashtab_8h.html#468764de892a2303272613f54f955b0b">OBJ_REG</a>,
<a name="l01208"></a>01208              1,(u_long)i,<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#8147dacfe44060fa40bb3caf79e3fdd1">xfer_size</a>,&amp;<a class="code" href="webalizer_8c.html#e37f859c6ceb40434ecd96c6ba5d0565">t_site</a>,
<a name="l01209"></a>01209              0,<a class="code" href="webalizer_8c.html#f385cef2f38414353e7bc598d05b76c5">rec_tstamp</a>,<span class="stringliteral">""</span>,<a class="code" href="hashtab_8c.html#408742678920fdb90b2926c215e8e19c">sm_htab</a>))
<a name="l01210"></a>01210          {
<a name="l01211"></a>01211             <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>)
<a name="l01212"></a>01212             <span class="comment">/* Error adding host node (monthly), skipping .... */</span>
<a name="l01213"></a>01213             fprintf(stderr,<span class="stringliteral">"%s %s\n"</span>, msg_nomem_mh, <a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#8d92ed4a00d2d6b0f155bdbfcc551478">hostname</a>);
<a name="l01214"></a>01214          }
<a name="l01215"></a>01215 
<a name="l01216"></a>01216          <span class="comment">/* user agent hash table */</span>
<a name="l01217"></a>01217          <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#09d5297ba12ba78e65bcb4679036de17">ntop_agents</a>)
<a name="l01218"></a>01218          {
<a name="l01219"></a>01219             <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#b512bdcfac62ef38139eaf1701994a4f">agent</a>[0]!=<span class="charliteral">'\0'</span>)
<a name="l01220"></a>01220              <span class="keywordflow">if</span> (<a class="code" href="hashtab_8c.html#696c253a54bee8d869c852d86c1f145e">put_anode</a>(<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#b512bdcfac62ef38139eaf1701994a4f">agent</a>,<a class="code" href="hashtab_8h.html#468764de892a2303272613f54f955b0b">OBJ_REG</a>,(u_long)1,&amp;<a class="code" href="webalizer_8c.html#681645a12ff433a6d191ac4eabbb265d">t_agent</a>,<a class="code" href="hashtab_8c.html#4886dbd661ad553906dc83e1a8031316">am_htab</a>))
<a name="l01221"></a>01221              {
<a name="l01222"></a>01222               <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>)
<a name="l01223"></a>01223               fprintf(stderr,<span class="stringliteral">"%s %s\n"</span>, msg_nomem_a, <a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#b512bdcfac62ef38139eaf1701994a4f">agent</a>);
<a name="l01224"></a>01224              }
<a name="l01225"></a>01225          }
<a name="l01226"></a>01226 
<a name="l01227"></a>01227          <span class="comment">/* bump monthly/daily/hourly totals        */</span>
<a name="l01228"></a>01228          <a class="code" href="webalizer_8c.html#4f0e430951167c36ff37f1373c453d40">t_hit</a>++; <a class="code" href="webalizer_8c.html#14a295f77051b0898135267236453dd6">ht_hit</a>++;                         <span class="comment">/* daily/hourly hits    */</span>
<a name="l01229"></a>01229          <a class="code" href="webalizer_8c.html#1952e11824da591d81fdf3371627ae86">t_xfer</a> += <a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#8147dacfe44060fa40bb3caf79e3fdd1">xfer_size</a>;               <span class="comment">/* total xfer size      */</span>
<a name="l01230"></a>01230          <a class="code" href="webalizer_8c.html#d8577082542e8d61ae9d21b5cdc09de6">tm_xfer</a>[rec_day-1] += <a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#8147dacfe44060fa40bb3caf79e3fdd1">xfer_size</a>;   <span class="comment">/* daily xfer total     */</span>
<a name="l01231"></a>01231          <a class="code" href="webalizer_8c.html#90b2c6f5c71d87e07a6aa0694651c7a8">tm_hit</a>[rec_day-1]++;                       <span class="comment">/* daily hits total     */</span>
<a name="l01232"></a>01232          <a class="code" href="webalizer_8c.html#a063714cc339793854ef49bb72c4382b">th_xfer</a>[rec_hour] += <a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#8147dacfe44060fa40bb3caf79e3fdd1">xfer_size</a>;    <span class="comment">/* hourly xfer total    */</span>
<a name="l01233"></a>01233          <a class="code" href="webalizer_8c.html#2c634f4ff63cf16a5bb219632d9da1f5">th_hit</a>[rec_hour]++;                        <span class="comment">/* hourly hits total    */</span>
<a name="l01234"></a>01234    
<a name="l01235"></a>01235          <span class="comment">/* if RC_OK, increase file counters */</span>
<a name="l01236"></a>01236          <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#b8db9826a57acc82a4c7d99948a9b89c">resp_code</a> == <a class="code" href="webalizer_8h.html#c96a9e3f6c17299d532eb572ef0ea415">RC_OK</a>)
<a name="l01237"></a>01237          {
<a name="l01238"></a>01238             <a class="code" href="webalizer_8c.html#8d8f1b3ebaff4207130ee4e068a74578">t_file</a>++;
<a name="l01239"></a>01239             <a class="code" href="webalizer_8c.html#985c7f07bdd01aea04be87abba0d225b">tm_file</a>[rec_day-1]++;
<a name="l01240"></a>01240             <a class="code" href="webalizer_8c.html#8d6ce1fa8aba3c7f1ed1c7e19ea0541c">th_file</a>[rec_hour]++;
<a name="l01241"></a>01241          }
<a name="l01242"></a>01242 
<a name="l01243"></a>01243          <span class="comment">/* Pages (pageview) calculation */</span>
<a name="l01244"></a>01244          <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#875f50fc519d72b2f46b8413cb1a9c45">ispage</a>(<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#479e09f2dc389f8a0a57b9c3146d9d32">url</a>))
<a name="l01245"></a>01245          {
<a name="l01246"></a>01246             <a class="code" href="webalizer_8c.html#dab177cb0d83726239072547f166262a">t_page</a>++;
<a name="l01247"></a>01247             <a class="code" href="webalizer_8c.html#2b0163914dcd84396a9d6dae48ee4a54">tm_page</a>[rec_day-1]++;
<a name="l01248"></a>01248             <a class="code" href="webalizer_8c.html#cdb9ccdbdd487d188cd174056a7dcd80">th_page</a>[rec_hour]++;
<a name="l01249"></a>01249 
<a name="l01250"></a>01250             <span class="comment">/* do search string stuff if needed     */</span>
<a name="l01251"></a>01251             <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#57e3ec40e1f85e8b2620950dc43b753f">ntop_search</a>) <a class="code" href="webalizer_8c.html#2b1002ec17d1cd1e6901514b8b6de058">srch_string</a>(<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#56f5b706fac667b9d9309ad128e5a102">srchstr</a>);
<a name="l01252"></a>01252          }
<a name="l01253"></a>01253 
<a name="l01254"></a>01254          <span class="comment">/*********************************************/</span>
<a name="l01255"></a>01255          <span class="comment">/* RECORD PROCESSED - DO GROUPS HERE         */</span> 
<a name="l01256"></a>01256          <span class="comment">/*********************************************/</span>
<a name="l01257"></a>01257 
<a name="l01258"></a>01258          <span class="comment">/* URL Grouping */</span>
<a name="l01259"></a>01259          <span class="keywordflow">if</span> ( (cp1=<a class="code" href="linklist_8c.html#70d3ef92faca75f6392ba919975ffe47">isinglist</a>(<a class="code" href="linklist_8c.html#2b91bf4fd34380ee9673b57513dbff01">group_urls</a>,<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#479e09f2dc389f8a0a57b9c3146d9d32">url</a>))!=NULL)
<a name="l01260"></a>01260          {
<a name="l01261"></a>01261             <span class="keywordflow">if</span> (<a class="code" href="hashtab_8c.html#c4f10ed3d908404570fa30fae460b7d0">put_unode</a>(cp1,<a class="code" href="hashtab_8h.html#b2fd3e100a904891f4c27eb46e87140f">OBJ_GRP</a>,(u_long)1,<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#8147dacfe44060fa40bb3caf79e3fdd1">xfer_size</a>,
<a name="l01262"></a>01262                 &amp;<a class="code" href="webalizer_8c.html#e29a508fc80a24e71cc41101f6bf9039">ul_bogus</a>,(u_long)0,(u_long)0,<a class="code" href="hashtab_8c.html#2f99d64abd1711a4b10ee71d070811a7">um_htab</a>))
<a name="l01263"></a>01263             {
<a name="l01264"></a>01264                <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>)
<a name="l01265"></a>01265                <span class="comment">/* Error adding URL node, skipping ... */</span>
<a name="l01266"></a>01266                fprintf(stderr,<span class="stringliteral">"%s %s\n"</span>, msg_nomem_u, cp1);
<a name="l01267"></a>01267             }
<a name="l01268"></a>01268          }
<a name="l01269"></a>01269 
<a name="l01270"></a>01270          <span class="comment">/* Site Grouping */</span>
<a name="l01271"></a>01271          <span class="keywordflow">if</span> ( (cp1=<a class="code" href="linklist_8c.html#70d3ef92faca75f6392ba919975ffe47">isinglist</a>(<a class="code" href="linklist_8c.html#cda3597076ed2d11c457ee98bb89caa7">group_sites</a>,<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#8d92ed4a00d2d6b0f155bdbfcc551478">hostname</a>))!=NULL)
<a name="l01272"></a>01272          {
<a name="l01273"></a>01273             <span class="keywordflow">if</span> (<a class="code" href="hashtab_8c.html#f2f25ed90b609c69446b8446454ca7a0">put_hnode</a>(cp1,<a class="code" href="hashtab_8h.html#b2fd3e100a904891f4c27eb46e87140f">OBJ_GRP</a>,1,(u_long)(<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#b8db9826a57acc82a4c7d99948a9b89c">resp_code</a>==<a class="code" href="webalizer_8h.html#c96a9e3f6c17299d532eb572ef0ea415">RC_OK</a>)?1:0,
<a name="l01274"></a>01274                           <a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#8147dacfe44060fa40bb3caf79e3fdd1">xfer_size</a>,&amp;<a class="code" href="webalizer_8c.html#e29a508fc80a24e71cc41101f6bf9039">ul_bogus</a>,
<a name="l01275"></a>01275                           0,<a class="code" href="webalizer_8c.html#f385cef2f38414353e7bc598d05b76c5">rec_tstamp</a>,<span class="stringliteral">""</span>,<a class="code" href="hashtab_8c.html#408742678920fdb90b2926c215e8e19c">sm_htab</a>))
<a name="l01276"></a>01276             {
<a name="l01277"></a>01277                <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>)
<a name="l01278"></a>01278                <span class="comment">/* Error adding Site node, skipping ... */</span>
<a name="l01279"></a>01279                fprintf(stderr,<span class="stringliteral">"%s %s\n"</span>, msg_nomem_mh, cp1);
<a name="l01280"></a>01280             }
<a name="l01281"></a>01281          }
<a name="l01282"></a>01282          <span class="keywordflow">else</span>
<a name="l01283"></a>01283          {
<a name="l01284"></a>01284             <span class="comment">/* Domain Grouping */</span>
<a name="l01285"></a>01285             <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#3b91bd084088b32764aaa00f48083faf">group_domains</a>)
<a name="l01286"></a>01286             {
<a name="l01287"></a>01287                cp1 = <a class="code" href="webalizer_8c.html#4c24c3d81b9c48e9f490919de3e32afb">get_domain</a>(<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#8d92ed4a00d2d6b0f155bdbfcc551478">hostname</a>);
<a name="l01288"></a>01288                <span class="keywordflow">if</span> (cp1 != NULL)
<a name="l01289"></a>01289                {
<a name="l01290"></a>01290                   <span class="keywordflow">if</span> (<a class="code" href="hashtab_8c.html#f2f25ed90b609c69446b8446454ca7a0">put_hnode</a>(cp1,<a class="code" href="hashtab_8h.html#b2fd3e100a904891f4c27eb46e87140f">OBJ_GRP</a>,1,
<a name="l01291"></a>01291                       (u_long)(<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#b8db9826a57acc82a4c7d99948a9b89c">resp_code</a>==<a class="code" href="webalizer_8h.html#c96a9e3f6c17299d532eb572ef0ea415">RC_OK</a>)?1:0,
<a name="l01292"></a>01292                       <a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#8147dacfe44060fa40bb3caf79e3fdd1">xfer_size</a>,&amp;<a class="code" href="webalizer_8c.html#e29a508fc80a24e71cc41101f6bf9039">ul_bogus</a>,
<a name="l01293"></a>01293                       0,<a class="code" href="webalizer_8c.html#f385cef2f38414353e7bc598d05b76c5">rec_tstamp</a>,<span class="stringliteral">""</span>,<a class="code" href="hashtab_8c.html#408742678920fdb90b2926c215e8e19c">sm_htab</a>))
<a name="l01294"></a>01294                   {
<a name="l01295"></a>01295                      <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>)
<a name="l01296"></a>01296                      <span class="comment">/* Error adding Site node, skipping ... */</span>
<a name="l01297"></a>01297                      fprintf(stderr,<span class="stringliteral">"%s %s\n"</span>, msg_nomem_mh, cp1);
<a name="l01298"></a>01298                   }
<a name="l01299"></a>01299                }
<a name="l01300"></a>01300             }
<a name="l01301"></a>01301          }
<a name="l01302"></a>01302 
<a name="l01303"></a>01303          <span class="comment">/* Referrer Grouping */</span>
<a name="l01304"></a>01304          <span class="keywordflow">if</span> ( (cp1=<a class="code" href="linklist_8c.html#70d3ef92faca75f6392ba919975ffe47">isinglist</a>(<a class="code" href="linklist_8c.html#73820e36830211218e9c911bc6ea6273">group_refs</a>,<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#cb4f74246c1b97c518bbcc8a4823c0d4">refer</a>))!=NULL)
<a name="l01305"></a>01305          {
<a name="l01306"></a>01306             <span class="keywordflow">if</span> (<a class="code" href="hashtab_8c.html#b4002d9ddebb92b4a979361424d2e51b">put_rnode</a>(cp1,<a class="code" href="hashtab_8h.html#b2fd3e100a904891f4c27eb46e87140f">OBJ_GRP</a>,(u_long)1,&amp;<a class="code" href="webalizer_8c.html#e29a508fc80a24e71cc41101f6bf9039">ul_bogus</a>,<a class="code" href="hashtab_8c.html#4b36877a2219872c641eb9a58ae45ce8">rm_htab</a>))
<a name="l01307"></a>01307             {
<a name="l01308"></a>01308                <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>)
<a name="l01309"></a>01309                <span class="comment">/* Error adding Referrer node, skipping ... */</span>
<a name="l01310"></a>01310                fprintf(stderr,<span class="stringliteral">"%s %s\n"</span>, msg_nomem_r, cp1);
<a name="l01311"></a>01311             }
<a name="l01312"></a>01312          }
<a name="l01313"></a>01313 
<a name="l01314"></a>01314          <span class="comment">/* User Agent Grouping */</span>
<a name="l01315"></a>01315          <span class="keywordflow">if</span> ( (cp1=<a class="code" href="linklist_8c.html#70d3ef92faca75f6392ba919975ffe47">isinglist</a>(<a class="code" href="linklist_8c.html#2acbebab9914d67a3cea0f3716324fe2">group_agents</a>,<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#b512bdcfac62ef38139eaf1701994a4f">agent</a>))!=NULL)
<a name="l01316"></a>01316          {
<a name="l01317"></a>01317             <span class="keywordflow">if</span> (<a class="code" href="hashtab_8c.html#696c253a54bee8d869c852d86c1f145e">put_anode</a>(cp1,<a class="code" href="hashtab_8h.html#b2fd3e100a904891f4c27eb46e87140f">OBJ_GRP</a>,(u_long)1,&amp;<a class="code" href="webalizer_8c.html#e29a508fc80a24e71cc41101f6bf9039">ul_bogus</a>,<a class="code" href="hashtab_8c.html#4886dbd661ad553906dc83e1a8031316">am_htab</a>))
<a name="l01318"></a>01318             {
<a name="l01319"></a>01319                <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>)
<a name="l01320"></a>01320                <span class="comment">/* Error adding User Agent node, skipping ... */</span>
<a name="l01321"></a>01321                fprintf(stderr,<span class="stringliteral">"%s %s\n"</span>, msg_nomem_a, cp1);
<a name="l01322"></a>01322             }
<a name="l01323"></a>01323          }
<a name="l01324"></a>01324 
<a name="l01325"></a>01325          <span class="comment">/* Ident (username) Grouping */</span>
<a name="l01326"></a>01326          <span class="keywordflow">if</span> ( (cp1=<a class="code" href="linklist_8c.html#70d3ef92faca75f6392ba919975ffe47">isinglist</a>(<a class="code" href="linklist_8c.html#5589f953a1673e7a2f3891d321794340">group_users</a>,<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#abac03796cba2fed0c5185a55e5578bd">ident</a>))!=NULL)
<a name="l01327"></a>01327          {
<a name="l01328"></a>01328             <span class="keywordflow">if</span> (<a class="code" href="hashtab_8c.html#9febd80a08973165c09cd1f42f429838">put_inode</a>(cp1,<a class="code" href="hashtab_8h.html#b2fd3e100a904891f4c27eb46e87140f">OBJ_GRP</a>,1,(u_long)(<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#b8db9826a57acc82a4c7d99948a9b89c">resp_code</a>==<a class="code" href="webalizer_8h.html#c96a9e3f6c17299d532eb572ef0ea415">RC_OK</a>)?1:0,
<a name="l01329"></a>01329                           <a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#8147dacfe44060fa40bb3caf79e3fdd1">xfer_size</a>,&amp;<a class="code" href="webalizer_8c.html#e29a508fc80a24e71cc41101f6bf9039">ul_bogus</a>,
<a name="l01330"></a>01330                           0,<a class="code" href="webalizer_8c.html#f385cef2f38414353e7bc598d05b76c5">rec_tstamp</a>,<a class="code" href="hashtab_8c.html#1a7bfe1ecf3b78722bcee9d08e8178a1">im_htab</a>))
<a name="l01331"></a>01331             {
<a name="l01332"></a>01332                <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>)
<a name="l01333"></a>01333                <span class="comment">/* Error adding Username node, skipping ... */</span>
<a name="l01334"></a>01334                fprintf(stderr,<span class="stringliteral">"%s %s\n"</span>, msg_nomem_i, cp1);
<a name="l01335"></a>01335             }
<a name="l01336"></a>01336          }
<a name="l01337"></a>01337       }
<a name="l01338"></a>01338 
<a name="l01339"></a>01339       <span class="comment">/*********************************************/</span>
<a name="l01340"></a>01340       <span class="comment">/* BAD RECORD                                */</span>
<a name="l01341"></a>01341       <span class="comment">/*********************************************/</span>
<a name="l01342"></a>01342 
<a name="l01343"></a>01343       <span class="keywordflow">else</span>
<a name="l01344"></a>01344       {
<a name="l01345"></a>01345          <span class="comment">/* If first record, check if stupid Netscape header stuff      */</span>
<a name="l01346"></a>01346          <span class="keywordflow">if</span> ( (total_rec==1) &amp;&amp; (strncmp(buffer,<span class="stringliteral">"format="</span>,7)==0) )
<a name="l01347"></a>01347          {
<a name="l01348"></a>01348             <span class="comment">/* Skipping Netscape header record */</span>
<a name="l01349"></a>01349             <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>&gt;1) printf(<span class="stringliteral">"%s\n"</span>,msg_ign_nscp);
<a name="l01350"></a>01350             <span class="comment">/* count it as ignored... */</span>
<a name="l01351"></a>01351             total_ignore++;
<a name="l01352"></a>01352          }
<a name="l01353"></a>01353          <span class="keywordflow">else</span>
<a name="l01354"></a>01354          {
<a name="l01355"></a>01355             <span class="comment">/* really bad record... */</span>
<a name="l01356"></a>01356             total_bad++;
<a name="l01357"></a>01357             <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>)
<a name="l01358"></a>01358             {
<a name="l01359"></a>01359                fprintf(stderr,<span class="stringliteral">"%s (%lu)"</span>,msg_bad_rec,total_rec);
<a name="l01360"></a>01360                <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#4f7caf3ead45aac3963d1e354e820017">debug_mode</a>) fprintf(stderr,<span class="stringliteral">":\n%s\n"</span>,<a class="code" href="webalizer_8c.html#ee9788649de43fb36bc42d15b1c829ff">tmp_buf</a>);
<a name="l01361"></a>01361                <span class="keywordflow">else</span> fprintf(stderr,<span class="stringliteral">"\n"</span>);
<a name="l01362"></a>01362             }
<a name="l01363"></a>01363          }
<a name="l01364"></a>01364       }
<a name="l01365"></a>01365    }
<a name="l01366"></a>01366 
<a name="l01367"></a>01367    <span class="comment">/*********************************************/</span>
<a name="l01368"></a>01368    <span class="comment">/* DONE READING LOG FILE - final processing  */</span>
<a name="l01369"></a>01369    <span class="comment">/*********************************************/</span>
<a name="l01370"></a>01370 
<a name="l01371"></a>01371    <span class="comment">/* close log file if needed */</span>
<a name="l01372"></a>01372    <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#480128e1291f32b04678ddac9dc69457">gz_log</a>) gzclose(gzlog_fp);
<a name="l01373"></a>01373    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#9db6dddd9890ca88ccca763b0533919b">log_fname</a>) fclose(<a class="code" href="webalizer_8c.html#a574e45a6e318dd8f45530c13db10cc1">log_fp</a>);
<a name="l01374"></a>01374 
<a name="l01375"></a>01375    <span class="keywordflow">if</span> (good_rec)                             <span class="comment">/* were any good records?   */</span>
<a name="l01376"></a>01376    {
<a name="l01377"></a>01377       <a class="code" href="webalizer_8c.html#3016395581c35bac86027a654deb0db5">tm_site</a>[<a class="code" href="webalizer_8c.html#6edfa42467177fc02002d61038a98f39">cur_day</a>-1]=<a class="code" href="webalizer_8c.html#f80cf0d40e63789f26cf6ee643eb3b4c">dt_site</a>;            <span class="comment">/* If yes, clean up a bit   */</span>
<a name="l01378"></a>01378       <a class="code" href="webalizer_8c.html#f3d33c8d579ff7b3d41abb0e618f70a5">tm_visit</a>[<a class="code" href="webalizer_8c.html#6edfa42467177fc02002d61038a98f39">cur_day</a>-1]=<a class="code" href="hashtab_8c.html#c7baccdb17212972eee28ccc861dd307">tot_visit</a>(<a class="code" href="hashtab_8c.html#e5ddad8435a9d403e79f4bd320fea151">sd_htab</a>);
<a name="l01379"></a>01379       <a class="code" href="webalizer_8c.html#241257c2fb7477a7dc9191c01e8a155a">t_visit</a>=<a class="code" href="hashtab_8c.html#c7baccdb17212972eee28ccc861dd307">tot_visit</a>(<a class="code" href="hashtab_8c.html#408742678920fdb90b2926c215e8e19c">sm_htab</a>);
<a name="l01380"></a>01380       <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#14a295f77051b0898135267236453dd6">ht_hit</a> &gt; <a class="code" href="webalizer_8c.html#0fbe52a528ae909f4058a35bdab8d034">mh_hit</a>) <a class="code" href="webalizer_8c.html#0fbe52a528ae909f4058a35bdab8d034">mh_hit</a> = <a class="code" href="webalizer_8c.html#14a295f77051b0898135267236453dd6">ht_hit</a>;
<a name="l01381"></a>01381 
<a name="l01382"></a>01382       <span class="keywordflow">if</span> (total_rec &gt; (total_ignore+total_bad)) <span class="comment">/* did we process any?   */</span>
<a name="l01383"></a>01383       {
<a name="l01384"></a>01384          <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#534a10f9409e025831882efe4a58f959">incremental</a>)
<a name="l01385"></a>01385          {
<a name="l01386"></a>01386             <span class="keywordflow">if</span> (<a class="code" href="preserve_8c.html#30d384683c4584a041792cf314051fa3">save_state</a>())                <span class="comment">/* incremental stuff        */</span>
<a name="l01387"></a>01387             {
<a name="l01388"></a>01388                <span class="comment">/* Error: Unable to save current run data */</span>
<a name="l01389"></a>01389                <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) fprintf(stderr,<span class="stringliteral">"%s\n"</span>,msg_data_err);
<a name="l01390"></a>01390                unlink(<a class="code" href="webalizer_8c.html#bc6083147b471a6df297cc5851057771">state_fname</a>);
<a name="l01391"></a>01391             }
<a name="l01392"></a>01392          }
<a name="l01393"></a>01393          <a class="code" href="hashtab_8c.html#8bd37405a172f7642453f9a1fae7438f">month_update_exit</a>(<a class="code" href="webalizer_8c.html#f385cef2f38414353e7bc598d05b76c5">rec_tstamp</a>);      <span class="comment">/* calculate exit pages     */</span>
<a name="l01394"></a>01394          <a class="code" href="output_8c.html#a88c70787fac7e72d1f6509b38b6bcab">write_month_html</a>();                 <span class="comment">/* write monthly HTML file  */</span>
<a name="l01395"></a>01395          <a class="code" href="output_8c.html#90b458b70bbeed91acc9ec79062f6ac7">write_main_index</a>();                 <span class="comment">/* write main HTML file     */</span>
<a name="l01396"></a>01396          <a class="code" href="preserve_8c.html#0725425e14f501da1e2fc612d7854c01">put_history</a>();                      <span class="comment">/* write history            */</span>
<a name="l01397"></a>01397       }
<a name="l01398"></a>01398 
<a name="l01399"></a>01399       end_time = times(&amp;mytms);              <span class="comment">/* display timing totals?   */</span>
<a name="l01400"></a>01400       <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#445501b8b84e1293820c0142acd34113">time_me</a> || (<a class="code" href="webalizer_8c.html#0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>&gt;1))
<a name="l01401"></a>01401       {
<a name="l01402"></a>01402          printf(<span class="stringliteral">"%lu %s "</span>,total_rec, msg_records);
<a name="l01403"></a>01403          <span class="keywordflow">if</span> (total_ignore)
<a name="l01404"></a>01404          {
<a name="l01405"></a>01405             printf(<span class="stringliteral">"(%lu %s"</span>,total_ignore,msg_ignored);
<a name="l01406"></a>01406             <span class="keywordflow">if</span> (total_bad) printf(<span class="stringliteral">", %lu %s) "</span>,total_bad,msg_bad);
<a name="l01407"></a>01407                <span class="keywordflow">else</span>        printf(<span class="stringliteral">") "</span>);
<a name="l01408"></a>01408          }
<a name="l01409"></a>01409          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (total_bad) printf(<span class="stringliteral">"(%lu %s) "</span>,total_bad,msg_bad);
<a name="l01410"></a>01410 
<a name="l01411"></a>01411          <span class="comment">/* get processing time (end-start) */</span>
<a name="l01412"></a>01412          temp_time = (float)(end_time-start_time)/<a class="code" href="dns__resolv_8c.html#03df76d1f70664d745ca8de2864e39b3">CLK_TCK</a>;
<a name="l01413"></a>01413          printf(<span class="stringliteral">"%s %.2f %s"</span>, msg_in, temp_time, msg_seconds);
<a name="l01414"></a>01414 
<a name="l01415"></a>01415          <span class="comment">/* calculate records per second */</span>
<a name="l01416"></a>01416          <span class="keywordflow">if</span> (temp_time)
<a name="l01417"></a>01417            i=( (int)( (<span class="keywordtype">float</span>)total_rec/temp_time ) );
<a name="l01418"></a>01418          <span class="keywordflow">else</span> i=0;
<a name="l01419"></a>01419 
<a name="l01420"></a>01420          <span class="keywordflow">if</span> ( (i&gt;0) &amp;&amp; (i&lt;=total_rec) ) printf(<span class="stringliteral">", %d/sec\n"</span>, i);
<a name="l01421"></a>01421             <span class="keywordflow">else</span>  printf(<span class="stringliteral">"\n"</span>);
<a name="l01422"></a>01422       }
<a name="l01423"></a>01423 
<a name="l01424"></a>01424 <span class="preprocessor">#ifdef USE_DNS</span>
<a name="l01425"></a>01425 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (dns_db) close_cache();
<a name="l01426"></a>01426 <span class="preprocessor">#endif</span>
<a name="l01427"></a>01427 <span class="preprocessor"></span>
<a name="l01428"></a>01428       <span class="comment">/* Whew, all done! Exit with completion status (0) */</span>
<a name="l01429"></a>01429       exit(0);
<a name="l01430"></a>01430    }
<a name="l01431"></a>01431    <span class="keywordflow">else</span>
<a name="l01432"></a>01432    {
<a name="l01433"></a>01433       <span class="comment">/* No valid records found... exit with error (1) */</span>
<a name="l01434"></a>01434       <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">"%s\n"</span>,msg_no_vrec);
<a name="l01435"></a>01435       exit(1);
<a name="l01436"></a>01436    }
<a name="l01437"></a>01437 }
<a name="l01438"></a>01438 
<a name="l01439"></a>01439 <span class="comment">/*********************************************/</span>
<a name="l01440"></a>01440 <span class="comment">/* GET_CONFIG - get configuration file info  */</span>
<a name="l01441"></a>01441 <span class="comment">/*********************************************/</span>
<a name="l01442"></a>01442 
<a name="l01443"></a><a class="code" href="webalizer_8c.html#7e50c67e6aba9c0c3025c04b0a7aedc4">01443</a> <span class="keywordtype">void</span> <a class="code" href="webalizer_8c.html#7e50c67e6aba9c0c3025c04b0a7aedc4">get_config</a>(<span class="keywordtype">char</span> *fname)
<a name="l01444"></a>01444 {
<a name="l01445"></a>01445    <span class="keywordtype">char</span> *kwords[]= { <span class="stringliteral">"Undefined"</span>,         <span class="comment">/* 0 = undefined keyword       0  */</span>
<a name="l01446"></a>01446                      <span class="stringliteral">"OutputDir"</span>,         <span class="comment">/* Output directory            1  */</span>
<a name="l01447"></a>01447                      <span class="stringliteral">"LogFile"</span>,           <span class="comment">/* Log file to use for input   2  */</span>
<a name="l01448"></a>01448                      <span class="stringliteral">"ReportTitle"</span>,       <span class="comment">/* Title for reports           3  */</span>
<a name="l01449"></a>01449                      <span class="stringliteral">"HostName"</span>,          <span class="comment">/* Hostname to use             4  */</span>
<a name="l01450"></a>01450                      <span class="stringliteral">"IgnoreHist"</span>,        <span class="comment">/* Ignore history file         5  */</span>
<a name="l01451"></a>01451                      <span class="stringliteral">"Quiet"</span>,             <span class="comment">/* Run in quiet mode           6  */</span>
<a name="l01452"></a>01452                      <span class="stringliteral">"TimeMe"</span>,            <span class="comment">/* Produce timing results      7  */</span>
<a name="l01453"></a>01453                      <span class="stringliteral">"Debug"</span>,             <span class="comment">/* Produce debug information   8  */</span>
<a name="l01454"></a>01454                      <span class="stringliteral">"HourlyGraph"</span>,       <span class="comment">/* Hourly stats graph          9  */</span>
<a name="l01455"></a>01455                      <span class="stringliteral">"HourlyStats"</span>,       <span class="comment">/* Hourly stats table         10  */</span>
<a name="l01456"></a>01456                      <span class="stringliteral">"TopSites"</span>,          <span class="comment">/* Top sites                  11  */</span>
<a name="l01457"></a>01457                      <span class="stringliteral">"TopURLs"</span>,           <span class="comment">/* Top URL's                  12  */</span>
<a name="l01458"></a>01458                      <span class="stringliteral">"TopReferrers"</span>,      <span class="comment">/* Top Referrers              13  */</span>
<a name="l01459"></a>01459                      <span class="stringliteral">"TopAgents"</span>,         <span class="comment">/* Top User Agents            14  */</span>
<a name="l01460"></a>01460                      <span class="stringliteral">"TopCountries"</span>,      <span class="comment">/* Top Countries              15  */</span>
<a name="l01461"></a>01461                      <span class="stringliteral">"HideSite"</span>,          <span class="comment">/* Sites to hide              16  */</span>
<a name="l01462"></a>01462                      <span class="stringliteral">"HideURL"</span>,           <span class="comment">/* URL's to hide              17  */</span>
<a name="l01463"></a>01463                      <span class="stringliteral">"HideReferrer"</span>,      <span class="comment">/* Referrers to hide          18  */</span>
<a name="l01464"></a>01464                      <span class="stringliteral">"HideAgent"</span>,         <span class="comment">/* User Agents to hide        19  */</span>
<a name="l01465"></a>01465                      <span class="stringliteral">"IndexAlias"</span>,        <span class="comment">/* Aliases for index.html     20  */</span>
<a name="l01466"></a>01466                      <span class="stringliteral">"HTMLHead"</span>,          <span class="comment">/* HTML Top1 code             21  */</span>
<a name="l01467"></a>01467                      <span class="stringliteral">"HTMLPost"</span>,          <span class="comment">/* HTML Top2 code             22  */</span>
<a name="l01468"></a>01468                      <span class="stringliteral">"HTMLTail"</span>,          <span class="comment">/* HTML Tail code             23  */</span>
<a name="l01469"></a>01469                      <span class="stringliteral">"MangleAgents"</span>,      <span class="comment">/* Mangle User Agents         24  */</span>
<a name="l01470"></a>01470                      <span class="stringliteral">"IgnoreSite"</span>,        <span class="comment">/* Sites to ignore            25  */</span>
<a name="l01471"></a>01471                      <span class="stringliteral">"IgnoreURL"</span>,         <span class="comment">/* Url's to ignore            26  */</span>
<a name="l01472"></a>01472                      <span class="stringliteral">"IgnoreReferrer"</span>,    <span class="comment">/* Referrers to ignore        27  */</span>
<a name="l01473"></a>01473                      <span class="stringliteral">"IgnoreAgent"</span>,       <span class="comment">/* User Agents to ignore      28  */</span>
<a name="l01474"></a>01474                      <span class="stringliteral">"ReallyQuiet"</span>,       <span class="comment">/* Dont display ANY messages  29  */</span>
<a name="l01475"></a>01475                      <span class="stringliteral">"GMTTime"</span>,           <span class="comment">/* Local or UTC time?         30  */</span>
<a name="l01476"></a>01476                      <span class="stringliteral">"GroupURL"</span>,          <span class="comment">/* Group URL's                31  */</span>
<a name="l01477"></a>01477                      <span class="stringliteral">"GroupSite"</span>,         <span class="comment">/* Group Sites                32  */</span>
<a name="l01478"></a>01478                      <span class="stringliteral">"GroupReferrer"</span>,     <span class="comment">/* Group Referrers            33  */</span>
<a name="l01479"></a>01479                      <span class="stringliteral">"GroupAgent"</span>,        <span class="comment">/* Group Agents               34  */</span>
<a name="l01480"></a>01480                      <span class="stringliteral">"GroupShading"</span>,      <span class="comment">/* Shade Grouped entries      35  */</span>
<a name="l01481"></a>01481                      <span class="stringliteral">"GroupHighlight"</span>,    <span class="comment">/* BOLD Grouped entries       36  */</span>
<a name="l01482"></a>01482                      <span class="stringliteral">"Incremental"</span>,       <span class="comment">/* Incremental runs           37  */</span>
<a name="l01483"></a>01483                      <span class="stringliteral">"IncrementalName"</span>,   <span class="comment">/* Filename for state data    38  */</span>
<a name="l01484"></a>01484                      <span class="stringliteral">"HistoryName"</span>,       <span class="comment">/* Filename for history data  39  */</span>
<a name="l01485"></a>01485                      <span class="stringliteral">"HTMLExtension"</span>,     <span class="comment">/* HTML filename extension    40  */</span>
<a name="l01486"></a>01486                      <span class="stringliteral">"HTMLPre"</span>,           <span class="comment">/* HTML code at beginning     41  */</span>
<a name="l01487"></a>01487                      <span class="stringliteral">"HTMLBody"</span>,          <span class="comment">/* HTML body code             42  */</span>
<a name="l01488"></a>01488                      <span class="stringliteral">"HTMLEnd"</span>,           <span class="comment">/* HTML code at end           43  */</span>
<a name="l01489"></a>01489                      <span class="stringliteral">"UseHTTPS"</span>,          <span class="comment">/* Use https:// on URL's      44  */</span>
<a name="l01490"></a>01490                      <span class="stringliteral">"IncludeSite"</span>,       <span class="comment">/* Sites to always include    45  */</span>
<a name="l01491"></a>01491                      <span class="stringliteral">"IncludeURL"</span>,        <span class="comment">/* URL's to always include    46  */</span>
<a name="l01492"></a>01492                      <span class="stringliteral">"IncludeReferrer"</span>,   <span class="comment">/* Referrers to include       47  */</span>
<a name="l01493"></a>01493                      <span class="stringliteral">"IncludeAgent"</span>,      <span class="comment">/* User Agents to include     48  */</span>
<a name="l01494"></a>01494                      <span class="stringliteral">"PageType"</span>,          <span class="comment">/* Page Type (pageview)       49  */</span>
<a name="l01495"></a>01495                      <span class="stringliteral">"VisitTimeout"</span>,      <span class="comment">/* Visit timeout (seconds)    50  */</span>
<a name="l01496"></a>01496                      <span class="stringliteral">"GraphLegend"</span>,       <span class="comment">/* Graph Legends (yes/no)     51  */</span>
<a name="l01497"></a>01497                      <span class="stringliteral">"GraphLines"</span>,        <span class="comment">/* Graph Lines (0=none)       52  */</span>
<a name="l01498"></a>01498                      <span class="stringliteral">"FoldSeqErr"</span>,        <span class="comment">/* Fold sequence errors       53  */</span>
<a name="l01499"></a>01499                      <span class="stringliteral">"CountryGraph"</span>,      <span class="comment">/* Display ctry graph (0=no)  54  */</span>
<a name="l01500"></a>01500                      <span class="stringliteral">"TopKSites"</span>,         <span class="comment">/* Top sites (by KBytes)      55  */</span>
<a name="l01501"></a>01501                      <span class="stringliteral">"TopKURLs"</span>,          <span class="comment">/* Top URL's (by KBytes)      56  */</span>
<a name="l01502"></a>01502                      <span class="stringliteral">"TopEntry"</span>,          <span class="comment">/* Top Entry Pages            57  */</span>
<a name="l01503"></a>01503                      <span class="stringliteral">"TopExit"</span>,           <span class="comment">/* Top Exit Pages             58  */</span>
<a name="l01504"></a>01504                      <span class="stringliteral">"TopSearch"</span>,         <span class="comment">/* Top Search Strings         59  */</span>
<a name="l01505"></a>01505                      <span class="stringliteral">"LogType"</span>,           <span class="comment">/* Log Type (clf/ftp/squid)   60  */</span>
<a name="l01506"></a>01506                      <span class="stringliteral">"SearchEngine"</span>,      <span class="comment">/* SearchEngine strings       61  */</span>
<a name="l01507"></a>01507                      <span class="stringliteral">"GroupDomains"</span>,      <span class="comment">/* Group domains (n=level)    62  */</span>
<a name="l01508"></a>01508                      <span class="stringliteral">"HideAllSites"</span>,      <span class="comment">/* Hide ind. sites (0=no)     63  */</span>
<a name="l01509"></a>01509                      <span class="stringliteral">"AllSites"</span>,          <span class="comment">/* List all sites?            64  */</span>
<a name="l01510"></a>01510                      <span class="stringliteral">"AllURLs"</span>,           <span class="comment">/* List all URLs?             65  */</span>
<a name="l01511"></a>01511                      <span class="stringliteral">"AllReferrers"</span>,      <span class="comment">/* List all Referrers?        66  */</span>
<a name="l01512"></a>01512                      <span class="stringliteral">"AllAgents"</span>,         <span class="comment">/* List all User Agents?      67  */</span>
<a name="l01513"></a>01513                      <span class="stringliteral">"AllSearchStr"</span>,      <span class="comment">/* List all Search Strings?   68  */</span>
<a name="l01514"></a>01514                      <span class="stringliteral">"AllUsers"</span>,          <span class="comment">/* List all Users?            69  */</span>
<a name="l01515"></a>01515                      <span class="stringliteral">"TopUsers"</span>,          <span class="comment">/* Top Usernames to show      70  */</span>
<a name="l01516"></a>01516                      <span class="stringliteral">"HideUser"</span>,          <span class="comment">/* Usernames to hide          71  */</span>
<a name="l01517"></a>01517                      <span class="stringliteral">"IgnoreUser"</span>,        <span class="comment">/* Usernames to ignore        72  */</span>
<a name="l01518"></a>01518                      <span class="stringliteral">"IncludeUser"</span>,       <span class="comment">/* Usernames to include       73  */</span>
<a name="l01519"></a>01519                      <span class="stringliteral">"GroupUser"</span>,         <span class="comment">/* Usernames to group         74  */</span>
<a name="l01520"></a>01520                      <span class="stringliteral">"DumpPath"</span>,          <span class="comment">/* Path for dump files        75  */</span>
<a name="l01521"></a>01521                      <span class="stringliteral">"DumpExtension"</span>,     <span class="comment">/* Dump filename extension    76  */</span>
<a name="l01522"></a>01522                      <span class="stringliteral">"DumpHeader"</span>,        <span class="comment">/* Dump header as first rec?  77  */</span>
<a name="l01523"></a>01523                      <span class="stringliteral">"DumpSites"</span>,         <span class="comment">/* Dump sites tab file        78  */</span>
<a name="l01524"></a>01524                      <span class="stringliteral">"DumpURLs"</span>,          <span class="comment">/* Dump urls tab file         79  */</span>
<a name="l01525"></a>01525                      <span class="stringliteral">"DumpReferrers"</span>,     <span class="comment">/* Dump referrers tab file    80  */</span>
<a name="l01526"></a>01526                      <span class="stringliteral">"DumpAgents"</span>,        <span class="comment">/* Dump user agents tab file  81  */</span>
<a name="l01527"></a>01527                      <span class="stringliteral">"DumpUsers"</span>,         <span class="comment">/* Dump usernames tab file    82  */</span>
<a name="l01528"></a>01528                      <span class="stringliteral">"DumpSearchStr"</span>,     <span class="comment">/* Dump search str tab file   83  */</span>
<a name="l01529"></a>01529                      <span class="stringliteral">"DNSCache"</span>,          <span class="comment">/* DNS Cache file name        84  */</span>
<a name="l01530"></a>01530                      <span class="stringliteral">"DNSChildren"</span>,       <span class="comment">/* DNS Children (0=no DNS)    85  */</span>
<a name="l01531"></a>01531                      <span class="stringliteral">"DailyGraph"</span>,        <span class="comment">/* Daily Graph (0=no)         86  */</span>
<a name="l01532"></a>01532                      <span class="stringliteral">"DailyStats"</span>,        <span class="comment">/* Daily Stats (0=no)         87  */</span>
<a name="l01533"></a>01533                      <span class="stringliteral">"CodeNotFound"</span>       <span class="comment">/* Top 404 errors             88  */</span>
<a name="l01534"></a>01534                    };
<a name="l01535"></a>01535 
<a name="l01536"></a>01536    FILE *fp;
<a name="l01537"></a>01537 
<a name="l01538"></a>01538    <span class="keywordtype">char</span> buffer[<a class="code" href="webalizer_8h.html#eca034f67218340ecb2261a22c2f3dcd">BUFSIZE</a>];
<a name="l01539"></a>01539    <span class="keywordtype">char</span> keyword[32];
<a name="l01540"></a>01540    <span class="keywordtype">char</span> value[132];
<a name="l01541"></a>01541    <span class="keywordtype">char</span> *cp1, *cp2;
<a name="l01542"></a>01542    <span class="keywordtype">int</span>  i,key;
<a name="l01543"></a>01543    <span class="keywordtype">int</span>  num_kwords=<span class="keyword">sizeof</span>(kwords)/<span class="keyword">sizeof</span>(<span class="keywordtype">char</span> *);
<a name="l01544"></a>01544 
<a name="l01545"></a>01545    <span class="keywordflow">if</span> ( (fp=fopen(fname,<span class="stringliteral">"r"</span>)) == NULL)
<a name="l01546"></a>01546    {
<a name="l01547"></a>01547       <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>)
<a name="l01548"></a>01548       fprintf(stderr,<span class="stringliteral">"%s %s\n"</span>,<a class="code" href="lang_8h.html#c96834cc1626aa91d6edfb4f59e3a742">msg_bad_conf</a>,fname);
<a name="l01549"></a>01549       <span class="keywordflow">return</span>;
<a name="l01550"></a>01550    }
<a name="l01551"></a>01551 
<a name="l01552"></a>01552    <span class="keywordflow">while</span> ( (fgets(buffer,<a class="code" href="webalizer_8h.html#eca034f67218340ecb2261a22c2f3dcd">BUFSIZE</a>,fp)) != NULL)
<a name="l01553"></a>01553    {
<a name="l01554"></a>01554       <span class="comment">/* skip comments and blank lines */</span>
<a name="l01555"></a>01555       <span class="keywordflow">if</span> ( (buffer[0]==<span class="charliteral">'#'</span>) || isspace((<span class="keywordtype">int</span>)buffer[0]) ) <span class="keywordflow">continue</span>;
<a name="l01556"></a>01556 
<a name="l01557"></a>01557       <span class="comment">/* Get keyword */</span>
<a name="l01558"></a>01558       cp1=buffer;cp2=keyword;
<a name="l01559"></a>01559       <span class="keywordflow">while</span> ( isalnum((<span class="keywordtype">int</span>)*cp1) ) *cp2++ = *cp1++;
<a name="l01560"></a>01560       *cp2=<span class="charliteral">'\0'</span>;
<a name="l01561"></a>01561 
<a name="l01562"></a>01562       <span class="comment">/* Get value */</span>
<a name="l01563"></a>01563       cp2=value;
<a name="l01564"></a>01564       <span class="keywordflow">while</span> ( (*cp1!=<span class="charliteral">'\n'</span>)&amp;&amp;(*cp1!=<span class="charliteral">'\0'</span>)&amp;&amp;(isspace((<span class="keywordtype">int</span>)*cp1)) ) cp1++;
<a name="l01565"></a>01565       <span class="keywordflow">while</span> ( (*cp1!=<span class="charliteral">'\n'</span>)&amp;&amp;(*cp1!=<span class="charliteral">'\0'</span>) ) *cp2++ = *cp1++;
<a name="l01566"></a>01566       *cp2--=<span class="charliteral">'\0'</span>;
<a name="l01567"></a>01567       <span class="keywordflow">while</span> ( (isspace((<span class="keywordtype">int</span>)*cp2)) &amp;&amp; (cp2 != value) ) *cp2--=<span class="charliteral">'\0'</span>;
<a name="l01568"></a>01568 
<a name="l01569"></a>01569       <span class="comment">/* check if blank keyword/value */</span>
<a name="l01570"></a>01570       <span class="keywordflow">if</span> ( (keyword[0]==<span class="charliteral">'\0'</span>) || (value[0]==<span class="charliteral">'\0'</span>) ) <span class="keywordflow">continue</span>;
<a name="l01571"></a>01571 
<a name="l01572"></a>01572       key=0;
<a name="l01573"></a>01573       <span class="keywordflow">for</span> (i=0;i&lt;num_kwords;i++)
<a name="l01574"></a>01574          <span class="keywordflow">if</span> (!strcmp(keyword,kwords[i])) { key=i; <span class="keywordflow">break</span>; }
<a name="l01575"></a>01575 
<a name="l01576"></a>01576       <span class="keywordflow">if</span> (key==0) { printf(<span class="stringliteral">"%s '%s' (%s)\n"</span>,       <span class="comment">/* Invalid keyword       */</span>
<a name="l01577"></a>01577                     <a class="code" href="lang_8h.html#677f59db55311afd2a3a860c1e36e004">msg_bad_key</a>,keyword,fname);
<a name="l01578"></a>01578                     <span class="keywordflow">continue</span>;
<a name="l01579"></a>01579                   }
<a name="l01580"></a>01580 
<a name="l01581"></a>01581       <span class="keywordflow">switch</span> (key)
<a name="l01582"></a>01582       {
<a name="l01583"></a>01583         <span class="keywordflow">case</span> 1:  <a class="code" href="webalizer_8c.html#6910a5df32ce9909ffbacfafaa6e3645">out_dir</a>=<a class="code" href="webalizer_8c.html#90af490e0665082d8b56fea2667356f4">save_opt</a>(value);          <span class="keywordflow">break</span>; <span class="comment">/* OutputDir      */</span>
<a name="l01584"></a>01584         <span class="keywordflow">case</span> 2:  <a class="code" href="webalizer_8c.html#9db6dddd9890ca88ccca763b0533919b">log_fname</a>=<a class="code" href="webalizer_8c.html#90af490e0665082d8b56fea2667356f4">save_opt</a>(value);        <span class="keywordflow">break</span>; <span class="comment">/* LogFile        */</span>
<a name="l01585"></a>01585         <span class="keywordflow">case</span> 3:  <a class="code" href="lang_8h.html#56970821c884da0e4d8fd75e51bc37d9">msg_title</a>=<a class="code" href="webalizer_8c.html#90af490e0665082d8b56fea2667356f4">save_opt</a>(value);        <span class="keywordflow">break</span>; <span class="comment">/* ReportTitle    */</span>
<a name="l01586"></a>01586         <span class="keywordflow">case</span> 4:  <a class="code" href="webalizer_8c.html#674a1f0ec86ffb26578c11999c89a3c0">hname</a>=<a class="code" href="webalizer_8c.html#90af490e0665082d8b56fea2667356f4">save_opt</a>(value);            <span class="keywordflow">break</span>; <span class="comment">/* HostName       */</span>
<a name="l01587"></a>01587         <span class="keywordflow">case</span> 5:  <a class="code" href="webalizer_8c.html#9c25fea667217c12ecade9cfac496daa">ignore_hist</a>=(value[0]==<span class="charliteral">'n'</span>)?0:1;  <span class="keywordflow">break</span>; <span class="comment">/* IgnoreHist     */</span>
<a name="l01588"></a>01588         <span class="keywordflow">case</span> 6:  <a class="code" href="webalizer_8c.html#0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>=(value[0]==<span class="charliteral">'n'</span>)?2:1;      <span class="keywordflow">break</span>; <span class="comment">/* Quiet          */</span>
<a name="l01589"></a>01589         <span class="keywordflow">case</span> 7:  <a class="code" href="webalizer_8c.html#445501b8b84e1293820c0142acd34113">time_me</a>=(value[0]==<span class="charliteral">'n'</span>)?0:1;      <span class="keywordflow">break</span>; <span class="comment">/* TimeMe         */</span>
<a name="l01590"></a>01590         <span class="keywordflow">case</span> 8:  <a class="code" href="webalizer_8c.html#4f7caf3ead45aac3963d1e354e820017">debug_mode</a>=(value[0]==<span class="charliteral">'n'</span>)?0:1;   <span class="keywordflow">break</span>; <span class="comment">/* Debug          */</span>
<a name="l01591"></a>01591         <span class="keywordflow">case</span> 9:  <a class="code" href="webalizer_8c.html#ef88d69bc7f6d6214835f0f15ef4522a">hourly_graph</a>=(value[0]==<span class="charliteral">'n'</span>)?0:1; <span class="keywordflow">break</span>; <span class="comment">/* HourlyGraph    */</span>
<a name="l01592"></a>01592         <span class="keywordflow">case</span> 10: <a class="code" href="webalizer_8c.html#6359837576bb8bf34e8b6984cee1e53a">hourly_stats</a>=(value[0]==<span class="charliteral">'n'</span>)?0:1; <span class="keywordflow">break</span>; <span class="comment">/* HourlyStats    */</span>
<a name="l01593"></a>01593         <span class="keywordflow">case</span> 11: <a class="code" href="webalizer_8c.html#57531d5f29d4cbdaac1f25e52f4a069d">ntop_sites</a> = atoi(value);         <span class="keywordflow">break</span>; <span class="comment">/* TopSites       */</span>
<a name="l01594"></a>01594         <span class="keywordflow">case</span> 12: <a class="code" href="webalizer_8c.html#a450ef7a6e4e6148f9cb184144a7c8cc">ntop_urls</a> = atoi(value);          <span class="keywordflow">break</span>; <span class="comment">/* TopURLs        */</span>
<a name="l01595"></a>01595         <span class="keywordflow">case</span> 13: <a class="code" href="webalizer_8c.html#78414d5060b40b23c1fbb95546fb74d3">ntop_refs</a> = atoi(value);          <span class="keywordflow">break</span>; <span class="comment">/* TopRefs        */</span>
<a name="l01596"></a>01596         <span class="keywordflow">case</span> 14: <a class="code" href="webalizer_8c.html#09d5297ba12ba78e65bcb4679036de17">ntop_agents</a> = atoi(value);        <span class="keywordflow">break</span>; <span class="comment">/* TopAgents      */</span>
<a name="l01597"></a>01597         <span class="keywordflow">case</span> 15: <a class="code" href="webalizer_8c.html#fcd390bd7df1e721799f33f0ac87fdaf">ntop_ctrys</a> = atoi(value);         <span class="keywordflow">break</span>; <span class="comment">/* TopCountries   */</span>
<a name="l01598"></a>01598         <span class="keywordflow">case</span> 16: <a class="code" href="linklist_8c.html#8839d62523e9b12655cca004617bbe77">add_nlist</a>(value,&amp;<a class="code" href="linklist_8c.html#96bde86b735761b0b2b03d057d7bddfd">hidden_sites</a>);   <span class="keywordflow">break</span>; <span class="comment">/* HideSite       */</span>
<a name="l01599"></a>01599         <span class="keywordflow">case</span> 17: <a class="code" href="linklist_8c.html#8839d62523e9b12655cca004617bbe77">add_nlist</a>(value,&amp;<a class="code" href="linklist_8c.html#fb86638f144a8726901b06185e2415af">hidden_urls</a>);    <span class="keywordflow">break</span>; <span class="comment">/* HideURL        */</span>
<a name="l01600"></a>01600         <span class="keywordflow">case</span> 18: <a class="code" href="linklist_8c.html#8839d62523e9b12655cca004617bbe77">add_nlist</a>(value,&amp;<a class="code" href="linklist_8c.html#7f8ec975eaff8227a3e09efb17d3e064">hidden_refs</a>);    <span class="keywordflow">break</span>; <span class="comment">/* HideReferrer   */</span>
<a name="l01601"></a>01601         <span class="keywordflow">case</span> 19: <a class="code" href="linklist_8c.html#8839d62523e9b12655cca004617bbe77">add_nlist</a>(value,&amp;<a class="code" href="linklist_8c.html#89feb23799329906fbd4a3d47a303027">hidden_agents</a>);  <span class="keywordflow">break</span>; <span class="comment">/* HideAgent      */</span>
<a name="l01602"></a>01602         <span class="keywordflow">case</span> 20: <a class="code" href="linklist_8c.html#8839d62523e9b12655cca004617bbe77">add_nlist</a>(value,&amp;<a class="code" href="linklist_8c.html#a35b4fc28f26c83f77336185f9aa7175">index_alias</a>);    <span class="keywordflow">break</span>; <span class="comment">/* IndexAlias     */</span>
<a name="l01603"></a>01603         <span class="keywordflow">case</span> 21: <a class="code" href="linklist_8c.html#8839d62523e9b12655cca004617bbe77">add_nlist</a>(value,&amp;<a class="code" href="linklist_8c.html#1811e9595e278ef4ac307d06cd3a4eed">html_head</a>);      <span class="keywordflow">break</span>; <span class="comment">/* HTMLHead       */</span>
<a name="l01604"></a>01604         <span class="keywordflow">case</span> 22: <a class="code" href="linklist_8c.html#8839d62523e9b12655cca004617bbe77">add_nlist</a>(value,&amp;<a class="code" href="linklist_8c.html#fd6de839e46d75632279853537235e7c">html_post</a>);      <span class="keywordflow">break</span>; <span class="comment">/* HTMLPost       */</span>
<a name="l01605"></a>01605         <span class="keywordflow">case</span> 23: <a class="code" href="linklist_8c.html#8839d62523e9b12655cca004617bbe77">add_nlist</a>(value,&amp;<a class="code" href="linklist_8c.html#7d3b981f0cda9084a93c191ab80637da">html_tail</a>);      <span class="keywordflow">break</span>; <span class="comment">/* HTMLTail       */</span>
<a name="l01606"></a>01606         <span class="keywordflow">case</span> 24: <a class="code" href="webalizer_8c.html#23d6ba920f8b5ddaea1f3e92958bdaba">mangle_agent</a>=atoi(value);         <span class="keywordflow">break</span>; <span class="comment">/* MangleAgents   */</span>
<a name="l01607"></a>01607         <span class="keywordflow">case</span> 25: <a class="code" href="linklist_8c.html#8839d62523e9b12655cca004617bbe77">add_nlist</a>(value,&amp;ignored_sites);  <span class="keywordflow">break</span>; <span class="comment">/* IgnoreSite     */</span>
<a name="l01608"></a>01608         <span class="keywordflow">case</span> 26: <a class="code" href="linklist_8c.html#8839d62523e9b12655cca004617bbe77">add_nlist</a>(value,&amp;<a class="code" href="linklist_8c.html#9a30b4cfe3e814caad5864bf70683264">ignored_urls</a>);   <span class="keywordflow">break</span>; <span class="comment">/* IgnoreURL      */</span>
<a name="l01609"></a>01609         <span class="keywordflow">case</span> 27: <a class="code" href="linklist_8c.html#8839d62523e9b12655cca004617bbe77">add_nlist</a>(value,&amp;<a class="code" href="linklist_8c.html#761639dc29cca53d524007b9fb4a6e65">ignored_refs</a>);   <span class="keywordflow">break</span>; <span class="comment">/* IgnoreReferrer */</span>
<a name="l01610"></a>01610         <span class="keywordflow">case</span> 28: <a class="code" href="linklist_8c.html#8839d62523e9b12655cca004617bbe77">add_nlist</a>(value,&amp;<a class="code" href="linklist_8c.html#60013ce10d008e9eb74a4b6f28959729">ignored_agents</a>); <span class="keywordflow">break</span>; <span class="comment">/* IgnoreAgent    */</span>
<a name="l01611"></a>01611         <span class="keywordflow">case</span> 29: <span class="keywordflow">if</span> (value[0]==<span class="charliteral">'y'</span>) <a class="code" href="webalizer_8c.html#0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>=0;     <span class="keywordflow">break</span>; <span class="comment">/* ReallyQuiet    */</span>
<a name="l01612"></a>01612         <span class="keywordflow">case</span> 30: <a class="code" href="webalizer_8c.html#34c0559db82e0af71c64d53206f763c8">local_time</a>=(value[0]==<span class="charliteral">'y'</span>)?0:1;   <span class="keywordflow">break</span>; <span class="comment">/* GMTTime        */</span>
<a name="l01613"></a>01613         <span class="keywordflow">case</span> 31: <a class="code" href="linklist_8c.html#7a76399c20af4803b0efcc757733039d">add_glist</a>(value,&amp;<a class="code" href="linklist_8c.html#2b91bf4fd34380ee9673b57513dbff01">group_urls</a>);     <span class="keywordflow">break</span>; <span class="comment">/* GroupURL       */</span>
<a name="l01614"></a>01614         <span class="keywordflow">case</span> 32: <a class="code" href="linklist_8c.html#7a76399c20af4803b0efcc757733039d">add_glist</a>(value,&amp;<a class="code" href="linklist_8c.html#cda3597076ed2d11c457ee98bb89caa7">group_sites</a>);    <span class="keywordflow">break</span>; <span class="comment">/* GroupSite      */</span>
<a name="l01615"></a>01615         <span class="keywordflow">case</span> 33: <a class="code" href="linklist_8c.html#7a76399c20af4803b0efcc757733039d">add_glist</a>(value,&amp;<a class="code" href="linklist_8c.html#73820e36830211218e9c911bc6ea6273">group_refs</a>);     <span class="keywordflow">break</span>; <span class="comment">/* GroupReferrer  */</span>
<a name="l01616"></a>01616         <span class="keywordflow">case</span> 34: <a class="code" href="linklist_8c.html#7a76399c20af4803b0efcc757733039d">add_glist</a>(value,&amp;<a class="code" href="linklist_8c.html#2acbebab9914d67a3cea0f3716324fe2">group_agents</a>);   <span class="keywordflow">break</span>; <span class="comment">/* GroupAgent     */</span>
<a name="l01617"></a>01617         <span class="keywordflow">case</span> 35: <a class="code" href="webalizer_8c.html#9b469898b01940a383f1ed816e4459b2">shade_groups</a>=(value[0]==<span class="charliteral">'y'</span>)?1:0; <span class="keywordflow">break</span>; <span class="comment">/* GroupShading   */</span>
<a name="l01618"></a>01618         <span class="keywordflow">case</span> 36: <a class="code" href="webalizer_8c.html#607dff280556363fab771e9e492ea057">hlite_groups</a>=(value[0]==<span class="charliteral">'y'</span>)?1:0; <span class="keywordflow">break</span>; <span class="comment">/* GroupHighlight */</span>
<a name="l01619"></a>01619         <span class="keywordflow">case</span> 37: incremental=(value[0]==<span class="charliteral">'y'</span>)?1:0;  <span class="keywordflow">break</span>; <span class="comment">/* Incremental    */</span>
<a name="l01620"></a>01620         <span class="keywordflow">case</span> 38: <a class="code" href="webalizer_8c.html#bc6083147b471a6df297cc5851057771">state_fname</a>=<a class="code" href="webalizer_8c.html#90af490e0665082d8b56fea2667356f4">save_opt</a>(value);      <span class="keywordflow">break</span>; <span class="comment">/* State FName    */</span>
<a name="l01621"></a>01621         <span class="keywordflow">case</span> 39: <a class="code" href="webalizer_8c.html#196026e726faa9db510409f5d895d7a3">hist_fname</a>=<a class="code" href="webalizer_8c.html#90af490e0665082d8b56fea2667356f4">save_opt</a>(value);       <span class="keywordflow">break</span>; <span class="comment">/* History FName  */</span>
<a name="l01622"></a>01622         <span class="keywordflow">case</span> 40: <a class="code" href="webalizer_8c.html#ef5a49b05e1bff557f85797e61dcd23a">html_ext</a>=<a class="code" href="webalizer_8c.html#90af490e0665082d8b56fea2667356f4">save_opt</a>(value);         <span class="keywordflow">break</span>; <span class="comment">/* HTML extension */</span>
<a name="l01623"></a>01623         <span class="keywordflow">case</span> 41: <a class="code" href="linklist_8c.html#8839d62523e9b12655cca004617bbe77">add_nlist</a>(value,&amp;<a class="code" href="linklist_8c.html#cea32428cfbcce0e252dd3613586d0f3">html_pre</a>);       <span class="keywordflow">break</span>; <span class="comment">/* HTML Pre code  */</span>
<a name="l01624"></a>01624         <span class="keywordflow">case</span> 42: <a class="code" href="linklist_8c.html#8839d62523e9b12655cca004617bbe77">add_nlist</a>(value,&amp;<a class="code" href="linklist_8c.html#4bb0bd1db8f0b3cc89d509d8c5daddde">html_body</a>);      <span class="keywordflow">break</span>; <span class="comment">/* HTML Body code */</span>
<a name="l01625"></a>01625         <span class="keywordflow">case</span> 43: <a class="code" href="linklist_8c.html#8839d62523e9b12655cca004617bbe77">add_nlist</a>(value,&amp;<a class="code" href="linklist_8c.html#d7f0906501b524d986d95f8efddb48e5">html_end</a>);       <span class="keywordflow">break</span>; <span class="comment">/* HTML End code  */</span>
<a name="l01626"></a>01626         <span class="keywordflow">case</span> 44: <a class="code" href="webalizer_8c.html#d821baa693a77d314549e3556fd6534a">use_https</a>=(value[0]==<span class="charliteral">'y'</span>)?1:0;    <span class="keywordflow">break</span>; <span class="comment">/* Use https://   */</span>
<a name="l01627"></a>01627         <span class="keywordflow">case</span> 45: <a class="code" href="linklist_8c.html#8839d62523e9b12655cca004617bbe77">add_nlist</a>(value,&amp;<a class="code" href="linklist_8c.html#54c446a5497d9c6f94704e50f3ab099f">include_sites</a>);  <span class="keywordflow">break</span>; <span class="comment">/* IncludeSite    */</span>
<a name="l01628"></a>01628         <span class="keywordflow">case</span> 46: <a class="code" href="linklist_8c.html#8839d62523e9b12655cca004617bbe77">add_nlist</a>(value,&amp;<a class="code" href="linklist_8c.html#10e92b92241988092187d4a28d95d057">include_urls</a>);   <span class="keywordflow">break</span>; <span class="comment">/* IncludeURL     */</span>
<a name="l01629"></a>01629         <span class="keywordflow">case</span> 47: <a class="code" href="linklist_8c.html#8839d62523e9b12655cca004617bbe77">add_nlist</a>(value,&amp;<a class="code" href="linklist_8c.html#72e046ed2702acb3b3cc2aa444f861b0">include_refs</a>);   <span class="keywordflow">break</span>; <span class="comment">/* IncludeReferrer*/</span>
<a name="l01630"></a>01630         <span class="keywordflow">case</span> 48: <a class="code" href="linklist_8c.html#8839d62523e9b12655cca004617bbe77">add_nlist</a>(value,&amp;<a class="code" href="linklist_8c.html#29034f7c35846ae0399bd7b358be1d94">include_agents</a>); <span class="keywordflow">break</span>; <span class="comment">/* IncludeAgent   */</span>
<a name="l01631"></a>01631         <span class="keywordflow">case</span> 49: <a class="code" href="linklist_8c.html#8839d62523e9b12655cca004617bbe77">add_nlist</a>(value,&amp;<a class="code" href="linklist_8c.html#556b3c90c27ba5b38626945734914353">page_type</a>);      <span class="keywordflow">break</span>; <span class="comment">/* PageType       */</span>
<a name="l01632"></a>01632         <span class="keywordflow">case</span> 50: <a class="code" href="webalizer_8c.html#95c29ea4f1f207b5be0cdd3cefa935d1">visit_timeout</a>=atoi(value);        <span class="keywordflow">break</span>; <span class="comment">/* VisitTimeout   */</span>
<a name="l01633"></a>01633         <span class="keywordflow">case</span> 51: <a class="code" href="webalizer_8c.html#8209c1ed16bfdf4913b7837d8d0b8520">graph_legend</a>=(value[0]==<span class="charliteral">'y'</span>)?1:0; <span class="keywordflow">break</span>; <span class="comment">/* GraphLegend    */</span>
<a name="l01634"></a>01634         <span class="keywordflow">case</span> 52: <a class="code" href="webalizer_8c.html#b0e6606dc823003635fbd6408bd03439">graph_lines</a> = atoi(value);        <span class="keywordflow">break</span>; <span class="comment">/* GraphLines     */</span>
<a name="l01635"></a>01635         <span class="keywordflow">case</span> 53: <a class="code" href="webalizer_8c.html#23652bde57737d1f6f700f29c4762728">fold_seq_err</a>=(value[0]==<span class="charliteral">'y'</span>)?1:0; <span class="keywordflow">break</span>; <span class="comment">/* FoldSeqErr     */</span>
<a name="l01636"></a>01636         <span class="keywordflow">case</span> 54: <a class="code" href="webalizer_8c.html#f1ef30cbdcfd1e369800371e296aaec2">ctry_graph</a>=(value[0]==<span class="charliteral">'y'</span>)?1:0;   <span class="keywordflow">break</span>; <span class="comment">/* CountryGraph   */</span>
<a name="l01637"></a>01637         <span class="keywordflow">case</span> 55: <a class="code" href="webalizer_8c.html#a3069c260eedec99be29617d90fa687a">ntop_sitesK</a> = atoi(value);        <span class="keywordflow">break</span>; <span class="comment">/* TopKSites (KB) */</span>
<a name="l01638"></a>01638         <span class="keywordflow">case</span> 56: <a class="code" href="webalizer_8c.html#21acc4795c6bb4027a1bd2ad038fe3fa">ntop_urlsK</a>  = atoi(value);        <span class="keywordflow">break</span>; <span class="comment">/* TopKUrls (KB)  */</span>
<a name="l01639"></a>01639         <span class="keywordflow">case</span> 57: <a class="code" href="webalizer_8c.html#a573c7e2a32733a06a3b0dbb9430569f">ntop_entry</a>  = atoi(value);        <span class="keywordflow">break</span>; <span class="comment">/* Top Entry pgs  */</span>
<a name="l01640"></a>01640         <span class="keywordflow">case</span> 58: <a class="code" href="webalizer_8c.html#9d1968145275f8eb19935b5c6d5b2848">ntop_exit</a>   = atoi(value);        <span class="keywordflow">break</span>; <span class="comment">/* Top Exit pages */</span>
<a name="l01641"></a>01641         <span class="keywordflow">case</span> 59: <a class="code" href="webalizer_8c.html#57e3ec40e1f85e8b2620950dc43b753f">ntop_search</a> = atoi(value);        <span class="keywordflow">break</span>; <span class="comment">/* Top Search pgs */</span>
<a name="l01642"></a>01642         <span class="keywordflow">case</span> 60: <a class="code" href="webalizer_8c.html#d1e2a6d9014a2af70dfa80ce7b69d4b0">log_type</a>=(value[0]==<span class="charliteral">'f'</span>)?
<a name="l01643"></a>01643                  <a class="code" href="webalizer_8h.html#cf5d4c2811adb735aaf5b32f62cc3cea">LOG_FTP</a>:((value[0]==<span class="charliteral">'s'</span>)?
<a name="l01644"></a>01644                  <a class="code" href="webalizer_8h.html#43821087b540ecbc400b7cef8ab10be0">LOG_SQUID</a>:<a class="code" href="webalizer_8h.html#5ce0d49d0e92ba00b7385ef68d26b51a">LOG_CLF</a>);               <span class="keywordflow">break</span>; <span class="comment">/* LogType        */</span>
<a name="l01645"></a>01645         <span class="keywordflow">case</span> 61: <a class="code" href="linklist_8c.html#7a76399c20af4803b0efcc757733039d">add_glist</a>(value,&amp;<a class="code" href="linklist_8c.html#d93c06cbf86de996601e602d07da3663">search_list</a>);    <span class="keywordflow">break</span>; <span class="comment">/* SearchEngine   */</span>
<a name="l01646"></a>01646         <span class="keywordflow">case</span> 62: <a class="code" href="webalizer_8c.html#3b91bd084088b32764aaa00f48083faf">group_domains</a>=atoi(value);        <span class="keywordflow">break</span>; <span class="comment">/* GroupDomains   */</span>
<a name="l01647"></a>01647         <span class="keywordflow">case</span> 63: <a class="code" href="webalizer_8c.html#a77fbf13eba0ffbb98b893c0089cb49b">hide_sites</a>=(value[0]==<span class="charliteral">'y'</span>)?1:0;   <span class="keywordflow">break</span>; <span class="comment">/* HideAllSites   */</span>
<a name="l01648"></a>01648         <span class="keywordflow">case</span> 64: <a class="code" href="webalizer_8c.html#e80c0d7d06836110749922f34dd902c2">all_sites</a>=(value[0]==<span class="charliteral">'y'</span>)?1:0;    <span class="keywordflow">break</span>; <span class="comment">/* All Sites?     */</span>
<a name="l01649"></a>01649         <span class="keywordflow">case</span> 65: <a class="code" href="webalizer_8c.html#633444563a9587349d9a5f158062b662">all_urls</a>=(value[0]==<span class="charliteral">'y'</span>)?1:0;     <span class="keywordflow">break</span>; <span class="comment">/* All URL's?     */</span>
<a name="l01650"></a>01650         <span class="keywordflow">case</span> 66: <a class="code" href="webalizer_8c.html#5d9ecc711cb4edb47133e9c8329a2f6a">all_refs</a>=(value[0]==<span class="charliteral">'y'</span>)?1:0;     <span class="keywordflow">break</span>; <span class="comment">/* All Refs       */</span>
<a name="l01651"></a>01651         <span class="keywordflow">case</span> 67: <a class="code" href="webalizer_8c.html#e6a5e084455a29d95c410b6e6f509c07">all_agents</a>=(value[0]==<span class="charliteral">'y'</span>)?1:0;   <span class="keywordflow">break</span>; <span class="comment">/* All Agents?    */</span>
<a name="l01652"></a>01652         <span class="keywordflow">case</span> 68: <a class="code" href="webalizer_8c.html#f51b93932a98e306bd47239ec9c99f23">all_search</a>=(value[0]==<span class="charliteral">'y'</span>)?1:0;   <span class="keywordflow">break</span>; <span class="comment">/* All Srch str   */</span>
<a name="l01653"></a>01653         <span class="keywordflow">case</span> 69: <a class="code" href="webalizer_8c.html#395ccae1fd2f2450f623db87fbd9f9e1">all_users</a>=(value[0]==<span class="charliteral">'y'</span>)?1:0;    <span class="keywordflow">break</span>; <span class="comment">/* All Users?     */</span>
<a name="l01654"></a>01654         <span class="keywordflow">case</span> 70: <a class="code" href="webalizer_8c.html#958b818c79b6fa3f2d0ab1ca4bb3e97c">ntop_users</a>=atoi(value);           <span class="keywordflow">break</span>; <span class="comment">/* TopUsers       */</span>
<a name="l01655"></a>01655         <span class="keywordflow">case</span> 71: <a class="code" href="linklist_8c.html#8839d62523e9b12655cca004617bbe77">add_nlist</a>(value,&amp;<a class="code" href="linklist_8c.html#c328ffff94e0ce5d57817ee1197767aa">hidden_users</a>);   <span class="keywordflow">break</span>; <span class="comment">/* HideUser       */</span>
<a name="l01656"></a>01656         <span class="keywordflow">case</span> 72: <a class="code" href="linklist_8c.html#8839d62523e9b12655cca004617bbe77">add_nlist</a>(value,&amp;<a class="code" href="linklist_8c.html#c61949a50def3ceeaf32f93f01d1ea16">ignored_users</a>);  <span class="keywordflow">break</span>; <span class="comment">/* IgnoreUser     */</span>
<a name="l01657"></a>01657         <span class="keywordflow">case</span> 73: <a class="code" href="linklist_8c.html#8839d62523e9b12655cca004617bbe77">add_nlist</a>(value,&amp;<a class="code" href="linklist_8c.html#4301d92f7f72fdda0af03033d967155b">include_users</a>);  <span class="keywordflow">break</span>; <span class="comment">/* IncludeUser    */</span>
<a name="l01658"></a>01658         <span class="keywordflow">case</span> 74: <a class="code" href="linklist_8c.html#7a76399c20af4803b0efcc757733039d">add_glist</a>(value,&amp;<a class="code" href="linklist_8c.html#5589f953a1673e7a2f3891d321794340">group_users</a>);    <span class="keywordflow">break</span>; <span class="comment">/* GroupUser      */</span>
<a name="l01659"></a>01659         <span class="keywordflow">case</span> 75: <a class="code" href="webalizer_8c.html#10b59e622c5a54e43f7ec491e5bc1776">dump_path</a>=<a class="code" href="webalizer_8c.html#90af490e0665082d8b56fea2667356f4">save_opt</a>(value);        <span class="keywordflow">break</span>; <span class="comment">/* DumpPath       */</span>
<a name="l01660"></a>01660         <span class="keywordflow">case</span> 76: <a class="code" href="webalizer_8c.html#b11b451e9eab811058070fddc7f42efb">dump_ext</a>=<a class="code" href="webalizer_8c.html#90af490e0665082d8b56fea2667356f4">save_opt</a>(value);         <span class="keywordflow">break</span>; <span class="comment">/* Dumpfile ext   */</span>
<a name="l01661"></a>01661         <span class="keywordflow">case</span> 77: <a class="code" href="webalizer_8c.html#2a20cc7746e90fec505b066fda4e1f5d">dump_header</a>=(value[0]==<span class="charliteral">'y'</span>)?1:0;  <span class="keywordflow">break</span>; <span class="comment">/* DumpHeader?    */</span>
<a name="l01662"></a>01662         <span class="keywordflow">case</span> 78: <a class="code" href="webalizer_8c.html#54401b9d6a97a9951e2fb1bf09e83b2b">dump_sites</a>=(value[0]==<span class="charliteral">'y'</span>)?1:0;   <span class="keywordflow">break</span>; <span class="comment">/* DumpSites?     */</span>
<a name="l01663"></a>01663         <span class="keywordflow">case</span> 79: <a class="code" href="webalizer_8c.html#a9f638a5b7e03638423ce8d5c3f5be6e">dump_urls</a>=(value[0]==<span class="charliteral">'y'</span>)?1:0;    <span class="keywordflow">break</span>; <span class="comment">/* DumpURLs?      */</span>
<a name="l01664"></a>01664         <span class="keywordflow">case</span> 80: <a class="code" href="webalizer_8c.html#5e125d6b90581ab008f71bf272ec1aac">dump_refs</a>=(value[0]==<span class="charliteral">'y'</span>)?1:0;    <span class="keywordflow">break</span>; <span class="comment">/* DumpReferrers? */</span>
<a name="l01665"></a>01665         <span class="keywordflow">case</span> 81: <a class="code" href="webalizer_8c.html#95b4dacf3a1c2e18715bfbd268726afb">dump_agents</a>=(value[0]==<span class="charliteral">'y'</span>)?1:0;  <span class="keywordflow">break</span>; <span class="comment">/* DumpAgents?    */</span>
<a name="l01666"></a>01666         <span class="keywordflow">case</span> 82: <a class="code" href="webalizer_8c.html#a6b267f406cddbd150680fb2ce5260b1">dump_users</a>=(value[0]==<span class="charliteral">'y'</span>)?1:0;   <span class="keywordflow">break</span>; <span class="comment">/* DumpUsers?     */</span>
<a name="l01667"></a>01667         <span class="keywordflow">case</span> 83: <a class="code" href="webalizer_8c.html#5acb64968750f92b0c7443ec44dde282">dump_search</a>=(value[0]==<span class="charliteral">'y'</span>)?1:0;  <span class="keywordflow">break</span>; <span class="comment">/* DumpSrchStrs?  */</span>
<a name="l01668"></a>01668 <span class="preprocessor">#ifdef USE_DNS</span>
<a name="l01669"></a>01669 <span class="preprocessor"></span>        <span class="keywordflow">case</span> 84: <a class="code" href="webalizer_8c.html#3cb74b5ee16f5910ee70cc4944d1300a">dns_cache</a>=<a class="code" href="webalizer_8c.html#90af490e0665082d8b56fea2667356f4">save_opt</a>(value);        <span class="keywordflow">break</span>; <span class="comment">/* DNSCache fname */</span>
<a name="l01670"></a>01670         <span class="keywordflow">case</span> 85: <a class="code" href="webalizer_8c.html#90492045766d92f08b5e160135ade65c">dns_children</a>=atoi(value);         <span class="keywordflow">break</span>; <span class="comment">/* DNSChildren    */</span>
<a name="l01671"></a>01671 <span class="preprocessor">#else</span>
<a name="l01672"></a>01672 <span class="preprocessor"></span>        <span class="keywordflow">case</span> 84: <span class="comment">/* Disable DNSCache and DNSChildren if DNS is not enabled  */</span>
<a name="l01673"></a>01673         <span class="keywordflow">case</span> 85: printf(<span class="stringliteral">"%s '%s' (%s)\n"</span>,msg_bad_key,keyword,fname); <span class="keywordflow">break</span>;
<a name="l01674"></a>01674 <span class="preprocessor">#endif  </span><span class="comment">/* USE_DNS */</span>
<a name="l01675"></a>01675         <span class="keywordflow">case</span> 86: <a class="code" href="webalizer_8c.html#81ebc74fab71c6cde9eff752ad0b5974">daily_graph</a>=(value[0]==<span class="charliteral">'n'</span>)?0:1; <span class="keywordflow">break</span>;  <span class="comment">/* HourlyGraph    */</span>
<a name="l01676"></a>01676         <span class="keywordflow">case</span> 87: <a class="code" href="webalizer_8c.html#4c83c5bd481ef466be0d92fd9ad6c8b1">daily_stats</a>=(value[0]==<span class="charliteral">'n'</span>)?0:1; <span class="keywordflow">break</span>;  <span class="comment">/* HourlyStats    */</span>
<a name="l01677"></a>01677         <span class="keywordflow">case</span> 88: <a class="code" href="webalizer_8c.html#aae85fa49329c9361a901e52954764eb">ntop_notfound</a> = atoi(value);     <span class="keywordflow">break</span>;  <span class="comment">/* Top 404 errors */</span>
<a name="l01678"></a>01678       }
<a name="l01679"></a>01679    }
<a name="l01680"></a>01680    fclose(fp);
<a name="l01681"></a>01681 }
<a name="l01682"></a>01682 
<a name="l01683"></a>01683 <span class="comment">/*********************************************/</span>
<a name="l01684"></a>01684 <span class="comment">/* SAVE_OPT - save option from config file   */</span>
<a name="l01685"></a>01685 <span class="comment">/*********************************************/</span>
<a name="l01686"></a>01686 
<a name="l01687"></a><a class="code" href="webalizer_8c.html#90af490e0665082d8b56fea2667356f4">01687</a> <span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="webalizer_8c.html#90af490e0665082d8b56fea2667356f4">save_opt</a>(<span class="keywordtype">char</span> *str)
<a name="l01688"></a>01688 {
<a name="l01689"></a>01689    <span class="keywordtype">char</span> *cp1;
<a name="l01690"></a>01690 
<a name="l01691"></a>01691    <span class="keywordflow">if</span> ( (cp1=malloc(strlen(str)+1))==NULL) <span class="keywordflow">return</span> NULL;
<a name="l01692"></a>01692 
<a name="l01693"></a>01693    strcpy(cp1,str);
<a name="l01694"></a>01694    <span class="keywordflow">return</span> cp1;
<a name="l01695"></a>01695 }
<a name="l01696"></a>01696 
<a name="l01697"></a>01697 <span class="comment">/*********************************************/</span>
<a name="l01698"></a>01698 <span class="comment">/* CLEAR_MONTH - initalize monthly stuff     */</span>
<a name="l01699"></a>01699 <span class="comment">/*********************************************/</span>
<a name="l01700"></a>01700 
<a name="l01701"></a><a class="code" href="webalizer_8c.html#3d6b75394204fbb3dbe30423911cda44">01701</a> <span class="keywordtype">void</span> <a class="code" href="webalizer_8c.html#3d6b75394204fbb3dbe30423911cda44">clear_month</a>()
<a name="l01702"></a>01702 {
<a name="l01703"></a>01703    <span class="keywordtype">int</span> i;
<a name="l01704"></a>01704 
<a name="l01705"></a>01705    <a class="code" href="webalizer_8c.html#c13990c5857877d516d60af22bfbc492">init_counters</a>();                  <span class="comment">/* reset monthly counters  */</span>
<a name="l01706"></a>01706    <a class="code" href="hashtab_8c.html#f9fcdad76e91434fe5f0728f3a79ae74">del_htabs</a>();                      <span class="comment">/* clear hash tables       */</span>
<a name="l01707"></a>01707    <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#fcd390bd7df1e721799f33f0ac87fdaf">ntop_ctrys</a>!=0 ) <span class="keywordflow">for</span> (i=0;i&lt;<a class="code" href="webalizer_8c.html#fcd390bd7df1e721799f33f0ac87fdaf">ntop_ctrys</a>;i++)  <a class="code" href="webalizer_8c.html#acb9022e3fedc2d14e55e9854fa3cbcf">top_ctrys</a>[i]=NULL;
<a name="l01708"></a>01708 }
<a name="l01709"></a>01709 
<a name="l01710"></a>01710 <span class="comment">/*********************************************/</span>
<a name="l01711"></a>01711 <span class="comment">/* INIT_COUNTERS - prep counters for use     */</span>
<a name="l01712"></a>01712 <span class="comment">/*********************************************/</span>
<a name="l01713"></a>01713 
<a name="l01714"></a><a class="code" href="webalizer_8h.html#c13990c5857877d516d60af22bfbc492">01714</a> <span class="keywordtype">void</span> <a class="code" href="webalizer_8c.html#c13990c5857877d516d60af22bfbc492">init_counters</a>()
<a name="l01715"></a>01715 {
<a name="l01716"></a>01716    <span class="keywordtype">int</span> i;
<a name="l01717"></a>01717    <span class="keywordflow">for</span> (i=0;i&lt;<a class="code" href="webalizer_8h.html#774b57757b20d74727ecde0388a020b6">TOTAL_RC</a>;i++) <a class="code" href="lang_8h.html#6fbb1449f14f39208f656061d49c280b">response</a>[i].<a class="code" href="structresponse__url.html#82f3189f3b02c8eb1edc0f0da8ceb0e7">count</a> = 0;
<a name="l01718"></a>01718    <span class="keywordflow">for</span> (i=0;i&lt;31;i++)  <span class="comment">/* monthly totals      */</span>
<a name="l01719"></a>01719    {
<a name="l01720"></a>01720     <a class="code" href="webalizer_8c.html#d8577082542e8d61ae9d21b5cdc09de6">tm_xfer</a>[i]=0.0;
<a name="l01721"></a>01721     <a class="code" href="webalizer_8c.html#90b2c6f5c71d87e07a6aa0694651c7a8">tm_hit</a>[i]=<a class="code" href="webalizer_8c.html#985c7f07bdd01aea04be87abba0d225b">tm_file</a>[i]=<a class="code" href="webalizer_8c.html#3016395581c35bac86027a654deb0db5">tm_site</a>[i]=<a class="code" href="webalizer_8c.html#2b0163914dcd84396a9d6dae48ee4a54">tm_page</a>[i]=<a class="code" href="webalizer_8c.html#f3d33c8d579ff7b3d41abb0e618f70a5">tm_visit</a>[i]=0;
<a name="l01722"></a>01722    }
<a name="l01723"></a>01723    <span class="keywordflow">for</span> (i=0;i&lt;24;i++)  <span class="comment">/* hourly totals       */</span>
<a name="l01724"></a>01724    {
<a name="l01725"></a>01725       <a class="code" href="webalizer_8c.html#2c634f4ff63cf16a5bb219632d9da1f5">th_hit</a>[i]=<a class="code" href="webalizer_8c.html#8d6ce1fa8aba3c7f1ed1c7e19ea0541c">th_file</a>[i]=<a class="code" href="webalizer_8c.html#cdb9ccdbdd487d188cd174056a7dcd80">th_page</a>[i]=0;
<a name="l01726"></a>01726       <a class="code" href="webalizer_8c.html#a063714cc339793854ef49bb72c4382b">th_xfer</a>[i]=0.0;
<a name="l01727"></a>01727    }
<a name="l01728"></a>01728    <span class="keywordflow">for</span> (i=0;<a class="code" href="lang_8h.html#2da4e4ffd517ae749587bd8692434663">ctry</a>[i].<a class="code" href="structcountry__code.html#835c53390df57142797eae431d0d7a8b">desc</a>;i++) <span class="comment">/* country totals */</span>
<a name="l01729"></a>01729    {
<a name="l01730"></a>01730       ctry[i].<a class="code" href="structresponse__url.html#82f3189f3b02c8eb1edc0f0da8ceb0e7">count</a>=0;
<a name="l01731"></a>01731       <a class="code" href="lang_8h.html#2da4e4ffd517ae749587bd8692434663">ctry</a>[i].<a class="code" href="structcountry__code.html#ecff0cb1d546cd8375ca6ed45a75867c">files</a>=0;
<a name="l01732"></a>01732       <a class="code" href="lang_8h.html#2da4e4ffd517ae749587bd8692434663">ctry</a>[i].<a class="code" href="structcountry__code.html#c2f451d6198d10eb266d7cdadf117a1e">xfer</a>=0;
<a name="l01733"></a>01733    }
<a name="l01734"></a>01734    <a class="code" href="webalizer_8c.html#4f0e430951167c36ff37f1373c453d40">t_hit</a>=<a class="code" href="webalizer_8c.html#8d8f1b3ebaff4207130ee4e068a74578">t_file</a>=<a class="code" href="webalizer_8c.html#e37f859c6ceb40434ecd96c6ba5d0565">t_site</a>=<a class="code" href="webalizer_8c.html#593eb26715b7f629074c61861d8dd8b3">t_url</a>=<a class="code" href="webalizer_8c.html#54f4adcbb2769b5082a138f23c9bb07e">t_ref</a>=<a class="code" href="webalizer_8c.html#681645a12ff433a6d191ac4eabbb265d">t_agent</a>=<a class="code" href="webalizer_8c.html#dab177cb0d83726239072547f166262a">t_page</a>=<a class="code" href="webalizer_8c.html#241257c2fb7477a7dc9191c01e8a155a">t_visit</a>=<a class="code" href="webalizer_8c.html#196ee522ca1e09cef5b8962a7c63e4e2">t_user</a>=0;
<a name="l01735"></a>01735    <a class="code" href="webalizer_8c.html#1952e11824da591d81fdf3371627ae86">t_xfer</a>=0.0;
<a name="l01736"></a>01736    <a class="code" href="webalizer_8c.html#0fbe52a528ae909f4058a35bdab8d034">mh_hit</a> = <a class="code" href="webalizer_8c.html#f80cf0d40e63789f26cf6ee643eb3b4c">dt_site</a> = 0;
<a name="l01737"></a>01737    <a class="code" href="webalizer_8c.html#4637ce886571ae33e34d7d0ae8d50df8">f_day</a>=<a class="code" href="webalizer_8c.html#3322d751ac470f626bc34fb8b34c1759">l_day</a>=1;
<a name="l01738"></a>01738 }
<a name="l01739"></a>01739 
<a name="l01740"></a>01740 <span class="comment">/*********************************************/</span>
<a name="l01741"></a>01741 <span class="comment">/* PRINT_OPTS - print command line options   */</span>
<a name="l01742"></a>01742 <span class="comment">/*********************************************/</span>
<a name="l01743"></a>01743 
<a name="l01744"></a><a class="code" href="webalizer_8c.html#beb1db8f30c512b9050440ec49248364">01744</a> <span class="keywordtype">void</span> <a class="code" href="webalizer_8c.html#beb1db8f30c512b9050440ec49248364">print_opts</a>(<span class="keywordtype">char</span> *pname)
<a name="l01745"></a>01745 {
<a name="l01746"></a>01746    <span class="keywordtype">int</span> i;
<a name="l01747"></a>01747 
<a name="l01748"></a>01748    printf(<span class="stringliteral">"%s: %s %s\n"</span>,<a class="code" href="lang_8h.html#9ba617b9ad4b243163879779992cb922">h_usage1</a>,pname,<a class="code" href="lang_8h.html#3b3adac04f9e05f7ff5b592fcf18cdc6">h_usage2</a>);
<a name="l01749"></a>01749    <span class="keywordflow">for</span> (i=0;<a class="code" href="lang_8h.html#b5b6cedf99598af62b8cd4bc308493b4">h_msg</a>[i];i++) printf(<span class="stringliteral">"%s\n"</span>,<a class="code" href="lang_8h.html#b5b6cedf99598af62b8cd4bc308493b4">h_msg</a>[i]);
<a name="l01750"></a>01750    exit(1);
<a name="l01751"></a>01751 }
<a name="l01752"></a>01752 
<a name="l01753"></a>01753 <span class="comment">/*********************************************/</span>
<a name="l01754"></a>01754 <span class="comment">/* PRINT_VERSION                             */</span>
<a name="l01755"></a>01755 <span class="comment">/*********************************************/</span>
<a name="l01756"></a>01756 
<a name="l01757"></a><a class="code" href="webalizer_8c.html#6302aaae12249e8ea16bfdc7de892f21">01757</a> <span class="keywordtype">void</span> <a class="code" href="webalizer_8c.html#6302aaae12249e8ea16bfdc7de892f21">print_version</a>()
<a name="l01758"></a>01758 {
<a name="l01759"></a>01759  uname(&amp;<a class="code" href="webalizer_8c.html#fb4af3ebf8357e94b736496594995cee">system_info</a>);
<a name="l01760"></a>01760  printf(<span class="stringliteral">"Webalizer V%s-%s (%s %s) %s\n%s\n"</span>,
<a name="l01761"></a>01761     <a class="code" href="webalizer_8c.html#56abfaab87c46691c1ef3ad0df23e864">version</a>,<a class="code" href="webalizer_8c.html#59179d90a91f573f3c081592845ee19c">editlvl</a>,
<a name="l01762"></a>01762     <a class="code" href="webalizer_8c.html#fb4af3ebf8357e94b736496594995cee">system_info</a>.sysname,<a class="code" href="webalizer_8c.html#fb4af3ebf8357e94b736496594995cee">system_info</a>.release,
<a name="l01763"></a>01763     <a class="code" href="lang_8h.html#8ae4b47621b125e915cee8ccdaa2095c">language</a>,<a class="code" href="webalizer_8c.html#38852561a5fe1b90c4dae9d90b83a80a">copyright</a>);
<a name="l01764"></a>01764 
<a name="l01765"></a>01765  <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#4f7caf3ead45aac3963d1e354e820017">debug_mode</a>)
<a name="l01766"></a>01766  {
<a name="l01767"></a>01767     printf(<span class="stringliteral">"Mod date: %s  Options: "</span>,<a class="code" href="webalizer_8c.html#c000a634d0e3be8405dde288f429e91a">moddate</a>);
<a name="l01768"></a>01768 <span class="preprocessor">#ifdef USE_DNS</span>
<a name="l01769"></a>01769 <span class="preprocessor"></span>    printf(<span class="stringliteral">"DNS "</span>);
<a name="l01770"></a>01770 <span class="preprocessor">#else</span>
<a name="l01771"></a>01771 <span class="preprocessor"></span>    printf(<span class="stringliteral">"none"</span>);
<a name="l01772"></a>01772 <span class="preprocessor">#endif</span>
<a name="l01773"></a>01773 <span class="preprocessor"></span>    printf(<span class="stringliteral">"\nDefault config dir: %s\n\n"</span>,ETCDIR);
<a name="l01774"></a>01774  }
<a name="l01775"></a>01775  <span class="keywordflow">else</span> printf(<span class="stringliteral">"\n"</span>);
<a name="l01776"></a>01776  exit(1);
<a name="l01777"></a>01777 }
<a name="l01778"></a>01778 
<a name="l01779"></a>01779 <span class="comment">/*********************************************/</span>
<a name="l01780"></a>01780 <span class="comment">/* CUR_TIME - return date/time as a string   */</span>
<a name="l01781"></a>01781 <span class="comment">/*********************************************/</span>
<a name="l01782"></a>01782 
<a name="l01783"></a><a class="code" href="webalizer_8h.html#f6fc05ecb3c962ea69fac0a9ce9525d7">01783</a> <span class="keywordtype">char</span> *<a class="code" href="webalizer_8c.html#f6fc05ecb3c962ea69fac0a9ce9525d7">cur_time</a>()
<a name="l01784"></a>01784 {
<a name="l01785"></a>01785    <span class="comment">/* get system time */</span>
<a name="l01786"></a>01786    <a class="code" href="webalizer_8c.html#3c3ca8cc859a31aec6578f0dcf1b32a5">now</a> = time(NULL);
<a name="l01787"></a>01787    <span class="comment">/* convert to timestamp string */</span>
<a name="l01788"></a>01788    <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#34c0559db82e0af71c64d53206f763c8">local_time</a>)
<a name="l01789"></a>01789       strftime(<a class="code" href="webalizer_8c.html#17cd1753a5a06a50ec97b8e85f56af0e">timestamp</a>,<span class="keyword">sizeof</span>(timestamp),<span class="stringliteral">"%d-%b-%Y %H:%M %Z"</span>,
<a name="l01790"></a>01790             localtime(&amp;<a class="code" href="webalizer_8c.html#3c3ca8cc859a31aec6578f0dcf1b32a5">now</a>));
<a name="l01791"></a>01791    <span class="keywordflow">else</span>
<a name="l01792"></a>01792       strftime(timestamp,<span class="keyword">sizeof</span>(timestamp),<span class="stringliteral">"%d-%b-%Y %H:%M GMT"</span>,
<a name="l01793"></a>01793             gmtime(&amp;<a class="code" href="webalizer_8c.html#3c3ca8cc859a31aec6578f0dcf1b32a5">now</a>));
<a name="l01794"></a>01794 
<a name="l01795"></a>01795    <span class="keywordflow">return</span> timestamp;
<a name="l01796"></a>01796 }
<a name="l01797"></a>01797 
<a name="l01798"></a>01798 <span class="comment">/*********************************************/</span>
<a name="l01799"></a>01799 <span class="comment">/* ISPAGE - determine if an HTML page or not */</span>
<a name="l01800"></a>01800 <span class="comment">/*********************************************/</span>
<a name="l01801"></a>01801 
<a name="l01802"></a><a class="code" href="webalizer_8h.html#cd1966893702ec0520fb7a743275a2e0">01802</a> <span class="keywordtype">int</span> <a class="code" href="webalizer_8c.html#875f50fc519d72b2f46b8413cb1a9c45">ispage</a>(<span class="keywordtype">char</span> *str)
<a name="l01803"></a>01803 {
<a name="l01804"></a>01804    <span class="keywordtype">char</span> *cp1, *cp2;
<a name="l01805"></a>01805 
<a name="l01806"></a>01806    cp1=cp2=str;
<a name="l01807"></a>01807    <span class="keywordflow">while</span> (*cp1!=<span class="charliteral">'\0'</span>) { <span class="keywordflow">if</span> (*cp1==<span class="charliteral">'.'</span>) cp2=cp1; cp1++; }
<a name="l01808"></a>01808    <span class="keywordflow">if</span> ((cp2++==str)||(*(--cp1)==<span class="charliteral">'/'</span>)) <span class="keywordflow">return</span> 1;
<a name="l01809"></a>01809    <span class="keywordflow">else</span> <span class="keywordflow">return</span> (<a class="code" href="linklist_8c.html#29bda5ebb6dd2f9b19d8f9519eaf94ff">isinlist</a>(<a class="code" href="linklist_8c.html#556b3c90c27ba5b38626945734914353">page_type</a>,cp2)!=NULL);
<a name="l01810"></a>01810 }
<a name="l01811"></a>01811 
<a name="l01812"></a>01812 <span class="comment">/*********************************************/</span>
<a name="l01813"></a>01813 <span class="comment">/* ISURLCHAR - checks for valid URL chars    */</span>
<a name="l01814"></a>01814 <span class="comment">/*********************************************/</span>
<a name="l01815"></a>01815 
<a name="l01816"></a><a class="code" href="webalizer_8c.html#6889c498251013344e6bcd437b077db0">01816</a> <span class="keywordtype">int</span> <a class="code" href="webalizer_8c.html#6889c498251013344e6bcd437b077db0">isurlchar</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> ch)
<a name="l01817"></a>01817 {
<a name="l01818"></a>01818    <span class="keywordflow">if</span> (isalnum((<span class="keywordtype">int</span>)ch)) <span class="keywordflow">return</span> 1;           <span class="comment">/* allow letters, numbers...    */</span>
<a name="l01819"></a>01819    <span class="keywordflow">if</span> (ch &gt; 127) <span class="keywordflow">return</span> 1;                   <span class="comment">/* allow extended chars...      */</span>
<a name="l01820"></a>01820    <span class="keywordflow">return</span> (strchr(<span class="stringliteral">":/\\.,' *-+_@~()[]"</span>,ch)!=NULL); <span class="comment">/* and a few special ones */</span>
<a name="l01821"></a>01821 }
<a name="l01822"></a>01822 
<a name="l01823"></a>01823 <span class="comment">/*********************************************/</span>
<a name="l01824"></a>01824 <span class="comment">/* CTRY_IDX - create unique # from domain    */</span>
<a name="l01825"></a>01825 <span class="comment">/*********************************************/</span>
<a name="l01826"></a>01826 
<a name="l01827"></a><a class="code" href="webalizer_8h.html#6efa2454167aed5a5ea10455b758f77e">01827</a> u_long <a class="code" href="webalizer_8c.html#154bd0b4bda40aa5c99d7cf79886d400">ctry_idx</a>(<span class="keywordtype">char</span> *str)
<a name="l01828"></a>01828 {
<a name="l01829"></a>01829    <span class="keywordtype">int</span> i=strlen(str),j=0;
<a name="l01830"></a>01830    u_long idx=0;
<a name="l01831"></a>01831    <span class="keywordtype">char</span> *cp1=str+i;
<a name="l01832"></a>01832    <span class="keywordflow">for</span> (;i&gt;0;i--) { idx+=((*--cp1-<span class="charliteral">'a'</span>+1)&lt;&lt;j); j+=5; }
<a name="l01833"></a>01833    <span class="keywordflow">return</span> idx;
<a name="l01834"></a>01834 }
<a name="l01835"></a>01835 
<a name="l01836"></a>01836 <span class="comment">/*********************************************/</span>
<a name="l01837"></a>01837 <span class="comment">/* FROM_HEX - convert hex char to decimal    */</span>
<a name="l01838"></a>01838 <span class="comment">/*********************************************/</span>
<a name="l01839"></a>01839 
<a name="l01840"></a><a class="code" href="webalizer_8c.html#9f2fa07c0c39a7caed8e40eaf1c2fa96">01840</a> <span class="keywordtype">char</span> <a class="code" href="webalizer_8c.html#9f2fa07c0c39a7caed8e40eaf1c2fa96">from_hex</a>(<span class="keywordtype">char</span> c)                           <span class="comment">/* convert hex to dec      */</span>
<a name="l01841"></a>01841 {
<a name="l01842"></a>01842    c = (c&gt;=<span class="charliteral">'0'</span>&amp;&amp;c&lt;=<span class="charliteral">'9'</span>)?c-<span class="charliteral">'0'</span>:                  <span class="comment">/* 0-9?                    */</span>
<a name="l01843"></a>01843        (c&gt;=<span class="charliteral">'A'</span>&amp;&amp;c&lt;=<span class="charliteral">'F'</span>)?c-<span class="charliteral">'A'</span>+10:               <span class="comment">/* A-F?                    */</span>
<a name="l01844"></a>01844        c - <span class="charliteral">'a'</span> + 10;                            <span class="comment">/* lowercase...            */</span>
<a name="l01845"></a>01845    <span class="keywordflow">return</span> (c&lt;0||c&gt;15)?0:c;                      <span class="comment">/* return 0 if bad...      */</span>
<a name="l01846"></a>01846 }
<a name="l01847"></a>01847 
<a name="l01848"></a>01848 <span class="comment">/*********************************************/</span>
<a name="l01849"></a>01849 <span class="comment">/* UNESCAPE - convert escape seqs to chars   */</span>
<a name="l01850"></a>01850 <span class="comment">/*********************************************/</span>
<a name="l01851"></a>01851 
<a name="l01852"></a><a class="code" href="webalizer_8c.html#5d5d55b66d7df3272cf98f061b6fd2f6">01852</a> <span class="keywordtype">char</span> *<a class="code" href="webalizer_8c.html#5d5d55b66d7df3272cf98f061b6fd2f6">unescape</a>(<span class="keywordtype">char</span> *str)
<a name="l01853"></a>01853 {
<a name="l01854"></a>01854    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *cp1=str;                      <span class="comment">/* force unsigned so we    */</span>
<a name="l01855"></a>01855    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *cp2=str;                      <span class="comment">/* can do &gt; 127            */</span>
<a name="l01856"></a>01856 
<a name="l01857"></a>01857    <span class="keywordflow">if</span> (!str) <span class="keywordflow">return</span> NULL;                       <span class="comment">/* make sure strings valid */</span>
<a name="l01858"></a>01858 
<a name="l01859"></a>01859    <span class="keywordflow">while</span> (*cp1)
<a name="l01860"></a>01860    {
<a name="l01861"></a>01861       <span class="keywordflow">if</span> (*cp1==<span class="charliteral">'%'</span>)                            <span class="comment">/* Found an escape?        */</span>
<a name="l01862"></a>01862       {
<a name="l01863"></a>01863          cp1++;
<a name="l01864"></a>01864          <span class="keywordflow">if</span> (isxdigit(*cp1))                    <span class="comment">/* ensure a hex digit      */</span>
<a name="l01865"></a>01865          {
<a name="l01866"></a>01866             <span class="keywordflow">if</span> (*cp1) *cp2=<a class="code" href="webalizer_8c.html#9f2fa07c0c39a7caed8e40eaf1c2fa96">from_hex</a>(*cp1++)*16; <span class="comment">/* convert hex to an ascii */</span>
<a name="l01867"></a>01867             <span class="keywordflow">if</span> (*cp1) *cp2+=<a class="code" href="webalizer_8c.html#9f2fa07c0c39a7caed8e40eaf1c2fa96">from_hex</a>(*cp1);     <span class="comment">/* (hopefully) character   */</span>
<a name="l01868"></a>01868             <span class="keywordflow">if</span> ((*cp2&lt;32)||(*cp2==127)) *cp2=<span class="charliteral">'_'</span>; <span class="comment">/* make '_' if its bad   */</span>
<a name="l01869"></a>01869             <span class="keywordflow">if</span> (*cp1) cp2++; cp1++;
<a name="l01870"></a>01870          }
<a name="l01871"></a>01871          <span class="keywordflow">else</span> *cp2++=<span class="charliteral">'%'</span>;
<a name="l01872"></a>01872       }
<a name="l01873"></a>01873       <span class="keywordflow">else</span> *cp2++ = *cp1++;                     <span class="comment">/* if not, just continue   */</span>
<a name="l01874"></a>01874    }
<a name="l01875"></a>01875    *cp2=*cp1;                                   <span class="comment">/* don't forget terminator */</span>
<a name="l01876"></a>01876    <span class="keywordflow">return</span> str;                                  <span class="comment">/* return the string       */</span>
<a name="l01877"></a>01877 }
<a name="l01878"></a>01878 
<a name="l01879"></a>01879 <span class="comment">/*********************************************/</span>
<a name="l01880"></a>01880 <span class="comment">/* SRCH_STRING - get search strings from ref */</span>
<a name="l01881"></a>01881 <span class="comment">/*********************************************/</span>
<a name="l01882"></a>01882 
<a name="l01883"></a><a class="code" href="webalizer_8c.html#2b1002ec17d1cd1e6901514b8b6de058">01883</a> <span class="keywordtype">void</span> <a class="code" href="webalizer_8c.html#2b1002ec17d1cd1e6901514b8b6de058">srch_string</a>(<span class="keywordtype">char</span> *ptr)
<a name="l01884"></a>01884 {
<a name="l01885"></a>01885    <span class="comment">/* ptr should point to unescaped query string */</span>
<a name="l01886"></a>01886    <span class="keywordtype">char</span> tmpbuf[<a class="code" href="webalizer_8h.html#eca034f67218340ecb2261a22c2f3dcd">BUFSIZE</a>];
<a name="l01887"></a>01887    <span class="keywordtype">char</span> srch[80]=<span class="stringliteral">""</span>;
<a name="l01888"></a>01888    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *cp1, *cp2, *cps;
<a name="l01889"></a>01889    <span class="keywordtype">int</span>  sp_flg=0;
<a name="l01890"></a>01890 
<a name="l01891"></a>01891    <span class="comment">/* Check if search engine referrer or return  */</span>
<a name="l01892"></a>01892    <span class="keywordflow">if</span> ( (cps=<a class="code" href="linklist_8c.html#70d3ef92faca75f6392ba919975ffe47">isinglist</a>(<a class="code" href="linklist_8c.html#d93c06cbf86de996601e602d07da3663">search_list</a>,<a class="code" href="webalizer_8c.html#b78a7a0970e517ad18adea541d2b2b32">log_rec</a>.<a class="code" href="structlog__struct.html#cb4f74246c1b97c518bbcc8a4823c0d4">refer</a>))==NULL) <span class="keywordflow">return</span>; 
<a name="l01893"></a>01893 
<a name="l01894"></a>01894    <span class="comment">/* Try to find query variable */</span>
<a name="l01895"></a>01895    srch[0]=<span class="charliteral">'?'</span>; strcpy(&amp;srch[1],cps);              <span class="comment">/* First, try "?..."      */</span>
<a name="l01896"></a>01896    <span class="keywordflow">if</span> ((cp1=strstr(ptr,srch))==NULL)
<a name="l01897"></a>01897    {
<a name="l01898"></a>01898       srch[0]=<span class="charliteral">'&amp;'</span>;                                 <span class="comment">/* Next, try "&amp;..."       */</span>
<a name="l01899"></a>01899       <span class="keywordflow">if</span> ((cp1=strstr(ptr,srch))==NULL) <span class="keywordflow">return</span>;    <span class="comment">/* If not found, split... */</span>
<a name="l01900"></a>01900    }
<a name="l01901"></a>01901    cp2=tmpbuf;
<a name="l01902"></a>01902    <span class="keywordflow">while</span> (*cp1!=<span class="charliteral">'='</span> &amp;&amp; *cp1!=0) cp1++; <span class="keywordflow">if</span> (*cp1!=0) cp1++;
<a name="l01903"></a>01903    <span class="keywordflow">while</span> (*cp1!=<span class="charliteral">'&amp;'</span> &amp;&amp; *cp1!=0)
<a name="l01904"></a>01904    {
<a name="l01905"></a>01905       <span class="keywordflow">if</span> (*cp1==<span class="charliteral">'"'</span> || *cp1==<span class="charliteral">','</span> || *cp1==<span class="charliteral">'?'</span>)
<a name="l01906"></a>01906           { cp1++; <span class="keywordflow">continue</span>; }                         <span class="comment">/* skip bad ones..    */</span>
<a name="l01907"></a>01907       <span class="keywordflow">else</span>
<a name="l01908"></a>01908       {
<a name="l01909"></a>01909          <span class="keywordflow">if</span> (*cp1==<span class="charliteral">'+'</span>) *cp1=<span class="charliteral">' '</span>;                      <span class="comment">/* change + to space  */</span>
<a name="l01910"></a>01910          <span class="keywordflow">if</span> (sp_flg &amp;&amp; *cp1==<span class="charliteral">' '</span>) { cp1++; <span class="keywordflow">continue</span>; } <span class="comment">/* compress spaces    */</span>
<a name="l01911"></a>01911          <span class="keywordflow">if</span> (*cp1==<span class="charliteral">' '</span>) sp_flg=1; <span class="keywordflow">else</span> sp_flg=0;       <span class="comment">/* (flag spaces here) */</span>
<a name="l01912"></a>01912          *cp2++=tolower(*cp1);                         <span class="comment">/* normal character   */</span>
<a name="l01913"></a>01913          cp1++;
<a name="l01914"></a>01914       }
<a name="l01915"></a>01915    }
<a name="l01916"></a>01916    *cp2=0; cp2=tmpbuf;
<a name="l01917"></a>01917    <span class="keywordflow">if</span> (tmpbuf[0]==<span class="charliteral">'?'</span>) tmpbuf[0]=<span class="charliteral">' '</span>;                  <span class="comment">/* format fix ?       */</span>
<a name="l01918"></a>01918    <span class="keywordflow">while</span>( *cp2!=0 &amp;&amp; isspace(*cp2) ) cp2++;            <span class="comment">/* skip leading sps.  */</span>
<a name="l01919"></a>01919    <span class="keywordflow">if</span> (*cp2==0) <span class="keywordflow">return</span>;
<a name="l01920"></a>01920 
<a name="l01921"></a>01921    <span class="comment">/* any trailing spaces? */</span>
<a name="l01922"></a>01922    cp1=cp2+strlen(cp2)-1;
<a name="l01923"></a>01923    <span class="keywordflow">while</span> (cp1!=cp2) <span class="keywordflow">if</span> (isspace(*cp1)) *cp1--=<span class="charliteral">'\0'</span>; <span class="keywordflow">else</span> <span class="keywordflow">break</span>;
<a name="l01924"></a>01924 
<a name="l01925"></a>01925    <span class="comment">/* strip invalid chars */</span>
<a name="l01926"></a>01926    cp1=cp2;
<a name="l01927"></a>01927    <span class="keywordflow">while</span> (*cp1!=0) { <span class="keywordflow">if</span> ((*cp1&lt;32)||(*cp1==127)) *cp1=<span class="charliteral">'_'</span>; cp1++; }
<a name="l01928"></a>01928 
<a name="l01929"></a>01929    <span class="keywordflow">if</span> (<a class="code" href="hashtab_8c.html#53bf7691f858a503c77b657b22cec782">put_snode</a>(cp2,(u_long)1,<a class="code" href="hashtab_8c.html#e9a8ef54a4b421e3d16dc313f162ccff">sr_htab</a>))
<a name="l01930"></a>01930    {
<a name="l01931"></a>01931       <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>)
<a name="l01932"></a>01932       <span class="comment">/* Error adding search string node, skipping .... */</span>
<a name="l01933"></a>01933       fprintf(stderr,<span class="stringliteral">"%s %s\n"</span>, <a class="code" href="lang_8h.html#c16f110828a2baa76b8a63f213a81022">msg_nomem_sc</a>, tmpbuf);
<a name="l01934"></a>01934    }
<a name="l01935"></a>01935    <span class="keywordflow">return</span>;
<a name="l01936"></a>01936 }
<a name="l01937"></a>01937 
<a name="l01938"></a>01938 <span class="comment">/*********************************************/</span>
<a name="l01939"></a>01939 <span class="comment">/* GET_DOMAIN - Get domain portion of host   */</span>
<a name="l01940"></a>01940 <span class="comment">/*********************************************/</span>
<a name="l01941"></a>01941 
<a name="l01942"></a><a class="code" href="webalizer_8c.html#4c24c3d81b9c48e9f490919de3e32afb">01942</a> <span class="keywordtype">char</span> *<a class="code" href="webalizer_8c.html#4c24c3d81b9c48e9f490919de3e32afb">get_domain</a>(<span class="keywordtype">char</span> *str)
<a name="l01943"></a>01943 {
<a name="l01944"></a>01944    <span class="keywordtype">char</span> *cp;
<a name="l01945"></a>01945    <span class="keywordtype">int</span>  i=<a class="code" href="webalizer_8c.html#3b91bd084088b32764aaa00f48083faf">group_domains</a>+1;
<a name="l01946"></a>01946 
<a name="l01947"></a>01947    cp = str+strlen(str)-1;
<a name="l01948"></a>01948    <span class="keywordflow">if</span> (isdigit((<span class="keywordtype">int</span>)*cp)) <span class="keywordflow">return</span> NULL;   <span class="comment">/* ignore IP addresses */</span>
<a name="l01949"></a>01949 
<a name="l01950"></a>01950    <span class="keywordflow">while</span> (cp!=str)
<a name="l01951"></a>01951    {
<a name="l01952"></a>01952       <span class="keywordflow">if</span> (*cp==<span class="charliteral">'.'</span>)
<a name="l01953"></a>01953          <span class="keywordflow">if</span> (!(--i)) <span class="keywordflow">return</span> ++cp;
<a name="l01954"></a>01954       cp--;
<a name="l01955"></a>01955    }
<a name="l01956"></a>01956    <span class="keywordflow">return</span> cp;
<a name="l01957"></a>01957 }
<a name="l01958"></a>01958 
<a name="l01959"></a>01959 <span class="comment">/*********************************************/</span>
<a name="l01960"></a>01960 <span class="comment">/* OUR_GZGETS - enhanced gzgets for log only */</span>
<a name="l01961"></a>01961 <span class="comment">/*********************************************/</span>
<a name="l01962"></a>01962 
<a name="l01963"></a><a class="code" href="webalizer_8c.html#8abb48bca3dbb868295ee2ce344e3d95">01963</a> <span class="keywordtype">char</span> *<a class="code" href="webalizer_8c.html#8abb48bca3dbb868295ee2ce344e3d95">our_gzgets</a>(gzFile fp, <span class="keywordtype">char</span> *buf, <span class="keywordtype">int</span> size)
<a name="l01964"></a>01964 {
<a name="l01965"></a>01965    <span class="keywordtype">char</span> *out_cp=buf;      <span class="comment">/* point to output */</span>
<a name="l01966"></a>01966    <span class="keywordflow">while</span> (1)
<a name="l01967"></a>01967    {
<a name="l01968"></a>01968       <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#405a69d1287c4dd254d758f0e2114f60">f_cp</a>&gt;(<a class="code" href="webalizer_8c.html#0f09c2c14de82a844b4cce5c76184709">f_buf</a>+<a class="code" href="webalizer_8c.html#912061ffd86d7c9c5d45a818091a1809">f_end</a>-1))     <span class="comment">/* load? */</span>
<a name="l01969"></a>01969       {
<a name="l01970"></a>01970          <a class="code" href="webalizer_8c.html#912061ffd86d7c9c5d45a818091a1809">f_end</a>=gzread(fp, <a class="code" href="webalizer_8c.html#0f09c2c14de82a844b4cce5c76184709">f_buf</a>, <a class="code" href="webalizer_8c.html#0ca8208fe0ebf85a7d26cb53c31f8a78">GZ_BUFSIZE</a>);
<a name="l01971"></a>01971          <span class="keywordflow">if</span> (<a class="code" href="webalizer_8c.html#912061ffd86d7c9c5d45a818091a1809">f_end</a>&lt;=0) <span class="keywordflow">return</span> Z_NULL;
<a name="l01972"></a>01972          <a class="code" href="webalizer_8c.html#405a69d1287c4dd254d758f0e2114f60">f_cp</a>=<a class="code" href="webalizer_8c.html#0f09c2c14de82a844b4cce5c76184709">f_buf</a>;
<a name="l01973"></a>01973       }
<a name="l01974"></a>01974 
<a name="l01975"></a>01975       <span class="keywordflow">if</span> (--size)                   <span class="comment">/* more? */</span>
<a name="l01976"></a>01976       {
<a name="l01977"></a>01977          *out_cp++ = *<a class="code" href="webalizer_8c.html#405a69d1287c4dd254d758f0e2114f60">f_cp</a>;
<a name="l01978"></a>01978          <span class="keywordflow">if</span> (*<a class="code" href="webalizer_8c.html#405a69d1287c4dd254d758f0e2114f60">f_cp</a>++ == <span class="charliteral">'\n'</span>) { *out_cp=<span class="charliteral">'\0'</span>; <span class="keywordflow">return</span> buf; }
<a name="l01979"></a>01979       }
<a name="l01980"></a>01980       <span class="keywordflow">else</span> { *out_cp=<span class="charliteral">'\0'</span>; <span class="keywordflow">return</span> buf; }
<a name="l01981"></a>01981    }
<a name="l01982"></a>01982 }
<a name="l01983"></a>01983 
<a name="l01984"></a>01984 <span class="comment">/*****************************************************************/</span>
<a name="l01985"></a>01985 <span class="comment">/*                                                               */</span>
<a name="l01986"></a>01986 <span class="comment">/* JDATE  - Julian date calculator                               */</span>
<a name="l01987"></a>01987 <span class="comment">/*                                                               */</span>
<a name="l01988"></a>01988 <span class="comment">/* Calculates the number of days since Jan 1, 0000.              */</span>
<a name="l01989"></a>01989 <span class="comment">/*                                                               */</span>
<a name="l01990"></a>01990 <span class="comment">/* Originally written by Bradford L. Barrett (03/17/1988)        */</span>
<a name="l01991"></a>01991 <span class="comment">/* Returns an unsigned long value representing the number of     */</span>
<a name="l01992"></a>01992 <span class="comment">/* days since January 1, 0000.                                   */</span>
<a name="l01993"></a>01993 <span class="comment">/*                                                               */</span>
<a name="l01994"></a>01994 <span class="comment">/* Note: Due to the changes made by Pope Gregory XIII in the     */</span>
<a name="l01995"></a>01995 <span class="comment">/*       16th Centyry (Feb 24, 1582), dates before 1583 will     */</span>
<a name="l01996"></a>01996 <span class="comment">/*       not return a truely accurate number (will be at least   */</span>
<a name="l01997"></a>01997 <span class="comment">/*       10 days off).  Somehow, I don't think this will         */</span>
<a name="l01998"></a>01998 <span class="comment">/*       present much of a problem for most situations :)        */</span>
<a name="l01999"></a>01999 <span class="comment">/*                                                               */</span>
<a name="l02000"></a>02000 <span class="comment">/* Usage: days = jdate(day, month, year)                         */</span>
<a name="l02001"></a>02001 <span class="comment">/*                                                               */</span>
<a name="l02002"></a>02002 <span class="comment">/* The number returned is adjusted by 5 to facilitate day of     */</span>
<a name="l02003"></a>02003 <span class="comment">/* week calculations.  The mod of the returned value gives the   */</span>
<a name="l02004"></a>02004 <span class="comment">/* day of the week the date is.  (ie: dow = days % 7 ) where     */</span>
<a name="l02005"></a>02005 <span class="comment">/* dow will return 0=Sunday, 1=Monday, 2=Tuesday, etc...         */</span>
<a name="l02006"></a>02006 <span class="comment">/*                                                               */</span>
<a name="l02007"></a>02007 <span class="comment">/*****************************************************************/</span>
<a name="l02008"></a>02008 
<a name="l02009"></a><a class="code" href="webalizer_8h.html#dd01ad5cfed4640cdbb33666ea88a572">02009</a> u_long <a class="code" href="webalizer_8c.html#8fb8978d91b70fd80d00d381cb115731">jdate</a>( <span class="keywordtype">int</span> day, <span class="keywordtype">int</span> month, <span class="keywordtype">int</span> year )
<a name="l02010"></a>02010 {
<a name="l02011"></a>02011    u_long days;                      <span class="comment">/* value returned */</span>
<a name="l02012"></a>02012    <span class="keywordtype">int</span> mtable[] = {0,31,59,90,120,151,181,212,243,273,304,334};
<a name="l02013"></a>02013 
<a name="l02014"></a>02014    <span class="comment">/* First, calculate base number including leap and Centenial year stuff */</span>
<a name="l02015"></a>02015 
<a name="l02016"></a>02016    days=(((u_long)year*365)+day+mtable[month-1]+
<a name="l02017"></a>02017            ((year+4)/4) - ((year/100)-(year/400)));
<a name="l02018"></a>02018 
<a name="l02019"></a>02019    <span class="comment">/* now adjust for leap year before March 1st */</span>
<a name="l02020"></a>02020 
<a name="l02021"></a>02021    <span class="keywordflow">if</span> ((year % 4 == 0) &amp;&amp; !((year % 100 == 0) &amp;&amp;
<a name="l02022"></a>02022        (year % 400 != 0)) &amp;&amp; (month &lt; 3))
<a name="l02023"></a>02023    --days;
<a name="l02024"></a>02024 
<a name="l02025"></a>02025    <span class="comment">/* done, return with calculated value */</span>
<a name="l02026"></a>02026 
<a name="l02027"></a>02027    <span class="keywordflow">return</span>(days+5);
<a name="l02028"></a>02028 }
</pre></div><hr size="1"><address style="align: right;"><small>Erzeugt am Wed Jun 7 04:07:56 2006 fr OOS [Webalizer] von&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.6 </small></address>
</body>
</html>
